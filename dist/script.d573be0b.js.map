{"version":3,"sources":["js/UINotification.js","js/models/Settings.js","js/Event.js","js/Dom.js","js/debounce.js","js/Database.js","js/Migrations.js","js/models/BaseModel.js","js/models/ChatMessage.js","js/models/Chat.js","js/AppController.js","js/ChatListItem.js","js/DragAndDrop.js","js/ChatList.js","js/DownloadChatsButton.js","js/models/LocalStorage.js","js/Sidebar.js","js/CopyButton.js","js/OllamaApi.js","js/DownloadButton.js","js/DropDownMenu.js","js/Modal.js","js/List.js","js/models/Models.js","js/ModelsList.js","js/SettingsDialog.js","js/ChatSettingsDialog.js","js/Hoverable.js","js/ChatTitle.js","js/ChatForm.js","js/ChatArea.js","js/App.js","js/script.js","../../../../../usr/local/lib/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["simpleHash","str","hash","i","length","char","charCodeAt","UINotification","constructor","message","type","id","JSON","stringify","domId","container","document","body","template","getElementById","content","_bindEventListeners","window","addEventListener","event","key","hide","show","notification","initialize","originalConsoleError","console","error","_len","arguments","args","Array","_key","apply","handleApplicationError","debug","clone","cloneNode","notificationElement","querySelector","textContent","classList","add","closeButton","onclick","appendChild","remove","exports","Settings","set","value","stringValue","localStorage","setItem","e","get","defaultValue","undefined","getItem","parse","removeItem","getUrl","uri","baseUrl","URL","href","setUrl","url","getModel","setModel","model","getSystemPrompt","setSystemPrompt","systemPrompt","getModelParameters","setModelParameters","modelParameters","getCurrentChatId","setCurrentChatId","chatId","Event","listen","eventName","handler","detail","emit","data","log","CustomEvent","bubbles","dispatchEvent","DOM","showElement","element","hideElement","enableInput","removeAttribute","disableInput","setAttribute","debounce","func","wait","timeout","funcWrapper","later","clearTimeout","setTimeout","Database","dbName","objectStores","migrations","dbConnection","open","Error","Promise","resolve","reject","request","indexedDB","version","onerror","target","onupgradeneeded","db","result","transaction","currentTarget","upgrade","oldVersion","onsuccess","storeName","mode","objectStore","store","handleRequest","put","delete","getAll","clear","Migrations","database","funcName","upgradeFunc","upgradeToVersion2","context","createObjectStore","keyPath","autoIncrement","chatMessages","createIndex","unique","_Database","require","_Migrations","BaseModel","Object","assign","name","create","save","records","map","getAllByIndexAndId","indexName","index","messages","export","_BaseModel","ChatMessage","getAllByChatId","_ChatMessage","Chat","addMessage","getMessages","chat","_Event","_Chat","_Settings","AppController","updateChat","createChat","title","deleteChatMessage","messageId","deleteChat","getCurrentChat","setCurrentChat","clearChats","_AppController","ChatListItem","chatList","selected","setTitle","bindEventListeners","render","onMouseover","bind","onMouseout","onClick","selectChat","chatTitle","DragAndDrop","selector","listItems","querySelectorAll","draggedItem","initializeDragAndDrop","forEach","item","handleDragStart","handleDragOver","handleDrop","handleDragEnd","preventDefault","currentHTML","innerHTML","_ChatListItem","_DragAndDrop","ChatList","then","handleChatCreated","handleChatDeleted","handleChatsCleared","handleChatUpdated","handleChatSelected","appendChat","elements","listElement","previousListElement","newListElement","currentChatId","chats","chatListItem","DownloadChatsButton","button","exportChat","exportChatMessages","jsonData","blob","Blob","createObjectURL","a","createElement","download","click","revokeObjectURL","errorCode","LocalStorage","_debounce","_ChatList","_DownloadChatsButton","_LocalStorage","Sidebar","settings","newChatButton","clearButton","hamburgerButton","searchButton","downloadChatsButton","searchRow","searchInput","toggleSearch","performSearch","handleNewChat","handleClear","toggle","listItem","scrollIntoView","behavior","block","inline","focus","escapeRegExp","string","replace","query","trim","queryContent","regex","RegExp","matches","filter","match","test","includes","contains","CopyButton","targetSelector","getAttribute","textToCopy","innerText","textarea","select","execCommand","removeChild","alert","OllamaApi","abortController","send","onResponse","onError","onDone","response","postChatMessage","handleResponse","AbortController","signal","fetch","method","headers","ok","status","reader","getReader","partialLine","isRequestDone","done","read","textChunk","TextDecoder","decode","lines","split","pop","line","responseData","printResponseStats","abort","total_duration","totalDurationInSeconds","loadDurationInSeconds","load_duration","promptEvalDurationInSeconds","prompt_eval_duration","responseEvalDurationInSeconds","eval_duration","tokensPerSecond","eval_count","output","created_at","toFixed","prompt_eval_count","getModels","json","models","catch","DownloadButton","targetId","downloadElementContent","elementId","filename","DropDownMenu","buttonSelector","dropDownMenus","init","menuElement","closest","dropDownMenu","toggleMenu","menu","Modal","modal","handleShow","handleHide","List","containerId","items","clickHandler","setItems","setSelected","getSelected","ul","li","_OllamaApi","Models","load","getNames","findModelByName","find","_List","_Models","ModelsList","selectedModel","modelList","handleModelsLoaded","_Modal","_UINotification","_ModelsList","SettingsDialog","showButton","urlInput","modelInput","systemPromptInput","modelParametersInput","refreshModelsButton","loadSettings","parsedValue","prettyJSON","refreshModels","ChatSettingsDialog","Hoverable","hoverable","ChatTitle","defaultTitle","hasFocus","activeElement","handleSave","blur","ChatForm","chatHistory","messageInput","sendButton","abortButton","_Hoverable","_ChatTitle","_ChatForm","ChatArea","chatForm","editChatButton","scrollToTopButton","scrollToEndButton","deleteChatButton","createMessageDiv","scrollToEnd","scrollToTop","handleEditChat","handleDeleteChat","currentMessage","next","previous","nextElementSibling","firstElementChild","previousElementSibling","lastElementChild","role","messageClone","messageDiv","textSpan","deleteButton","spellcheck","dataset","stopPropagation","scrollTop","scrollHeight","_Dom","_Sidebar","_CopyButton","_DownloadButton","_DropDownMenu","_SettingsDialog","_ChatSettingsDialog","_ChatArea","App","run","app","sidebar","chatArea","ollamaApi","settingsDialog","chatSettingsDialog","downloadButton","copyButton","initializeElements","logInitialization","msg","handleAbort","handleKeyPress","history","pushState","enableForm","shiftKey","sendMessage","disableForm","userMessage","createChatMessage","responseElement","requestContext","requestData","prompt","system","options","handleResponseError","handleDone","sanitizedContent","sanitizeContent","getIdParam","location","pathname","_App","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","protocol","ws","onmessage","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","hmrApply","v","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","stack","overlay","createErrorOverlay","stackTrace","getParents","modules","parents","k","d","dep","isArray","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"script.d573be0b.js","sourceRoot":"..","sourcesContent":["function simpleHash(str) {\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return hash;\n}\n\n// Show all uncaught errors as UI notifications\n/*\nwindow.onerror = function (message, source, lineno, colno, error) {\n  const errorDetails = `${message} at ${source}:${lineno}:${colno}`;\n  UINotification.show(errorDetails, 'error');\n  return true;\n};\n*/\n\nexport class UINotification {\n  constructor(message, type) {\n    const id = simpleHash(JSON.stringify(message));\n    this.type = type;\n    this.domId = `notification-${id}`;\n    this.container = document.body;\n    this.template = document.getElementById('notification-template').content;\n    this._bindEventListeners();\n  }\n\n  _bindEventListeners() {\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  static show(message, type) {\n    const notification = new UINotification(message, type);\n    notification.show(message);\n  }\n\n  static initialize() {\n    // Store the original console.error function\n    const originalConsoleError = console.error;\n\n    // Override console.error\n    console.error = function (...args) {\n      UINotification.show(args);\n      // Call the original console.error with all arguments\n      originalConsoleError.apply(console, args);\n    };\n  }\n\n  static handleApplicationError(error) {\n    console.debug('caught error');\n    console.error(error);\n    UINotification.show(error);\n  }\n\n  show(message) {\n    // Clone the template\n    const clone = this.template.cloneNode(true);\n\n    // Find the root element of the notification in the clone\n    const notificationElement = clone.querySelector('.notification');\n    if (!notificationElement) {\n      console.error('Notification root element not found in template');\n      return;\n    }\n\n    // Set the message\n    clone.querySelector('.notification-message').textContent = message;\n\n    notificationElement.id = this.domId; // Set ID on the actual element, not the fragment\n    // Add type, for example, error\n    if (this.type) {\n      notificationElement.classList.add(`notification-${this.type}`);\n    }\n\n    // Add close functionality\n    const closeButton = clone.querySelector('.close-notification-button');\n    closeButton.onclick = () => this.hide();\n\n    // Don't show the same notification twice\n    if (!document.getElementById(this.domId)) {\n      // Append to the container and display\n      this.container.appendChild(clone);\n    }\n  }\n\n  hide() {\n    document.getElementById(this.domId)?.remove();\n  }\n}\n","export class Settings {\n  // Static method to set a value in localStorage\n  static set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Static method to get a value from localStorage\n  static get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Static method to remove a value from localStorage\n  static remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n\n  static getUrl(uri) {\n    try {\n      const baseUrl = Settings.get('url');\n      if (uri) {\n        return new URL(uri, baseUrl).href;\n      } else {\n        return baseUrl;\n      }\n    } catch (error) {\n      return null;\n    }\n  }\n\n  static setUrl(url) {\n    Settings.set('url', url);\n  }\n\n  static getModel() {\n    return Settings.get('model');\n  }\n\n  static setModel(model) {\n    Settings.set('model', model);\n  }\n\n  static getSystemPrompt() {\n    return Settings.get('system-prompt');\n  }\n\n  static setSystemPrompt(systemPrompt) {\n    if (systemPrompt === '') {\n      systemPrompt = null;\n    }\n    Settings.set('system-prompt', systemPrompt);\n  }\n\n  static getModelParameters() {\n    return Settings.get('model-parameters');\n  }\n\n  static setModelParameters(modelParameters) {\n    if (modelParameters === '') {\n      modelParameters = null;\n    }\n    Settings.set('model-parameters', modelParameters);\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static setCurrentChatId(chatId) {\n    if (chatId === undefined) {\n      chatId = null;\n    }\n    Settings.set('currentChatId', chatId);\n  }\n}\n","export class Event {\n  static listen(eventName, handler) {\n    window.addEventListener(eventName, (event) => {\n      handler(event.detail);\n    });\n  }\n\n  static emit(eventName, data) {\n    let log = `${eventName}`;\n    if (data?.id) {\n      log += ` id: ${data.id}`;\n    }\n    console.log(log);\n    const event = new CustomEvent(eventName, {\n      detail: data || {},\n      bubbles: true, // This makes the event bubble up through the DOM\n    });\n    window.dispatchEvent(event);\n  }\n}\n","export class DOM {\n  static showElement(element) {\n    element.classList.remove('hidden');\n    return this;\n  }\n\n  static hideElement(element) {\n    element.classList.add('hidden');\n    return this;\n  }\n\n  static enableInput(element) {\n    element.removeAttribute('disabled');\n    return this;\n  }\n\n  static disableInput(element) {\n    element.setAttribute('disabled', 'disabled');\n    return this;\n  }\n}\n","export function debounce(func, wait) {\n  let timeout;\n\n  return function funcWrapper(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n","export class Database {\n  constructor(dbName, objectStores, migrations) {\n    this.dbName = dbName;\n    this.objectStores = objectStores;\n    this.dbConnection = null; // Initialized in open\n    this.migrations = migrations;\n  }\n\n  async open() {\n    if (this.dbConnection) {\n      throw new Error('Connection already open');\n    }\n\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.migrations.version);\n\n      request.onerror = (event) => reject(event.target.error);\n      request.onupgradeneeded = (event) => {\n        const db = event.target.result;\n        const transaction = event.currentTarget.transaction;\n        this.migrations.upgrade(db, transaction, event.oldVersion);\n      };\n      request.onsuccess = (event) => {\n        this.dbConnection = event.target.result;\n        resolve(this.dbConnection);\n      };\n    });\n  }\n\n  async transaction(storeName, mode) {\n    return this.dbConnection\n      .transaction([storeName], mode)\n      .objectStore(storeName);\n  }\n\n  async add(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('add', store.add(data));\n  }\n\n  async get(storeName, id) {\n    const store = await this.transaction(storeName, 'readonly');\n    return this.handleRequest('get', store.get(id));\n  }\n\n  async put(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('put', store.put(data));\n  }\n\n  async delete(storeName, id) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('delete', store.delete(id));\n  }\n\n  async getAll(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('getAll', store.getAll());\n  }\n\n  async clear(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('deleteAll', store.clear());\n  }\n\n  handleRequest(type, request) {\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => resolve(request.result);\n\n      request.onerror = (event) => {\n        const error = `Database ${type} operation failed: ${event.target.error.message}`;\n        reject(new Error(JSON.stringify(error)));\n      };\n    });\n  }\n}\n","export class Migrations {\n  static version = 2;\n  static upgrade(database, transaction, oldVersion) {\n    console.debug(\n      `Migration needed. Old version ${oldVersion}. New version ${this.version}.`,\n    );\n    const funcName = `upgradeToVersion${this.version}`;\n    const upgradeFunc = this[funcName];\n    if (!upgradeFunc) {\n      throw new Error(`Upgrade function missing for ${funcName}`);\n    }\n    if (this.version >= oldVersion) {\n      upgradeFunc({ database, transaction });\n    }\n  }\n\n  static upgradeToVersion2(context) {\n    // Create chats\n    context.database.createObjectStore('chats', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    // Create chat_messages\n    const chatMessages = context.database.createObjectStore('chat_messages', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    chatMessages.createIndex('by_chat', 'chatId', { unique: false });\n  }\n}\n","import { Database } from '../Database.js';\nimport { Migrations } from '../Migrations.js';\n\nexport class BaseModel {\n  constructor(data) {\n    Object.assign(this, data);\n  }\n\n  static async database(name, store) {\n    this.dbName = name;\n    this.storeName = store;\n    this.db = new Database(name, [store], Migrations);\n    await this.db.open();\n  }\n\n  static async transaction(mode) {\n    return await this.db.transaction(this.storeName, mode);\n  }\n\n  async transaction(mode) {\n    return await this.constructor.transaction(mode);\n  }\n\n  async create() {\n    const key = await this.constructor.db.add(this.constructor.storeName, this);\n    if (!this.id) {\n      this.id = key;\n    }\n    return this;\n  }\n\n  async save() {\n    return await this.constructor.db.put(this.constructor.storeName, this);\n  }\n\n  async delete() {\n    return await this.constructor.db.delete(\n      this.constructor.storeName,\n      this.id,\n    );\n  }\n\n  static async get(id) {\n    const data = await this.db.get(this.storeName, id);\n    return new this(data);\n  }\n\n  static async clear() {\n    return await this.db.clear(this.storeName);\n  }\n\n  // TODO: sorting and selecting only certain attributes\n  static async getAll() {\n    const records = await this.db.getAll(this.storeName);\n    return records.map((data) => new this(data));\n  }\n\n  /**\n   * Retrieves all objects associated with a given ID and index.\n   *\n   * @param {number|string} chatId - The ID of the chat.\n   * @returns {Promise<Array>} A promise that resolves to an array.\n   */\n  static async getAllByIndexAndId(indexName, id) {\n    // Open a transaction and access the messages store\n    const transaction = await this.transaction('readonly');\n\n    // Use an index to find objects with the specified id\n    const index = transaction.index(indexName);\n    const request = index.getAll(id);\n\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => {\n        // Convert the result into instances\n        const messages = request.result.map((data) => new this(data));\n        resolve(messages);\n      };\n      request.onerror = () => {\n        reject(request.error);\n      };\n    });\n  }\n\n  // Exports the whole store\n  static async export() {\n    let transaction = await this.db.transaction(this.storeName, 'readonly');\n    let store = await transaction.transaction.objectStore(this.storeName);\n    return store.getAll();\n  }\n}\n","import { BaseModel } from './BaseModel.js';\n\nexport class ChatMessage extends BaseModel {\n  static async initialize() {\n    await this.database('ChatApp', 'chat_messages');\n  }\n\n  static async getAllByChatId(chatId) {\n    return this.getAllByIndexAndId('by_chat', chatId);\n  }\n}\n","import { BaseModel } from './BaseModel.js';\nimport { ChatMessage } from './ChatMessage.js';\n\nexport class Chat extends BaseModel {\n  async addMessage(data) {\n    data.chatId = this.id;\n    await new ChatMessage(data).create();\n  }\n\n  async getMessages() {\n    const messages = await ChatMessage.getAllByChatId(this.id);\n    this.messages = messages;\n    return this.messages;\n  }\n\n  static async initialize() {\n    await this.database('ChatApp', ['chats']);\n  }\n\n  static async clear() {\n    await ChatMessage.clear();\n    await super.clear();\n  }\n\n  static async get(id) {\n    const chat = await super.get(id);\n\n    /*\n    if (chat) {\n      // Fetch all messages for this chat\n      const messages = await ChatMessage.getAllByChatId(id);\n      chat.messages = messages;\n    }\n    */\n\n    return chat;\n  }\n\n  static async delete(id) {\n    // Delete the chat instance\n    await super.delete(id);\n\n    // Delete all associated messages\n    const messages = await ChatMessage.getAllByChatId(id);\n    for (const message of messages) {\n      await message.delete();\n    }\n  }\n}\n","import { Event } from './Event.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\nimport { Settings } from './models/Settings.js';\n\nexport class AppController {\n  static async updateChat(chat, data) {\n    Object.assign(chat, data);\n    await chat.save();\n    // TODO: Move to BaseModel\n    Event.emit('chatUpdated', chat);\n  }\n\n  static async createChat(data) {\n    if (!data) {\n      data = {};\n    }\n    if (!data.title) {\n      data.title = 'Untitled';\n    }\n    if (!data.model) {\n      data.model = Settings.getModel();\n    }\n    const chat = await new Chat(data).create();\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatCreated', chat);\n    Event.emit('chatSelected', chat);\n    return chat;\n  }\n\n  static async deleteChatMessage(messageId) {\n    const message = await ChatMessage.get(messageId);\n    message.delete();\n  }\n\n  static async deleteChat(chat) {\n    await chat.delete();\n    if (Settings.getCurrentChatId() === chat.id) {\n      Settings.setCurrentChatId(null);\n    }\n    Event.emit('chatDeleted', chat);\n  }\n\n  static async getCurrentChat() {\n    const chatId = this.getCurrentChatId();\n    if (chatId) {\n      return await Chat.get(chatId);\n    }\n    return null;\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static async setCurrentChat(chat) {\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatSelected', chat);\n  }\n\n  static async setCurrentChatId(chatId) {\n    const chat = await Chat.get(chatId);\n    if (chat) {\n      await this.setCurrentChat(chat);\n    }\n  }\n\n  static async clearChats() {\n    Settings.setCurrentChatId(null);\n    await Chat.clear();\n    Event.emit('chatsCleared');\n  }\n}\n","import { AppController } from './AppController.js';\n\nexport class ChatListItem {\n  constructor(chat, chatList, selected) {\n    this.chat = chat;\n    this.chatList = chatList;\n    this.content = document\n      .getElementById('chat-list-item-template')\n      .content.cloneNode(true);\n    this.element = this.content.querySelector('.chat-list-item');\n    this.element.title = this.chat.title;\n    this.element.data = { id: this.chat.id };\n    this.element.classList.add(`chat${this.chat.id}`);\n    if (selected === true) {\n      this.element.classList.add('selected');\n      // this.content.querySelector('.icon-selected').classList.remove('hidden')\n    }\n    this.setTitle();\n    this.bindEventListeners();\n  }\n\n  render() {}\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', this.onMouseover.bind(this));\n    this.element.addEventListener('mouseout', this.onMouseout.bind(this));\n    this.element.addEventListener('click', this.onClick.bind(this));\n    this.element\n      .querySelector('.list-item-delete')\n      .addEventListener('click', this.deleteChat.bind(this));\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n\n  onClick() {\n    this.chatList.selectChat(this.chat.id);\n  }\n\n  setTitle() {\n    const chatTitle = this.content.querySelector('.chat-title');\n    chatTitle.textContent = this.chat.title;\n  }\n\n  deleteChat() {\n    AppController.deleteChat(this.chat);\n    this.element.remove();\n  }\n}\n","export class DragAndDrop {\n  constructor(selector) {\n    this.listItems = document.querySelectorAll(selector);\n    this.draggedItem = null;\n    this.initializeDragAndDrop();\n  }\n\n  initializeDragAndDrop() {\n    this.listItems.forEach((item) => {\n      item.addEventListener('dragstart', this.handleDragStart.bind(this, item));\n      item.addEventListener('dragover', this.handleDragOver.bind(this));\n      item.addEventListener('drop', this.handleDrop.bind(this, item));\n      item.addEventListener('dragend', this.handleDragEnd.bind(this));\n    });\n  }\n\n  handleDragStart(item) {\n    this.draggedItem = item;\n  }\n\n  handleDragOver(e) {\n    e.preventDefault();\n  }\n\n  handleDrop(item) {\n    if (item !== this.draggedItem) {\n      let currentHTML = item.innerHTML;\n      item.innerHTML = this.draggedItem.innerHTML;\n      this.draggedItem.innerHTML = currentHTML;\n      console.debug('dnd drop');\n    }\n  }\n\n  handleDragEnd() {\n    this.draggedItem = null;\n  }\n}\n","import { Event } from './Event.js';\nimport { ChatListItem } from './ChatListItem.js';\nimport { DragAndDrop } from './DragAndDrop.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatList {\n  constructor() {\n    this.element = document.getElementById('chat-list');\n    this.template = document.getElementById('chat-list-item-template').content;\n    this.bindEventListeners();\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n    });\n  }\n\n  bindEventListeners() {\n    Event.listen('chatCreated', this.handleChatCreated.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatsCleared', this.handleChatsCleared.bind(this));\n    Event.listen('chatUpdated', this.handleChatUpdated.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  async selectChat(chatId) {\n    await AppController.setCurrentChatId(chatId);\n  }\n\n  handleChatCreated(chat) {\n    this.appendChat(chat, true);\n  }\n\n  handleChatDeleted(chat) {\n    if (this.chat?.id === chat.id) {\n      this.chat = null;\n    }\n    this.element.querySelector(`.chat${chat.id}`)?.remove();\n  }\n\n  handleChatsCleared() {\n    const elements = this.element.querySelectorAll('.chat-list-item');\n    elements.forEach((element) => element.remove());\n  }\n\n  handleChatUpdated(chat) {\n    const listElement = this.element.querySelector(\n      `.chat${chat.id} .chat-title`,\n    );\n    if (listElement) {\n      listElement.textContent = chat.title;\n    }\n  }\n\n  handleChatSelected(chat) {\n    if (this.chat) {\n      const previousListElement = this.element.querySelector(\n        `.chat${this.chat.id}`,\n      );\n      if (previousListElement) {\n        previousListElement.classList.remove('selected');\n      }\n    }\n    const newListElement = this.element.querySelector(`.chat${chat.id}`);\n    if (newListElement) {\n      newListElement.classList.add('selected');\n    }\n    // Remember selected chat\n    this.chat = chat;\n  }\n\n  render() {\n    const currentChatId = AppController.getCurrentChatId();\n    this.element.innerHTML = '';\n    Chat.getAll().then((chats) => {\n      chats.forEach((chat) => {\n        const selected = chat.id === currentChatId;\n        this.appendChat(chat, selected);\n      });\n      new DragAndDrop('.chat-list-item');\n    });\n  }\n\n  appendChat(chat, selected) {\n    const chatListItem = new ChatListItem(chat, this, selected);\n    this.element.appendChild(chatListItem.element);\n    return chatListItem;\n  }\n}\n","import { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\nexport class DownloadChatsButton {\n  constructor() {\n    this.button = document.querySelector('#export-button');\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.button.addEventListener('click', () => {\n      this.exportChat();\n      this.exportChatMessages();\n    });\n  }\n\n  async exportChat() {\n    const request = await Chat.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chats.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n\n  async exportChatMessages() {\n    const request = await ChatMessage.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chat_messages.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n}\n","export class LocalStorage {\n  // Set a value in localStorage\n  set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Get a value from localStorage, return defaultValue if key doesn't exist\n  get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Remove a value from localStorage\n  remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n}\n","import { debounce } from './debounce.js';\nimport { Event } from './Event.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\nimport { ChatList } from './ChatList.js';\nimport { DownloadChatsButton } from './DownloadChatsButton.js';\nimport { LocalStorage } from './models/LocalStorage.js';\n\nexport class Sidebar {\n  constructor() {\n    this.settings = new LocalStorage();\n    this.chatList = new ChatList();\n    this.element = document.getElementById('sidebar');\n    this.newChatButton = this.element.querySelector('#new-chat-button');\n    this.clearButton = this.element.querySelector('#clear-button');\n    this.hamburgerButton = document.getElementById('hamburger-menu');\n    this.searchButton = document.getElementById('search-button');\n    this.downloadChatsButton = new DownloadChatsButton();\n    this.searchRow = document.getElementById('search-row');\n    this.searchInput = document.getElementById('search-input');\n    if (this.settings.get('sidebar-collapsed') === true) {\n      this.element.classList.add('collapsed');\n    }\n    this.bindEventListeners();\n  }\n\n  render() {\n    this.chatList.render();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    this.searchButton.addEventListener('click', this.toggleSearch.bind(this));\n    this.searchInput.addEventListener(\n      'keypress',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.searchInput.addEventListener(\n      'keyup',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.newChatButton.addEventListener('click', this.handleNewChat.bind(this));\n    this.clearButton.addEventListener('click', this.handleClear.bind(this));\n    this.hamburgerButton.addEventListener('click', this.toggle.bind(this));\n  }\n\n  // TODO: Fix\n  handleChatSelected = (chat) => {\n    const listItem = this.element.querySelector(`chat${chat.id}`);\n    if (listItem) {\n      listItem.scrollIntoView({\n        behavior: 'smooth',\n        block: 'start', // \"start\" will bring the top of the element into view\n        inline: 'nearest', // \"nearest\" will scroll to the nearest edge if partially visible\n      });\n    }\n  };\n\n  toggleSearch() {\n    const searchRow = document.getElementById('search-row');\n    searchRow.classList.toggle('hidden');\n    this.searchInput.focus();\n  }\n\n  performSearch() {\n    function escapeRegExp(string) {\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // Escapes special characters\n    }\n    const query = escapeRegExp(this.searchInput.value.trim()).replace(\n      /\\s+/g,\n      '.*',\n    );\n    const queryContent = query.length > 2; // Nobody wants to query content based on one character?\n    const regex = new RegExp(query, 'i'); // 'i' for case-insensitive matching\n    console.log(`Search ${query}`);\n    Chat.getAll().then((chats) => {\n      const matches = chats\n        .filter((chat) => {\n          let match = regex.test(chat.title);\n          if (queryContent) {\n            match ||= regex.test(chat.content);\n          }\n          return match;\n        })\n        .map((chat) => chat.id);\n      this.element.querySelectorAll('.chat-list-item').forEach((item) => {\n        if (matches.includes(item.data.id)) {\n          // Now matches the type\n          item.classList.remove('hidden');\n        } else {\n          item.classList.add('hidden');\n        }\n      });\n    });\n  }\n\n  toggle() {\n    this.element.classList.toggle('collapsed');\n    this.hamburgerButton.classList.toggle('collapsed');\n    if (this.element.classList.contains('collapsed')) {\n      this.settings.set('sidebar-collapsed', true);\n    } else {\n      this.settings.set('sidebar-collapsed', false);\n    }\n  }\n\n  async handleNewChat() {\n    await AppController.createChat();\n  }\n\n  async handleClear() {\n    await AppController.clearChats();\n  }\n}\n","export class CopyButton {\n  constructor() {\n    document.addEventListener('click', function (event) {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('copy-button')) {\n        const targetSelector = event.target.getAttribute('data-target');\n        const textToCopy = document.getElementById(targetSelector).innerText;\n        // Create a temporary textarea element\n        const textarea = document.createElement('textarea');\n        textarea.value = textToCopy;\n        document.body.appendChild(textarea);\n\n        // Select the text and copy it\n        textarea.select();\n        document.execCommand('copy');\n\n        // Remove the temporary textarea\n        document.body.removeChild(textarea);\n\n        // Optional: Display a message or change the button text/content\n        alert('Text copied to clipboard');\n      }\n    });\n  }\n}\n","export class OllamaApi {\n  constructor() {\n    this.abortController = null;\n  }\n\n  async send(url, data, onResponse, onError, onDone) {\n    const request = { data };\n    try {\n      const response = await this.postChatMessage(url, data);\n      await this.handleResponse(request, response, onResponse, onDone);\n    } catch (error) {\n      onError(request, error);\n    }\n  }\n\n  async postChatMessage(url, data) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n    const response = await fetch(url, {\n      signal,\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      throw new Error(`${url} failed with status ${response.status}`);\n    }\n\n    return response;\n  }\n\n  async handleResponse(request, response, onResponse, onDone) {\n    const reader = response.body.getReader();\n    let partialLine = '';\n    var isRequestDone = false;\n\n    while (!isRequestDone) {\n      const { done, value } = await reader.read();\n      if (done) {\n        onDone(request, response);\n        isRequestDone = true;\n        continue;\n      }\n\n      const textChunk = new TextDecoder().decode(value);\n      const lines = (partialLine + textChunk).split('\\n');\n      partialLine = lines.pop();\n\n      lines.forEach((line) => {\n        const responseData = JSON.parse(line);\n        if (line.trim()) {\n          // TODO: Move this line:\n          this.printResponseStats(responseData);\n          onResponse(request, responseData.message.content);\n        }\n      });\n    }\n\n    if (partialLine.trim()) {\n      onResponse(request, partialLine);\n    }\n  }\n\n  abort() {\n    if (this.abortController) {\n      this.abortController.abort();\n    }\n  }\n\n  printResponseStats(data) {\n    if (!data.total_duration) {\n      return;\n    }\n    // Convert nanoseconds to seconds for durations\n    const totalDurationInSeconds = data.total_duration / 1e9;\n    const loadDurationInSeconds = data.load_duration / 1e9;\n    const promptEvalDurationInSeconds = data.prompt_eval_duration / 1e9;\n    const responseEvalDurationInSeconds = data.eval_duration / 1e9;\n\n    // Calculate tokens per second (token/s)\n    const tokensPerSecond = data.eval_count / responseEvalDurationInSeconds;\n    const output = `\nModel: ${data.model}\nCreated At: ${data.created_at}\nTotal Duration (s): ${totalDurationInSeconds.toFixed(2)}\nLoad Duration (s): ${loadDurationInSeconds.toFixed(2)}\nPrompt Evaluation Count: ${data.prompt_eval_count}\nPrompt Evaluation Duration (s): ${promptEvalDurationInSeconds.toFixed(2)}\nResponse Evaluation Count: ${data.eval_count}\nResponse Evaluation Duration (s): ${responseEvalDurationInSeconds.toFixed(2)}\nTokens Per Second: ${tokensPerSecond.toFixed(2)} token/s\n    `;\n    console.log(output);\n  }\n\n  static getModels(url, onResponse) {\n    if (!url) {\n      return null;\n    }\n\n    return fetch(url)\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error(`Unable to fetch models from ${url}`);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        onResponse(data.models);\n      })\n      .catch((error) => {\n        console.debug(error);\n        console.error(\n          `Please ensure the server is running at: ${url}. Error code: 39847`,\n        );\n        onResponse([]);\n      });\n  }\n}\n","export class DownloadButton {\n  constructor() {\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('download-button')) {\n        // Get the index from the data-target attribute\n        const targetId = event.target.getAttribute('data-target');\n        this.downloadElementContent(targetId, 'chat.html');\n      }\n    });\n  }\n\n  downloadElementContent(elementId, filename) {\n    // Get the element\n    const element = document.getElementById(elementId);\n    if (!element) {\n      console.error('Element not found');\n      return;\n    }\n\n    // Get the contents of the element\n    const content = element.innerText;\n\n    // Create a Blob with the content\n    const blob = new Blob([content], { type: 'text/html' });\n\n    // Create an anchor element and set the href to the blob\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = filename;\n\n    // Append the anchor to the document, trigger a click, and then remove it\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n\n    // Revoke the blob URL\n    URL.revokeObjectURL(a.href);\n  }\n}\n","export class DropDownMenu {\n  constructor() {\n    this.buttonSelector = '.drop-down-menu';\n    this.dropDownMenus = document.querySelectorAll(this.buttonSelector);\n    this.init();\n  }\n\n  init() {\n    // Add a click listener to the whole document\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element or any of its parents has the 'drop-down-menu' class\n      const menuElement = event.target.closest(this.buttonSelector);\n      if (menuElement) {\n        const dropDownMenu = menuElement.querySelector('.drop-down-menu-items');\n        if (dropDownMenu) {\n          this.toggleMenu(dropDownMenu);\n        }\n      }\n    });\n  }\n\n  toggleMenu(menu) {\n    menu.classList.toggle('hidden');\n    menu.classList.toggle('visible');\n  }\n}\n","// Modal base class\nexport class Modal {\n  constructor(domId) {\n    this.domId = domId;\n    this.modal = document.getElementById(this.domId);\n    this.closeButton = this.modal.querySelector('.button-close');\n    this.closeButton.onclick = () => this.hide();\n    this._bindEventListeners();\n  }\n\n  _bindEventListeners() {\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  show() {\n    this.handleShow();\n  }\n\n  hide() {\n    this.handleHide();\n  }\n\n  handleShow() {\n    this.modal.classList.add('show');\n  }\n\n  handleHide() {\n    this.modal.classList.remove('show');\n  }\n}\n","export class List {\n  constructor(containerId, items, selected) {\n    this.container = document.getElementById(containerId);\n    this.items = items;\n    this.selected = selected;\n    this.render();\n    this.clickHandler = null;\n  }\n\n  onClick(handler) {\n    this.clickHandler = handler;\n    return this; // Allow chaining\n  }\n\n  setItems(items) {\n    this.items = items;\n    this.render();\n  }\n\n  setSelected(selected) {\n    console.debug(`Select ${selected}`);\n    this.selected = selected;\n    this.render();\n  }\n\n  getSelected() {\n    return this.selected;\n  }\n\n  render() {\n    this.container.innerHTML = ''; // Clear existing content\n    const ul = document.createElement('ul');\n    ul.classList.add('list');\n    this.items.forEach((item) => {\n      const li = document.createElement('li');\n      li.classList.add('list-item');\n      if (item === this.selected) {\n        li.classList.add('selected');\n      }\n      li.textContent = item;\n      li.item = item;\n      li.addEventListener('click', () => {\n        this.setSelected(item);\n        if (this.clickHandler) {\n          this.clickHandler(item);\n        }\n      });\n      ul.appendChild(li);\n    });\n    this.container.appendChild(ul);\n  }\n}\n","import { Event } from '../Event.js';\nimport { Settings } from './Settings.js';\nimport { OllamaApi } from '../OllamaApi.js';\n\nexport class Models {\n  static models = [];\n\n  static getUrl() {\n    return Settings.getUrl('/api/tags');\n  }\n\n  static load() {\n    if (!this.getUrl()) {\n      return null;\n    }\n    return OllamaApi.getModels(this.getUrl(), (models) => {\n      Models.models = models;\n      Settings.set('models', Models.models);\n      Event.emit('modelsLoaded', Models.models);\n    });\n  }\n\n  static getAll() {\n    return Models.models;\n  }\n\n  static getNames() {\n    return Models.models.map((model) => model.name);\n  }\n\n  static findModelByName(name) {\n    return Models.models.find((model) => model.name === name);\n  }\n}\n","import { List } from './List.js';\nimport { Event } from './Event.js';\nimport { Models } from './models/Models.js';\n\nexport class ModelsList {\n  constructor(selector, selectedModel) {\n    this.modelList = new List(selector, Models.getNames(), selectedModel);\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    Event.listen('modelsLoaded', this.handleModelsLoaded.bind(this));\n  }\n\n  handleModelsLoaded() {\n    this.modelList.setItems(Models.getNames());\n  }\n\n  onClick(handler) {\n    this.modelList.clickHandler = handler;\n    return this.modelList; // Allow chaining\n  }\n\n  getSelected() {\n    return this.modelList.selected;\n  }\n}\n","import { Modal } from './Modal.js';\nimport { UINotification } from './UINotification.js';\nimport { ModelsList } from './ModelsList.js';\nimport { Models } from './models/Models.js';\nimport { Settings } from './models/Settings.js';\n\nexport class SettingsDialog extends Modal {\n  constructor() {\n    super('settings-dialog');\n    this.showButton = document.getElementById('settings-button');\n    this.urlInput = document.getElementById('input-url');\n    this.modelInput = document.getElementById('input-model');\n    this.systemPromptInput = this.modal.querySelector('#input-system-prompt');\n    this.modelParametersInput = this.modal.querySelector(\n      '#input-model-parameters',\n    );\n    this.refreshModelsButton = this.modal.querySelector(\n      '.refresh-models-button',\n    );\n    this.modelList = new ModelsList('model-list', Settings.getModel());\n    this.bindEventListeners();\n    this.loadSettings();\n  }\n\n  bindEventListeners() {\n    this.urlInput.addEventListener('blur', () => {\n      const value = this.urlInput.value.trim();\n      Settings.setUrl(value);\n    });\n    this.systemPromptInput.addEventListener('blur', () => {\n      Settings.setSystemPrompt(this.systemPromptInput.value.trim());\n    });\n    this.modelParametersInput.addEventListener('blur', () => {\n      const value = this.modelParametersInput.value.trim();\n      if (value === '') {\n        return;\n      }\n      try {\n        const parsedValue = JSON.parse(value);\n        const prettyJSON = JSON.stringify(parsedValue, 2);\n        Settings.setModelParameters(parsedValue);\n        this.modelParametersInput.value = prettyJSON;\n        this.modelParametersInput.classList.remove('error');\n      } catch (error) {\n        if (error.name === 'SyntaxError') {\n          this.modelParametersInput.classList.add('error');\n        } else {\n          console.error(error);\n        }\n      }\n    });\n    this.modelList.onClick(() => {\n      Settings.setModel(this.modelList.getSelected());\n    });\n    this.showButton.addEventListener('click', this.show.bind(this));\n    this.refreshModelsButton.onclick = () => this.refreshModels();\n    this.closeButton.onclick = () => this.hide();\n  }\n\n  show() {\n    Models.load();\n    this.handleShow();\n  }\n\n  refreshModels() {\n    if (!Models.getUrl()) {\n      UINotification.show('Please update the URL in the settings to continue.');\n    } else {\n      Models.load();\n    }\n  }\n\n  loadSettings() {\n    this.urlInput.value = Settings.getUrl();\n    const modelParameters = Settings.getModelParameters();\n    if (modelParameters) {\n      this.modelParametersInput.value = JSON.stringify(modelParameters, 2);\n    }\n  }\n}\n","import { AppController } from './AppController.js';\nimport { Event } from './Event.js';\nimport { Modal } from './Modal.js';\nimport { Models } from './models/Models.js';\nimport { ModelsList } from './ModelsList.js';\n\nexport class ChatSettingsDialog extends Modal {\n  constructor() {\n    super('chat-settings-dialog');\n    this.showButton = document.getElementById('chat-settings-button');\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.showButton.addEventListener('click', this.show.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  show() {\n    Models.load().then(() => {\n      AppController.getCurrentChat().then((chat) => {\n        this.handleChatSelected(chat);\n        this.handleShow();\n      });\n    });\n  }\n\n  handleChatSelected(chat) {\n    this.modelList = new ModelsList('chat-model-list', chat.model);\n    this.modelList.onClick(async (model) => {\n      chat.model = model;\n      await chat.save();\n    });\n  }\n}\n","export class Hoverable {\n  constructor(element) {\n    this.element = element;\n    element.hoverable = this;\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', () => this.onMouseover());\n    this.element.addEventListener('mouseout', () => this.onMouseout());\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n}\n","import { Event } from './Event.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatTitle {\n  constructor() {\n    this.defaultTitle = 'Untitled';\n    this.element = document.getElementById('chat-title');\n    this.bindEventListeners();\n    this.render();\n  }\n\n  render() {\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.setTitle(chat?.title);\n    });\n  }\n\n  setTitle(title) {\n    this.element.textContent = title || this.defaultTitle;\n  }\n\n  focus() {\n    const hasFocus = document.activeElement === this.element;\n    if (!hasFocus) {\n      this.element.focus();\n    }\n  }\n\n  bindEventListeners() {\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    this.element.addEventListener('blur', this.handleSave.bind(this));\n    this.element.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        this.element.blur();\n      }\n    });\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.setTitle(chat.title);\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat.id) {\n      this.setTitle(this.defaultTitle);\n    }\n  }\n\n  async handleSave() {\n    let title = this.element.textContent.trim();\n    if (title.length === 0) {\n      title = this.defaultTitle;\n      this.element.classList.add('error');\n    } else {\n      this.element.classList.remove('error');\n    }\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.updateChat(chat, { title });\n    } else {\n      await AppController.createChat({ title });\n    }\n  }\n}\n","// TODO: Move code here from App.js\nexport class ChatForm {\n  constructor() {\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n  }\n}\n","import { AppController } from './AppController.js';\nimport { Event } from './Event.js';\nimport { Hoverable } from './Hoverable.js';\nimport { ChatTitle } from './ChatTitle.js';\nimport { ChatForm } from './ChatForm.js';\n\nexport class ChatArea {\n  constructor() {\n    this.chatTitle = new ChatTitle();\n    this.chatForm = new ChatForm();\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.editChatButton = document.getElementById('edit-chat-button');\n    this.scrollToTopButton = document.getElementById('scroll-to-top-button');\n    this.scrollToEndButton = document.getElementById('scroll-to-end-button');\n    this.deleteChatButton = document.getElementById('delete-chat-button');\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.render();\n    });\n    this.bindEventListeners();\n  }\n\n  render() {\n    // Clear history view\n    this.chatHistory.innerText = '';\n    // Render chat history\n    this.chat?.getMessages()?.then((messages) => {\n      messages.forEach((message) => {\n        this.createMessageDiv(message);\n      });\n    });\n    this.scrollToEnd();\n    this.messageInput.focus();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    this.scrollToTopButton.addEventListener(\n      'click',\n      this.scrollToTop.bind(this),\n    );\n    this.scrollToEndButton.addEventListener(\n      'click',\n      this.scrollToEnd.bind(this),\n    );\n    this.editChatButton.addEventListener(\n      'click',\n      this.handleEditChat.bind(this),\n    );\n    this.deleteChatButton.addEventListener(\n      'click',\n      this.handleDeleteChat.bind(this),\n    );\n    this.currentMessage = this.chatHistory.querySelector('.selected');\n    // Select chat message with arrow up and arrow down keys\n    document.addEventListener('keydown', (event) => {\n      let next, previous;\n\n      if (event.key === 'ArrowDown') {\n        next = this.currentMessage ? this.currentMessage.nextElementSibling : this.chatHistory.firstElementChild;\n        if (next) {\n          if (this.currentMessage) this.currentMessage.classList.remove('hover');\n          next.classList.add('hover');\n          this.currentMessage = next; // Update currentMessage\n          this.currentMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); // Scroll into view\n        }\n      } else if (event.key === 'ArrowUp') {\n        previous = this.currentMessage ? this.currentMessage.previousElementSibling : this.chatHistory.lastElementChild;\n        if (previous) {\n          if (this.currentMessage) this.currentMessage.classList.remove('hover');\n          previous.classList.add('hover');\n        }\n        this.currentMessage = previous; // Update currentMessage\n        this.currentMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); // Scroll into view\n      }\n    });\n  }\n\n  createMessageDiv(message) {\n    const role = message.role;\n    const content = message.content;\n    // Get the template and its content\n    const template = document.getElementById('chat-message-template');\n    const messageClone = template.content.cloneNode(true);\n    // Find the div and span elements within the cloned template\n    const messageDiv = messageClone.querySelector('.chat-message');\n    const textSpan = messageClone.querySelector('.chat-message-text');\n    const deleteButton = messageClone.querySelector(\n      '.delete-chat-message-button',\n    );\n\n    // Set the class for role and text content\n    messageDiv.classList.add(`${role}-chat-message`);\n    textSpan.textContent = content;\n    messageDiv.spellcheck = false;\n\n    // Append to chatHistory and adjust scroll\n    this.chatHistory.appendChild(messageDiv);\n    messageDiv.dataset['id'] = message.id;\n    new Hoverable(messageDiv);\n    deleteButton.addEventListener('click', async () => {\n      await AppController.deleteChatMessage(message.id);\n      messageDiv.remove();\n    });\n    return messageDiv;\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat?.id) {\n      this.chat = null;\n    } else {\n      this.chat = chat;\n    }\n    this.render();\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.render();\n  }\n\n  handleEditChat() {\n    this.chatTitle.focus();\n    event.stopPropagation();\n  }\n\n  async handleDeleteChat() {\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.deleteChat(chat);\n    }\n  }\n\n  scrollToTop() {\n    this.chatHistory.scrollTop = 0;\n  }\n\n  scrollToEnd() {\n    this.chatHistory.scrollTop = this.chatHistory.scrollHeight;\n  }\n}\n","import { UINotification } from './UINotification.js';\nimport { Settings } from './models/Settings.js';\nimport { Event } from './Event.js';\nimport { DOM } from './Dom.js';\nimport { Sidebar } from './Sidebar.js';\nimport { AppController } from './AppController.js';\nimport { CopyButton } from './CopyButton.js';\nimport { OllamaApi } from './OllamaApi.js';\nimport { DownloadButton } from './DownloadButton.js';\nimport { DropDownMenu } from './DropDownMenu.js';\nimport { SettingsDialog } from './SettingsDialog.js';\nimport { ChatSettingsDialog } from './ChatSettingsDialog.js';\n// import { MarkdownFormatter } from './MarkdownFormatter.js'\nimport { ChatArea } from './ChatArea.js';\n\n// TODO: Review and refactor\nexport class App {\n  static run() {\n    UINotification.initialize();\n    const app = new App();\n    return app;\n  }\n\n  constructor() {\n    this.sidebar = new Sidebar();\n    this.chatArea = new ChatArea();\n    this.ollamaApi = new OllamaApi();\n    this.settingsDialog = new SettingsDialog();\n    this.chatSettingsDialog = new ChatSettingsDialog();\n    this.downloadButton = new DownloadButton();\n    this.copyButton = new CopyButton();\n    this.dropDownMenu = new DropDownMenu();\n    this.initializeElements();\n    this.bindEventListeners();\n    this.logInitialization();\n    this.render();\n  }\n\n  initializeElements() {\n    // this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n    this.messageInput = document.getElementById('message-input');\n    this.chatHistory = document.getElementById('chat-history');\n  }\n\n  logInitialization() {\n    const msg = `~~~~\\nChat\\n~~~~\nModel:       ${Settings.getModel()}\nURL:         ${Settings.getUrl()}\nChat:        ${Settings.getCurrentChatId()}\nParameters:  ${JSON.stringify(Settings.getModelParameters())}\n`;\n    console.log(msg);\n  }\n\n  render() {\n    this.sidebar.render();\n    this.chatArea.render();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    // this.sendButton.addEventListener('click', this.sendMessage.bind(this));\n    this.abortButton.addEventListener('click', this.handleAbort.bind(this));\n    this.messageInput.addEventListener(\n      'keypress',\n      this.handleKeyPress.bind(this),\n    );\n  }\n\n  handleChatSelected = (chat) => {\n    window.history.pushState({}, '', `/chats/${chat.id}`);\n  };\n\n  handleAbort = () => {\n    this.ollamaApi.abort();\n    this.enableForm();\n    console.log('Request aborted');\n  };\n\n  handleKeyPress = (event) => {\n    if (event.key === 'Enter' && !event.shiftKey) {\n      this.sendMessage();\n    }\n  };\n\n  enableForm() {\n    DOM.hideElement(this.abortButton).enableInput(this.messageInput);\n    this.messageInput.focus();\n  }\n\n  disableForm() {\n    DOM.showElement(this.abortButton).disableInput(this.messageInput);\n  }\n\n  // https://github.com/jmorganca/ollama/blob/main/docs/api.md#generate-a-completion\n  async sendMessage() {\n    const userMessage = this.messageInput.value.trim();\n    // Get the current chat\n    let chat = await AppController.getCurrentChat();\n    const url = Settings.getUrl('/api/chat');\n    if (!url) {\n      UINotification.show(\n        'Please update the URL in the settings to continue. ',\n      );\n      return null;\n    }\n    if (userMessage) {\n      // Reset input\n      this.messageInput.value = '';\n      // Create new chat\n      if (!chat) {\n        chat = await AppController.createChat({\n          title: 'Untitled',\n          model: Settings.getModel(),\n        });\n      }\n      // Store user message\n      await chat.addMessage({\n        role: 'user',\n        content: userMessage,\n      });\n      const systemPrompt = Settings.getSystemPrompt();\n      const modelParameters = Settings.getModelParameters();\n      // Disable form\n      this.disableForm();\n      // Create user message\n      this.createChatMessage({ content: userMessage, role: 'user' });\n      // Create system message container\n      const responseElement = this.createChatMessage({\n        content: '',\n        role: 'system',\n      });\n      const requestContext = {\n        chat,\n        content: '', // TODO: Move this to the response?\n        responseElement,\n      };\n      const requestData = {\n        prompt: userMessage,\n        model: chat.model,\n        messages: (await chat.getMessages()).map((message) => ({\n          role: message.role,\n          content: message.content,\n        })),\n      };\n      // Add system prompt\n      if (systemPrompt) {\n        requestData.system = systemPrompt;\n      }\n      // Add model parameters\n      if (modelParameters) {\n        requestData.options = modelParameters;\n      }\n      // Show spinner\n      responseElement.innerHTML = '<div class=\"waiting\"></div>';\n      // Make request\n      this.ollamaApi.send(\n        url,\n        requestData,\n        (request, response) =>\n          this.handleResponse(request, response, requestContext),\n        (request, error) => this.handleResponseError(request, error),\n        (request, response) =>\n          this.handleDone(request, response, requestContext),\n      );\n    }\n  }\n\n  createChatMessage(message) {\n    return this.chatArea.createMessageDiv(message);\n  }\n\n  handleResponse(request, response, context) {\n    const responseElement = context.responseElement;\n    const sanitizedContent = this.sanitizeContent(response);\n    // Remember original response\n    context.content += sanitizedContent;\n    responseElement.textContent += sanitizedContent;\n    this.chatArea.scrollToEnd();\n  }\n\n  handleResponseError(request, error) {\n    // Ignore \"Abort\" button\n    if (error.name !== 'AbortError') {\n      console.error(`Error: ${error.message}`);\n    }\n    this.chatArea.scrollToEnd();\n    this.enableForm();\n  }\n\n  async handleDone(request, response, context) {\n    const chat = context.chat;\n    console.log(`Chat ${chat.id} done`);\n    await chat.addMessage({\n      role: 'assistant',\n      content: context.content,\n    });\n    this.enableForm();\n  }\n\n  sanitizeContent = (content) => {\n    // TODO: Sanitization logic here\n    return content;\n  };\n\n  getIdParam = () => {\n    return new URL(window.location.href).pathname.split('/').pop();\n  };\n}\n","import { App } from './App.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\n// TODO: refactor\nasync function initialize() {\n  await Chat.initialize();\n  await ChatMessage.initialize();\n}\n\ninitialize().then(() => {\n  App.run();\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}