{"version":3,"sources":["js/UINotification.js","js/models/Settings.js","js/Event.js","js/Dom.js","js/debounce.js","js/Database.js","js/Migrations.js","js/models/BaseModel.js","js/models/ChatMessage.js","js/models/Chat.js","js/AppController.js","js/ChatListItem.js","js/DragAndDrop.js","js/ChatList.js","js/DownloadChatsButton.js","js/models/LocalStorage.js","js/Sidebar.js","js/CopyButton.js","js/OllamaApi.js","js/DownloadButton.js","js/DropDownMenu.js","js/Modal.js","js/List.js","js/models/Models.js","js/ModelsList.js","js/SettingsDialog.js","js/ChatSettingsDialog.js","js/Hoverable.js","js/ChatTitle.js","js/ChatForm.js","js/ChatArea.js","js/App.js","js/script.js","../../../../../usr/local/lib/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["simpleHash","str","hash","i","length","char","charCodeAt","UINotification","constructor","message","type","id","JSON","stringify","domId","container","document","body","template","getElementById","content","_bindEventListeners","window","addEventListener","event","key","hide","show","notification","initialize","originalConsoleError","console","error","_len","arguments","args","Array","_key","apply","handleApplicationError","debug","clone","cloneNode","notificationElement","querySelector","textContent","classList","add","closeButton","onclick","appendChild","remove","exports","Settings","set","value","stringValue","localStorage","setItem","e","get","defaultValue","undefined","getItem","parse","removeItem","getUrl","uri","baseUrl","URL","href","setUrl","url","getModel","setModel","model","getSystemPrompt","setSystemPrompt","systemPrompt","getModelParameters","setModelParameters","modelParameters","getCurrentChatId","setCurrentChatId","chatId","Event","listen","eventName","handler","detail","emit","data","log","CustomEvent","bubbles","dispatchEvent","DOM","toggle","element","contains","setTimeout","showElement","hideElement","enableInput","removeAttribute","disableInput","setAttribute","debounce","func","wait","timeout","funcWrapper","later","clearTimeout","Database","dbName","objectStores","migrations","dbConnection","open","Error","Promise","resolve","reject","request","indexedDB","version","onerror","target","onupgradeneeded","db","result","transaction","currentTarget","upgrade","oldVersion","onsuccess","storeName","mode","objectStore","store","handleRequest","put","delete","getAll","clear","Migrations","database","funcName","upgradeFunc","upgradeToVersion2","context","createObjectStore","keyPath","autoIncrement","chatMessages","createIndex","unique","_Database","require","_Migrations","BaseModel","Object","assign","name","create","save","records","map","getAllByIndexAndId","indexName","index","messages","export","_BaseModel","ChatMessage","getAllByChatId","_ChatMessage","Chat","addMessage","getMessages","chat","_Event","_Chat","_Settings","AppController","updateChat","createChat","title","deleteChatMessage","messageId","deleteChat","getCurrentChat","setCurrentChat","clearChats","_AppController","ChatListItem","chatList","selected","setTitle","bindEventListeners","render","onMouseover","bind","onMouseout","onClick","selectChat","chatTitle","DragAndDrop","selector","listItems","querySelectorAll","draggedItem","initializeDragAndDrop","forEach","item","handleDragStart","handleDragOver","handleDrop","handleDragEnd","preventDefault","currentHTML","innerHTML","_ChatListItem","_DragAndDrop","ChatList","then","handleChatCreated","handleChatDeleted","handleChatsCleared","handleChatUpdated","handleChatSelected","appendChat","elements","listElement","previousListElement","newListElement","currentChatId","chats","chatListItem","DownloadChatsButton","button","exportChat","exportChatMessages","jsonData","blob","Blob","createObjectURL","a","createElement","download","click","revokeObjectURL","errorCode","LocalStorage","_debounce","_Dom","_ChatList","_DownloadChatsButton","_LocalStorage","Sidebar","settings","newChatButton","clearButton","hamburgerButton","searchButton","downloadChatsButton","searchRow","searchInput","toggleSearch","performSearch","handleNewChat","handleClear","listItem","scrollIntoView","behavior","block","inline","focus","escapeRegExp","string","replace","query","trim","queryContent","regex","RegExp","matches","filter","match","test","includes","CopyButton","targetSelector","getAttribute","textToCopy","innerText","textarea","select","execCommand","removeChild","alert","OllamaApi","abortController","send","onResponse","onError","onDone","response","postChatMessage","handleResponse","AbortController","signal","fetch","method","headers","ok","status","reader","getReader","partialLine","isRequestDone","done","read","textChunk","TextDecoder","decode","lines","split","pop","line","responseData","printResponseStats","abort","total_duration","totalDurationInSeconds","loadDurationInSeconds","load_duration","promptEvalDurationInSeconds","prompt_eval_duration","responseEvalDurationInSeconds","eval_duration","tokensPerSecond","eval_count","output","created_at","toFixed","prompt_eval_count","getModels","json","models","catch","DownloadButton","targetId","downloadElementContent","elementId","filename","DropDownMenu","buttonSelector","dropDownMenus","init","menuElement","closest","dropDownMenu","Modal","modal","handleShow","handleHide","List","containerId","items","clickHandler","setItems","setSelected","getSelected","ul","li","_OllamaApi","Models","load","getNames","findModelByName","find","_List","_Models","ModelsList","selectedModel","modelList","handleModelsLoaded","_Modal","_UINotification","_ModelsList","SettingsDialog","showButton","urlInput","modelInput","systemPromptInput","modelParametersInput","refreshModelsButton","loadSettings","parsedValue","prettyJSON","refreshModels","ChatSettingsDialog","Hoverable","hoverable","ChatTitle","defaultTitle","hasFocus","activeElement","handleSave","blur","ChatForm","chatHistory","messageInput","sendButton","abortButton","_Hoverable","_ChatTitle","_ChatForm","ChatArea","chatForm","editChatButton","scrollToTopButton","scrollToEndButton","deleteChatButton","createMessageDiv","scrollToEnd","scrollToTop","handleEditChat","handleDeleteChat","currentMessage","next","previous","nextElementSibling","firstElementChild","previousElementSibling","lastElementChild","role","messageClone","messageDiv","textSpan","deleteButton","spellcheck","dataset","stopPropagation","scrollTop","scrollHeight","_Sidebar","_CopyButton","_DownloadButton","_DropDownMenu","_SettingsDialog","_ChatSettingsDialog","_ChatArea","App","run","app","sidebar","chatArea","ollamaApi","settingsDialog","chatSettingsDialog","downloadButton","copyButton","initializeElements","logInitialization","msg","handleAbort","handleKeyPress","history","pushState","enableForm","shiftKey","sendMessage","disableForm","userMessage","createChatMessage","responseElement","requestContext","requestData","prompt","system","options","handleResponseError","handleDone","sanitizedContent","sanitizeContent","getIdParam","location","pathname","_App","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","protocol","ws","onmessage","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","hmrApply","v","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","stack","overlay","createErrorOverlay","stackTrace","getParents","modules","parents","k","d","dep","isArray","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"script.d573be0b.js","sourceRoot":"..","sourcesContent":["function simpleHash(str) {\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return hash;\n}\n\n// Show all uncaught errors as UI notifications\n/*\nwindow.onerror = function (message, source, lineno, colno, error) {\n  const errorDetails = `${message} at ${source}:${lineno}:${colno}`;\n  UINotification.show(errorDetails, 'error');\n  return true;\n};\n*/\n\nexport class UINotification {\n  constructor(message, type) {\n    const id = simpleHash(JSON.stringify(message));\n    this.type = type;\n    this.domId = `notification-${id}`;\n    this.container = document.body;\n    this.template = document.getElementById('notification-template').content;\n    this._bindEventListeners();\n  }\n\n  _bindEventListeners() {\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  static show(message, type) {\n    const notification = new UINotification(message, type);\n    notification.show(message);\n  }\n\n  static initialize() {\n    // Store the original console.error function\n    const originalConsoleError = console.error;\n\n    // Override console.error\n    console.error = function (...args) {\n      UINotification.show(args);\n      // Call the original console.error with all arguments\n      originalConsoleError.apply(console, args);\n    };\n  }\n\n  static handleApplicationError(error) {\n    console.debug('caught error');\n    console.error(error);\n    UINotification.show(error);\n  }\n\n  show(message) {\n    // Clone the template\n    const clone = this.template.cloneNode(true);\n\n    // Find the root element of the notification in the clone\n    const notificationElement = clone.querySelector('.notification');\n    if (!notificationElement) {\n      console.error('Notification root element not found in template');\n      return;\n    }\n\n    // Set the message\n    clone.querySelector('.notification-message').textContent = message;\n\n    notificationElement.id = this.domId; // Set ID on the actual element, not the fragment\n    // Add type, for example, error\n    if (this.type) {\n      notificationElement.classList.add(`notification-${this.type}`);\n    }\n\n    // Add close functionality\n    const closeButton = clone.querySelector('.close-notification-button');\n    closeButton.onclick = () => this.hide();\n\n    // Don't show the same notification twice\n    if (!document.getElementById(this.domId)) {\n      // Append to the container and display\n      this.container.appendChild(clone);\n    }\n  }\n\n  hide() {\n    document.getElementById(this.domId)?.remove();\n  }\n}\n","export class Settings {\n  // Static method to set a value in localStorage\n  static set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Static method to get a value from localStorage\n  static get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Static method to remove a value from localStorage\n  static remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n\n  static getUrl(uri) {\n    try {\n      const baseUrl = Settings.get('url');\n      if (uri) {\n        return new URL(uri, baseUrl).href;\n      } else {\n        return baseUrl;\n      }\n    } catch (error) {\n      return null;\n    }\n  }\n\n  static setUrl(url) {\n    Settings.set('url', url);\n  }\n\n  static getModel() {\n    return Settings.get('model');\n  }\n\n  static setModel(model) {\n    Settings.set('model', model);\n  }\n\n  static getSystemPrompt() {\n    return Settings.get('system-prompt');\n  }\n\n  static setSystemPrompt(systemPrompt) {\n    if (systemPrompt === '') {\n      systemPrompt = null;\n    }\n    Settings.set('system-prompt', systemPrompt);\n  }\n\n  static getModelParameters() {\n    return Settings.get('model-parameters');\n  }\n\n  static setModelParameters(modelParameters) {\n    if (modelParameters === '') {\n      modelParameters = null;\n    }\n    Settings.set('model-parameters', modelParameters);\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static setCurrentChatId(chatId) {\n    if (chatId === undefined) {\n      chatId = null;\n    }\n    Settings.set('currentChatId', chatId);\n  }\n}\n","export class Event {\n  static listen(eventName, handler) {\n    window.addEventListener(eventName, (event) => {\n      handler(event.detail);\n    });\n  }\n\n  static emit(eventName, data) {\n    let log = `${eventName}`;\n    if (data?.id) {\n      log += ` id: ${data.id}`;\n    }\n    console.log(log);\n    const event = new CustomEvent(eventName, {\n      detail: data || {},\n      bubbles: true, // This makes the event bubble up through the DOM\n    });\n    window.dispatchEvent(event);\n  }\n}\n","export class DOM {\n  static toggle(element) {\n    if (element.classList.contains('hidden')) {\n      element.classList.remove('hidden');\n      element.classList.add('visible');\n    } else {\n      element.classList.remove('visible');\n      // Trigger fadeOut animation, then set display to none after the animation completes\n      element.classList.add('fade-out');\n      // Fade-out animation duration is 0.5s\n      setTimeout(() => {\n        element.classList.remove('fade-out');\n        element.classList.add('hidden');\n      }, 500);\n    }\n    return this;\n  }\n\n  static showElement(element) {\n    element.classList.remove('hidden');\n    element.classList.add('visible');\n    return this;\n  }\n\n  static hideElement(element) {\n    element.classList.add('hidden');\n    element.classList.remove('visible');\n    return this;\n  }\n\n  static enableInput(element) {\n    element.removeAttribute('disabled');\n    return this;\n  }\n\n  static disableInput(element) {\n    element.setAttribute('disabled', 'disabled');\n    return this;\n  }\n}\n","export function debounce(func, wait) {\n  let timeout;\n\n  return function funcWrapper(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n","export class Database {\n  constructor(dbName, objectStores, migrations) {\n    this.dbName = dbName;\n    this.objectStores = objectStores;\n    this.dbConnection = null; // Initialized in open\n    this.migrations = migrations;\n  }\n\n  async open() {\n    if (this.dbConnection) {\n      throw new Error('Connection already open');\n    }\n\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.migrations.version);\n\n      request.onerror = (event) => reject(event.target.error);\n      request.onupgradeneeded = (event) => {\n        const db = event.target.result;\n        const transaction = event.currentTarget.transaction;\n        this.migrations.upgrade(db, transaction, event.oldVersion);\n      };\n      request.onsuccess = (event) => {\n        this.dbConnection = event.target.result;\n        resolve(this.dbConnection);\n      };\n    });\n  }\n\n  async transaction(storeName, mode) {\n    return this.dbConnection\n      .transaction([storeName], mode)\n      .objectStore(storeName);\n  }\n\n  async add(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('add', store.add(data));\n  }\n\n  async get(storeName, id) {\n    const store = await this.transaction(storeName, 'readonly');\n    return this.handleRequest('get', store.get(id));\n  }\n\n  async put(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('put', store.put(data));\n  }\n\n  async delete(storeName, id) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('delete', store.delete(id));\n  }\n\n  async getAll(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('getAll', store.getAll());\n  }\n\n  async clear(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('deleteAll', store.clear());\n  }\n\n  handleRequest(type, request) {\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => resolve(request.result);\n\n      request.onerror = (event) => {\n        const error = `Database ${type} operation failed: ${event.target.error.message}`;\n        reject(new Error(JSON.stringify(error)));\n      };\n    });\n  }\n}\n","export class Migrations {\n  static version = 2;\n  static upgrade(database, transaction, oldVersion) {\n    console.debug(\n      `Migration needed. Old version ${oldVersion}. New version ${this.version}.`,\n    );\n    const funcName = `upgradeToVersion${this.version}`;\n    const upgradeFunc = this[funcName];\n    if (!upgradeFunc) {\n      throw new Error(`Upgrade function missing for ${funcName}`);\n    }\n    if (this.version >= oldVersion) {\n      upgradeFunc({ database, transaction });\n    }\n  }\n\n  static upgradeToVersion2(context) {\n    // Create chats\n    context.database.createObjectStore('chats', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    // Create chat_messages\n    const chatMessages = context.database.createObjectStore('chat_messages', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    chatMessages.createIndex('by_chat', 'chatId', { unique: false });\n  }\n}\n","import { Database } from '../Database.js';\nimport { Migrations } from '../Migrations.js';\n\nexport class BaseModel {\n  constructor(data) {\n    Object.assign(this, data);\n  }\n\n  static async database(name, store) {\n    this.dbName = name;\n    this.storeName = store;\n    this.db = new Database(name, [store], Migrations);\n    await this.db.open();\n  }\n\n  static async transaction(mode) {\n    return await this.db.transaction(this.storeName, mode);\n  }\n\n  async transaction(mode) {\n    return await this.constructor.transaction(mode);\n  }\n\n  async create() {\n    const key = await this.constructor.db.add(this.constructor.storeName, this);\n    if (!this.id) {\n      this.id = key;\n    }\n    return this;\n  }\n\n  async save() {\n    return await this.constructor.db.put(this.constructor.storeName, this);\n  }\n\n  async delete() {\n    return await this.constructor.db.delete(\n      this.constructor.storeName,\n      this.id,\n    );\n  }\n\n  static async get(id) {\n    const data = await this.db.get(this.storeName, id);\n    return new this(data);\n  }\n\n  static async clear() {\n    return await this.db.clear(this.storeName);\n  }\n\n  // TODO: sorting and selecting only certain attributes\n  static async getAll() {\n    const records = await this.db.getAll(this.storeName);\n    return records.map((data) => new this(data));\n  }\n\n  /**\n   * Retrieves all objects associated with a given ID and index.\n   *\n   * @param {number|string} chatId - The ID of the chat.\n   * @returns {Promise<Array>} A promise that resolves to an array.\n   */\n  static async getAllByIndexAndId(indexName, id) {\n    // Open a transaction and access the messages store\n    const transaction = await this.transaction('readonly');\n\n    // Use an index to find objects with the specified id\n    const index = transaction.index(indexName);\n    const request = index.getAll(id);\n\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => {\n        // Convert the result into instances\n        const messages = request.result.map((data) => new this(data));\n        resolve(messages);\n      };\n      request.onerror = () => {\n        reject(request.error);\n      };\n    });\n  }\n\n  // Exports the whole store\n  static async export() {\n    let transaction = await this.db.transaction(this.storeName, 'readonly');\n    let store = await transaction.transaction.objectStore(this.storeName);\n    return store.getAll();\n  }\n}\n","import { BaseModel } from './BaseModel.js';\n\nexport class ChatMessage extends BaseModel {\n  static async initialize() {\n    await this.database('ChatApp', 'chat_messages');\n  }\n\n  static async getAllByChatId(chatId) {\n    return this.getAllByIndexAndId('by_chat', chatId);\n  }\n}\n","import { BaseModel } from './BaseModel.js';\nimport { ChatMessage } from './ChatMessage.js';\n\nexport class Chat extends BaseModel {\n  async addMessage(data) {\n    data.chatId = this.id;\n    await new ChatMessage(data).create();\n  }\n\n  async getMessages() {\n    const messages = await ChatMessage.getAllByChatId(this.id);\n    this.messages = messages;\n    return this.messages;\n  }\n\n  static async initialize() {\n    await this.database('ChatApp', ['chats']);\n  }\n\n  static async clear() {\n    await ChatMessage.clear();\n    await super.clear();\n  }\n\n  static async get(id) {\n    const chat = await super.get(id);\n\n    /*\n    if (chat) {\n      // Fetch all messages for this chat\n      const messages = await ChatMessage.getAllByChatId(id);\n      chat.messages = messages;\n    }\n    */\n\n    return chat;\n  }\n\n  static async delete(id) {\n    // Delete the chat instance\n    await super.delete(id);\n\n    // Delete all associated messages\n    const messages = await ChatMessage.getAllByChatId(id);\n    for (const message of messages) {\n      await message.delete();\n    }\n  }\n}\n","import { Event } from './Event.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\nimport { Settings } from './models/Settings.js';\n\nexport class AppController {\n  static async updateChat(chat, data) {\n    Object.assign(chat, data);\n    await chat.save();\n    // TODO: Move to BaseModel\n    Event.emit('chatUpdated', chat);\n  }\n\n  static async createChat(data) {\n    if (!data) {\n      data = {};\n    }\n    if (!data.title) {\n      data.title = 'Untitled';\n    }\n    if (!data.model) {\n      data.model = Settings.getModel();\n    }\n    const chat = await new Chat(data).create();\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatCreated', chat);\n    Event.emit('chatSelected', chat);\n    return chat;\n  }\n\n  static async deleteChatMessage(messageId) {\n    const message = await ChatMessage.get(messageId);\n    message.delete();\n  }\n\n  static async deleteChat(chat) {\n    await chat.delete();\n    if (Settings.getCurrentChatId() === chat.id) {\n      Settings.setCurrentChatId(null);\n    }\n    Event.emit('chatDeleted', chat);\n  }\n\n  static async getCurrentChat() {\n    const chatId = this.getCurrentChatId();\n    if (chatId) {\n      return await Chat.get(chatId);\n    }\n    return null;\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static async setCurrentChat(chat) {\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatSelected', chat);\n  }\n\n  static async setCurrentChatId(chatId) {\n    const chat = await Chat.get(chatId);\n    if (chat) {\n      await this.setCurrentChat(chat);\n    }\n  }\n\n  static async clearChats() {\n    Settings.setCurrentChatId(null);\n    await Chat.clear();\n    Event.emit('chatsCleared');\n  }\n}\n","import { AppController } from './AppController.js';\n\nexport class ChatListItem {\n  constructor(chat, chatList, selected) {\n    this.chat = chat;\n    this.chatList = chatList;\n    this.content = document\n      .getElementById('chat-list-item-template')\n      .content.cloneNode(true);\n    this.element = this.content.querySelector('.chat-list-item');\n    this.element.title = this.chat.title;\n    this.element.data = { id: this.chat.id };\n    this.element.classList.add(`chat${this.chat.id}`);\n    if (selected === true) {\n      this.element.classList.add('selected');\n    }\n    this.setTitle();\n    this.bindEventListeners();\n  }\n\n  render() {}\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', this.onMouseover.bind(this));\n    this.element.addEventListener('mouseout', this.onMouseout.bind(this));\n    this.element.addEventListener('click', this.onClick.bind(this));\n    this.element\n      .querySelector('.list-item-delete')\n      .addEventListener('click', this.deleteChat.bind(this));\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n\n  onClick() {\n    this.chatList.selectChat(this.chat.id);\n  }\n\n  setTitle() {\n    const chatTitle = this.content.querySelector('.chat-title');\n    chatTitle.textContent = this.chat.title;\n  }\n\n  deleteChat() {\n    AppController.deleteChat(this.chat);\n    this.element.remove();\n  }\n}\n","export class DragAndDrop {\n  constructor(selector) {\n    this.listItems = document.querySelectorAll(selector);\n    this.draggedItem = null;\n    this.initializeDragAndDrop();\n  }\n\n  initializeDragAndDrop() {\n    this.listItems.forEach((item) => {\n      item.addEventListener('dragstart', this.handleDragStart.bind(this, item));\n      item.addEventListener('dragover', this.handleDragOver.bind(this));\n      item.addEventListener('drop', this.handleDrop.bind(this, item));\n      item.addEventListener('dragend', this.handleDragEnd.bind(this));\n    });\n  }\n\n  handleDragStart(item) {\n    this.draggedItem = item;\n  }\n\n  handleDragOver(e) {\n    e.preventDefault();\n  }\n\n  handleDrop(item) {\n    if (item !== this.draggedItem) {\n      let currentHTML = item.innerHTML;\n      item.innerHTML = this.draggedItem.innerHTML;\n      this.draggedItem.innerHTML = currentHTML;\n      console.debug('dnd drop');\n    }\n  }\n\n  handleDragEnd() {\n    this.draggedItem = null;\n  }\n}\n","import { Event } from './Event.js';\nimport { ChatListItem } from './ChatListItem.js';\nimport { DragAndDrop } from './DragAndDrop.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatList {\n  constructor() {\n    this.element = document.getElementById('chat-list');\n    this.template = document.getElementById('chat-list-item-template').content;\n    this.bindEventListeners();\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n    });\n  }\n\n  bindEventListeners() {\n    Event.listen('chatCreated', this.handleChatCreated.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatsCleared', this.handleChatsCleared.bind(this));\n    Event.listen('chatUpdated', this.handleChatUpdated.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  async selectChat(chatId) {\n    await AppController.setCurrentChatId(chatId);\n  }\n\n  handleChatCreated(chat) {\n    this.appendChat(chat, true);\n  }\n\n  handleChatDeleted(chat) {\n    if (this.chat?.id === chat.id) {\n      this.chat = null;\n    }\n    this.element.querySelector(`.chat${chat.id}`)?.remove();\n  }\n\n  handleChatsCleared() {\n    const elements = this.element.querySelectorAll('.chat-list-item');\n    elements.forEach((element) => element.remove());\n  }\n\n  handleChatUpdated(chat) {\n    const listElement = this.element.querySelector(\n      `.chat${chat.id} .chat-title`,\n    );\n    if (listElement) {\n      listElement.textContent = chat.title;\n    }\n  }\n\n  handleChatSelected(chat) {\n    if (this.chat) {\n      const previousListElement = this.element.querySelector(\n        `.chat${this.chat.id}`,\n      );\n      if (previousListElement) {\n        previousListElement.classList.remove('selected');\n      }\n    }\n    const newListElement = this.element.querySelector(`.chat${chat.id}`);\n    if (newListElement) {\n      newListElement.classList.add('selected');\n    }\n    // Remember selected chat\n    this.chat = chat;\n  }\n\n  render() {\n    const currentChatId = AppController.getCurrentChatId();\n    this.element.innerHTML = '';\n    Chat.getAll().then((chats) => {\n      chats.forEach((chat) => {\n        const selected = chat.id === currentChatId;\n        this.appendChat(chat, selected);\n      });\n      new DragAndDrop('.chat-list-item');\n    });\n  }\n\n  appendChat(chat, selected) {\n    const chatListItem = new ChatListItem(chat, this, selected);\n    this.element.appendChild(chatListItem.element);\n    return chatListItem;\n  }\n}\n","import { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\nexport class DownloadChatsButton {\n  constructor() {\n    this.button = document.querySelector('#export-button');\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.button.addEventListener('click', () => {\n      this.exportChat();\n      this.exportChatMessages();\n    });\n  }\n\n  async exportChat() {\n    const request = await Chat.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chats.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n\n  async exportChatMessages() {\n    const request = await ChatMessage.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chat_messages.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n}\n","export class LocalStorage {\n  // Set a value in localStorage\n  set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Get a value from localStorage, return defaultValue if key doesn't exist\n  get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Remove a value from localStorage\n  remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n}\n","import { debounce } from './debounce.js';\nimport { Event } from './Event.js';\nimport { DOM } from './Dom.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\nimport { ChatList } from './ChatList.js';\nimport { DownloadChatsButton } from './DownloadChatsButton.js';\nimport { LocalStorage } from './models/LocalStorage.js';\n\nexport class Sidebar {\n  constructor() {\n    this.settings = new LocalStorage();\n    this.chatList = new ChatList();\n    this.element = document.getElementById('sidebar');\n    this.newChatButton = this.element.querySelector('#new-chat-button');\n    this.clearButton = this.element.querySelector('#clear-button');\n    this.hamburgerButton = document.getElementById('hamburger-menu');\n    this.searchButton = document.getElementById('search-button');\n    this.downloadChatsButton = new DownloadChatsButton();\n    this.searchRow = document.getElementById('search-row');\n    this.searchInput = document.getElementById('search-input');\n    if (this.settings.get('sidebar-collapsed') === true) {\n      this.element.classList.add('collapsed');\n    }\n    this.bindEventListeners();\n  }\n\n  render() {\n    this.chatList.render();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    this.searchButton.addEventListener('click', this.toggleSearch.bind(this));\n    this.searchInput.addEventListener(\n      'keypress',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.searchInput.addEventListener(\n      'keyup',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.newChatButton.addEventListener('click', this.handleNewChat.bind(this));\n    this.clearButton.addEventListener('click', this.handleClear.bind(this));\n    this.hamburgerButton.addEventListener('click', this.toggle.bind(this));\n  }\n\n  // TODO: Fix\n  handleChatSelected = (chat) => {\n    const listItem = this.element.querySelector(`chat${chat.id}`);\n    if (listItem) {\n      listItem.scrollIntoView({\n        behavior: 'smooth',\n        block: 'start', // \"start\" will bring the top of the element into view\n        inline: 'nearest', // \"nearest\" will scroll to the nearest edge if partially visible\n      });\n    }\n  };\n\n  toggleSearch() {\n    const searchRow = document.getElementById('search-row');\n    DOM.toggle(searchRow);\n    this.searchInput.focus();\n  }\n\n  performSearch() {\n    function escapeRegExp(string) {\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // Escapes special characters\n    }\n    const query = escapeRegExp(this.searchInput.value.trim()).replace(\n      /\\s+/g,\n      '.*',\n    );\n    const queryContent = query.length > 2; // Nobody wants to query content based on one character?\n    const regex = new RegExp(query, 'i'); // 'i' for case-insensitive matching\n    console.log(`Search ${query}`);\n    Chat.getAll().then((chats) => {\n      const matches = chats\n        .filter((chat) => {\n          let match = regex.test(chat.title);\n          if (queryContent) {\n            match ||= regex.test(chat.content);\n          }\n          return match;\n        })\n        .map((chat) => chat.id);\n      this.element.querySelectorAll('.chat-list-item').forEach((item) => {\n        if (matches.includes(item.data.id)) {\n          DOM.showElement(item);\n        } else {\n          DOM.hideElement(item);\n        }\n      });\n    });\n  }\n\n  toggle() {\n    this.element.classList.toggle('collapsed');\n    this.hamburgerButton.classList.toggle('collapsed');\n    if (this.element.classList.contains('collapsed')) {\n      this.settings.set('sidebar-collapsed', true);\n    } else {\n      this.settings.set('sidebar-collapsed', false);\n    }\n  }\n\n  async handleNewChat() {\n    await AppController.createChat();\n  }\n\n  async handleClear() {\n    await AppController.clearChats();\n  }\n}\n","export class CopyButton {\n  constructor() {\n    document.addEventListener('click', function (event) {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('copy-button')) {\n        const targetSelector = event.target.getAttribute('data-target');\n        const textToCopy = document.getElementById(targetSelector).innerText;\n        // Create a temporary textarea element\n        const textarea = document.createElement('textarea');\n        textarea.value = textToCopy;\n        document.body.appendChild(textarea);\n\n        // Select the text and copy it\n        textarea.select();\n        document.execCommand('copy');\n\n        // Remove the temporary textarea\n        document.body.removeChild(textarea);\n\n        // Optional: Display a message or change the button text/content\n        alert('Text copied to clipboard');\n      }\n    });\n  }\n}\n","export class OllamaApi {\n  constructor() {\n    this.abortController = null;\n  }\n\n  async send(url, data, onResponse, onError, onDone) {\n    const request = { data };\n    try {\n      const response = await this.postChatMessage(url, data);\n      await this.handleResponse(request, response, onResponse, onDone);\n    } catch (error) {\n      onError(request, error);\n    }\n  }\n\n  async postChatMessage(url, data) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n    const response = await fetch(url, {\n      signal,\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      throw new Error(`${url} failed with status ${response.status}`);\n    }\n\n    return response;\n  }\n\n  async handleResponse(request, response, onResponse, onDone) {\n    const reader = response.body.getReader();\n    let partialLine = '';\n    var isRequestDone = false;\n\n    while (!isRequestDone) {\n      const { done, value } = await reader.read();\n      if (done) {\n        onDone(request, response);\n        isRequestDone = true;\n        continue;\n      }\n\n      const textChunk = new TextDecoder().decode(value);\n      const lines = (partialLine + textChunk).split('\\n');\n      partialLine = lines.pop();\n\n      lines.forEach((line) => {\n        const responseData = JSON.parse(line);\n        if (line.trim()) {\n          // TODO: Move this line:\n          this.printResponseStats(responseData);\n          onResponse(request, responseData.message.content);\n        }\n      });\n    }\n\n    if (partialLine.trim()) {\n      onResponse(request, partialLine);\n    }\n  }\n\n  abort() {\n    if (this.abortController) {\n      this.abortController.abort();\n    }\n  }\n\n  printResponseStats(data) {\n    if (!data.total_duration) {\n      return;\n    }\n    // Convert nanoseconds to seconds for durations\n    const totalDurationInSeconds = data.total_duration / 1e9;\n    const loadDurationInSeconds = data.load_duration / 1e9;\n    const promptEvalDurationInSeconds = data.prompt_eval_duration / 1e9;\n    const responseEvalDurationInSeconds = data.eval_duration / 1e9;\n\n    // Calculate tokens per second (token/s)\n    const tokensPerSecond = data.eval_count / responseEvalDurationInSeconds;\n    const output = `\nModel: ${data.model}\nCreated At: ${data.created_at}\nTotal Duration (s): ${totalDurationInSeconds.toFixed(2)}\nLoad Duration (s): ${loadDurationInSeconds.toFixed(2)}\nPrompt Evaluation Count: ${data.prompt_eval_count}\nPrompt Evaluation Duration (s): ${promptEvalDurationInSeconds.toFixed(2)}\nResponse Evaluation Count: ${data.eval_count}\nResponse Evaluation Duration (s): ${responseEvalDurationInSeconds.toFixed(2)}\nTokens Per Second: ${tokensPerSecond.toFixed(2)} token/s\n    `;\n    console.log(output);\n  }\n\n  static getModels(url, onResponse) {\n    if (!url) {\n      return null;\n    }\n\n    return fetch(url)\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error(`Unable to fetch models from ${url}`);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        onResponse(data.models);\n      })\n      .catch((error) => {\n        console.debug(error);\n        console.error(\n          `Oops! It seems there's a problem with the connection to the server. Make sure the server is running: ${url}`,\n        );\n        onResponse([]);\n      });\n  }\n}\n","export class DownloadButton {\n  constructor() {\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('download-button')) {\n        // Get the index from the data-target attribute\n        const targetId = event.target.getAttribute('data-target');\n        this.downloadElementContent(targetId, 'chat.html');\n      }\n    });\n  }\n\n  downloadElementContent(elementId, filename) {\n    // Get the element\n    const element = document.getElementById(elementId);\n    if (!element) {\n      console.error('Element not found');\n      return;\n    }\n\n    // Get the contents of the element\n    const content = element.innerText;\n\n    // Create a Blob with the content\n    const blob = new Blob([content], { type: 'text/html' });\n\n    // Create an anchor element and set the href to the blob\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = filename;\n\n    // Append the anchor to the document, trigger a click, and then remove it\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n\n    // Revoke the blob URL\n    URL.revokeObjectURL(a.href);\n  }\n}\n","import { DOM } from './Dom.js';\n\nexport class DropDownMenu {\n  constructor() {\n    this.buttonSelector = '.drop-down-menu';\n    this.dropDownMenus = document.querySelectorAll(this.buttonSelector);\n    this.init();\n  }\n\n  init() {\n    // Add a click listener to the whole document\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element or any of its parents has the 'drop-down-menu' class\n      const menuElement = event.target.closest(this.buttonSelector);\n      if (menuElement) {\n        const dropDownMenu = menuElement.querySelector('.drop-down-menu-items');\n        if (dropDownMenu) {\n          DOM.toggle(dropDownMenu);\n        }\n      }\n    });\n  }\n}\n","// Modal base class\nexport class Modal {\n  constructor(domId) {\n    this.domId = domId;\n    this.modal = document.getElementById(this.domId);\n    this.closeButton = this.modal.querySelector('.button-close');\n    this.closeButton.onclick = () => this.hide();\n    this._bindEventListeners();\n  }\n\n  _bindEventListeners() {\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  show() {\n    this.handleShow();\n  }\n\n  hide() {\n    this.handleHide();\n  }\n\n  handleShow() {\n    this.modal.classList.add('show');\n  }\n\n  handleHide() {\n    this.modal.classList.remove('show');\n  }\n}\n","export class List {\n  constructor(containerId, items, selected) {\n    this.container = document.getElementById(containerId);\n    this.items = items;\n    this.selected = selected;\n    this.render();\n    this.clickHandler = null;\n  }\n\n  onClick(handler) {\n    this.clickHandler = handler;\n    return this; // Allow chaining\n  }\n\n  setItems(items) {\n    this.items = items;\n    this.render();\n  }\n\n  setSelected(selected) {\n    console.debug(`Select ${selected}`);\n    this.selected = selected;\n    this.render();\n  }\n\n  getSelected() {\n    return this.selected;\n  }\n\n  render() {\n    this.container.innerHTML = ''; // Clear existing content\n    const ul = document.createElement('ul');\n    ul.classList.add('list');\n    this.items.forEach((item) => {\n      const li = document.createElement('li');\n      li.classList.add('list-item');\n      if (item === this.selected) {\n        li.classList.add('selected');\n      }\n      li.textContent = item;\n      li.item = item;\n      li.addEventListener('click', () => {\n        this.setSelected(item);\n        if (this.clickHandler) {\n          this.clickHandler(item);\n        }\n      });\n      ul.appendChild(li);\n    });\n    this.container.appendChild(ul);\n  }\n}\n","import { Event } from '../Event.js';\nimport { Settings } from './Settings.js';\nimport { OllamaApi } from '../OllamaApi.js';\n\nexport class Models {\n  static models = [];\n\n  static getUrl() {\n    return Settings.getUrl('/api/tags');\n  }\n\n  static load() {\n    if (!this.getUrl()) {\n      return null;\n    }\n    return OllamaApi.getModels(this.getUrl(), (models) => {\n      Models.models = models;\n      Settings.set('models', Models.models);\n      Event.emit('modelsLoaded', Models.models);\n    });\n  }\n\n  static getAll() {\n    return Models.models;\n  }\n\n  static getNames() {\n    return Models.models.map((model) => model.name);\n  }\n\n  static findModelByName(name) {\n    return Models.models.find((model) => model.name === name);\n  }\n}\n","import { List } from './List.js';\nimport { Event } from './Event.js';\nimport { Models } from './models/Models.js';\n\nexport class ModelsList {\n  constructor(selector, selectedModel) {\n    this.modelList = new List(selector, Models.getNames(), selectedModel);\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    Event.listen('modelsLoaded', this.handleModelsLoaded.bind(this));\n  }\n\n  handleModelsLoaded() {\n    this.modelList.setItems(Models.getNames());\n  }\n\n  onClick(handler) {\n    this.modelList.clickHandler = handler;\n    return this.modelList; // Allow chaining\n  }\n\n  getSelected() {\n    return this.modelList.selected;\n  }\n}\n","import { Modal } from './Modal.js';\nimport { UINotification } from './UINotification.js';\nimport { ModelsList } from './ModelsList.js';\nimport { Models } from './models/Models.js';\nimport { Settings } from './models/Settings.js';\n\nexport class SettingsDialog extends Modal {\n  constructor() {\n    super('settings-dialog');\n    this.showButton = document.getElementById('settings-button');\n    this.urlInput = document.getElementById('input-url');\n    this.modelInput = document.getElementById('input-model');\n    this.systemPromptInput = this.modal.querySelector('#input-system-prompt');\n    this.modelParametersInput = this.modal.querySelector(\n      '#input-model-parameters',\n    );\n    this.refreshModelsButton = this.modal.querySelector(\n      '.refresh-models-button',\n    );\n    this.modelList = new ModelsList('model-list', Settings.getModel());\n    this.bindEventListeners();\n    this.loadSettings();\n  }\n\n  bindEventListeners() {\n    this.urlInput.addEventListener('blur', () => {\n      const value = this.urlInput.value.trim();\n      Settings.setUrl(value);\n    });\n    this.systemPromptInput.addEventListener('blur', () => {\n      Settings.setSystemPrompt(this.systemPromptInput.value.trim());\n    });\n    this.modelParametersInput.addEventListener('blur', () => {\n      const value = this.modelParametersInput.value.trim();\n      if (value === '') {\n        return;\n      }\n      try {\n        const parsedValue = JSON.parse(value);\n        const prettyJSON = JSON.stringify(parsedValue, 2);\n        Settings.setModelParameters(parsedValue);\n        this.modelParametersInput.value = prettyJSON;\n        this.modelParametersInput.classList.remove('error');\n      } catch (error) {\n        if (error.name === 'SyntaxError') {\n          this.modelParametersInput.classList.add('error');\n        } else {\n          console.error(error);\n        }\n      }\n    });\n    this.modelList.onClick(() => {\n      Settings.setModel(this.modelList.getSelected());\n    });\n    this.showButton.addEventListener('click', this.show.bind(this));\n    this.refreshModelsButton.onclick = () => this.refreshModels();\n    this.closeButton.onclick = () => this.hide();\n  }\n\n  show() {\n    Models.load();\n    this.handleShow();\n  }\n\n  refreshModels() {\n    if (!Models.getUrl()) {\n      UINotification.show('Please update the URL in the settings to continue.');\n    } else {\n      Models.load();\n    }\n  }\n\n  loadSettings() {\n    this.urlInput.value = Settings.getUrl();\n    const modelParameters = Settings.getModelParameters();\n    if (modelParameters) {\n      this.modelParametersInput.value = JSON.stringify(modelParameters, 2);\n    }\n  }\n}\n","import { AppController } from './AppController.js';\nimport { Event } from './Event.js';\nimport { Modal } from './Modal.js';\nimport { Models } from './models/Models.js';\nimport { ModelsList } from './ModelsList.js';\n\nexport class ChatSettingsDialog extends Modal {\n  constructor() {\n    super('chat-settings-dialog');\n    this.showButton = document.getElementById('chat-settings-button');\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.showButton.addEventListener('click', this.show.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  show() {\n    Models.load().then(() => {\n      AppController.getCurrentChat().then((chat) => {\n        this.handleChatSelected(chat);\n        this.handleShow();\n      });\n    });\n  }\n\n  handleChatSelected(chat) {\n    this.modelList = new ModelsList('chat-model-list', chat.model);\n    this.modelList.onClick(async (model) => {\n      chat.model = model;\n      await chat.save();\n    });\n  }\n}\n","export class Hoverable {\n  constructor(element) {\n    this.element = element;\n    element.hoverable = this;\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', () => this.onMouseover());\n    this.element.addEventListener('mouseout', () => this.onMouseout());\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n}\n","import { Event } from './Event.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatTitle {\n  constructor() {\n    this.defaultTitle = 'Untitled';\n    this.element = document.getElementById('chat-title');\n    this.bindEventListeners();\n    this.render();\n  }\n\n  render() {\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.setTitle(chat?.title);\n    });\n  }\n\n  setTitle(title) {\n    this.element.textContent = title || this.defaultTitle;\n  }\n\n  focus() {\n    const hasFocus = document.activeElement === this.element;\n    if (!hasFocus) {\n      this.element.focus();\n    }\n  }\n\n  bindEventListeners() {\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    this.element.addEventListener('blur', this.handleSave.bind(this));\n    this.element.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        this.element.blur();\n      }\n    });\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.setTitle(chat.title);\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat.id) {\n      this.setTitle(this.defaultTitle);\n    }\n  }\n\n  async handleSave() {\n    let title = this.element.textContent.trim();\n    if (title.length === 0) {\n      title = this.defaultTitle;\n      this.element.classList.add('error');\n    } else {\n      this.element.classList.remove('error');\n    }\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.updateChat(chat, { title });\n    } else {\n      await AppController.createChat({ title });\n    }\n  }\n}\n","// TODO: Move code here from App.js\nexport class ChatForm {\n  constructor() {\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n  }\n}\n","import { AppController } from './AppController.js';\nimport { Event } from './Event.js';\nimport { Hoverable } from './Hoverable.js';\nimport { ChatTitle } from './ChatTitle.js';\nimport { ChatForm } from './ChatForm.js';\n\nexport class ChatArea {\n  constructor() {\n    this.chatTitle = new ChatTitle();\n    this.chatForm = new ChatForm();\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.editChatButton = document.getElementById('edit-chat-button');\n    this.scrollToTopButton = document.getElementById('scroll-to-top-button');\n    this.scrollToEndButton = document.getElementById('scroll-to-end-button');\n    this.deleteChatButton = document.getElementById('delete-chat-button');\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.render();\n    });\n    this.bindEventListeners();\n  }\n\n  render() {\n    // Clear history view\n    this.chatHistory.innerText = '';\n    // Render chat history\n    this.chat?.getMessages()?.then((messages) => {\n      messages.forEach((message) => {\n        this.createMessageDiv(message);\n      });\n    });\n    this.scrollToEnd();\n    this.messageInput.focus();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    this.scrollToTopButton.addEventListener(\n      'click',\n      this.scrollToTop.bind(this),\n    );\n    this.scrollToEndButton.addEventListener(\n      'click',\n      this.scrollToEnd.bind(this),\n    );\n    this.editChatButton.addEventListener(\n      'click',\n      this.handleEditChat.bind(this),\n    );\n    this.deleteChatButton.addEventListener(\n      'click',\n      this.handleDeleteChat.bind(this),\n    );\n    this.currentMessage = this.chatHistory.querySelector('.selected');\n    // Select chat message with arrow up and arrow down keys\n    document.addEventListener('keydown', (event) => {\n      let next, previous;\n\n      if (event.key === 'ArrowDown') {\n        next = this.currentMessage\n          ? this.currentMessage.nextElementSibling\n          : this.chatHistory.firstElementChild;\n        if (next) {\n          if (this.currentMessage)\n            this.currentMessage.classList.remove('hover');\n          next.classList.add('hover');\n          this.currentMessage = next; // Update currentMessage\n          this.currentMessage.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          }); // Scroll into view\n        }\n      } else if (event.key === 'ArrowUp') {\n        previous = this.currentMessage\n          ? this.currentMessage.previousElementSibling\n          : this.chatHistory.lastElementChild;\n        if (previous) {\n          if (this.currentMessage)\n            this.currentMessage.classList.remove('hover');\n          previous.classList.add('hover');\n        }\n        this.currentMessage = previous; // Update currentMessage\n        this.currentMessage.scrollIntoView({\n          behavior: 'smooth',\n          block: 'nearest',\n        }); // Scroll into view\n      }\n    });\n  }\n\n  createMessageDiv(message) {\n    const role = message.role;\n    const content = message.content;\n    // Get the template and its content\n    const template = document.getElementById('chat-message-template');\n    const messageClone = template.content.cloneNode(true);\n    // Find the div and span elements within the cloned template\n    const messageDiv = messageClone.querySelector('.chat-message');\n    const textSpan = messageClone.querySelector('.chat-message-text');\n    const deleteButton = messageClone.querySelector(\n      '.delete-chat-message-button',\n    );\n\n    // Set the class for role and text content\n    messageDiv.classList.add(`${role}-chat-message`);\n    textSpan.textContent = content;\n    messageDiv.spellcheck = false;\n\n    // Append to chatHistory and adjust scroll\n    this.chatHistory.appendChild(messageDiv);\n    messageDiv.dataset['id'] = message.id;\n    new Hoverable(messageDiv);\n    deleteButton.addEventListener('click', async () => {\n      await AppController.deleteChatMessage(message.id);\n      messageDiv.remove();\n    });\n    return messageDiv;\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat?.id) {\n      this.chat = null;\n    } else {\n      this.chat = chat;\n    }\n    this.render();\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.render();\n  }\n\n  handleEditChat() {\n    this.chatTitle.focus();\n    event.stopPropagation();\n  }\n\n  async handleDeleteChat() {\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.deleteChat(chat);\n    }\n  }\n\n  scrollToTop() {\n    this.chatHistory.scrollTop = 0;\n  }\n\n  scrollToEnd() {\n    this.chatHistory.scrollTop = this.chatHistory.scrollHeight;\n  }\n}\n","import { UINotification } from './UINotification.js';\nimport { Settings } from './models/Settings.js';\nimport { Event } from './Event.js';\nimport { DOM } from './Dom.js';\nimport { Sidebar } from './Sidebar.js';\nimport { AppController } from './AppController.js';\nimport { CopyButton } from './CopyButton.js';\nimport { OllamaApi } from './OllamaApi.js';\nimport { DownloadButton } from './DownloadButton.js';\nimport { DropDownMenu } from './DropDownMenu.js';\nimport { SettingsDialog } from './SettingsDialog.js';\nimport { ChatSettingsDialog } from './ChatSettingsDialog.js';\n// import { MarkdownFormatter } from './MarkdownFormatter.js'\nimport { ChatArea } from './ChatArea.js';\n\n// TODO: Review and refactor\nexport class App {\n  static run() {\n    UINotification.initialize();\n    const app = new App();\n    return app;\n  }\n\n  constructor() {\n    this.sidebar = new Sidebar();\n    this.chatArea = new ChatArea();\n    this.ollamaApi = new OllamaApi();\n    this.settingsDialog = new SettingsDialog();\n    this.chatSettingsDialog = new ChatSettingsDialog();\n    this.downloadButton = new DownloadButton();\n    this.copyButton = new CopyButton();\n    this.dropDownMenu = new DropDownMenu();\n    this.initializeElements();\n    this.bindEventListeners();\n    this.logInitialization();\n    this.render();\n  }\n\n  initializeElements() {\n    // this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n    this.messageInput = document.getElementById('message-input');\n    this.chatHistory = document.getElementById('chat-history');\n  }\n\n  logInitialization() {\n    const msg = `~~~~\\nChat\\n~~~~\nModel:       ${Settings.getModel()}\nURL:         ${Settings.getUrl()}\nChat:        ${Settings.getCurrentChatId()}\nParameters:  ${JSON.stringify(Settings.getModelParameters())}\n`;\n    console.log(msg);\n  }\n\n  render() {\n    this.sidebar.render();\n    this.chatArea.render();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    // this.sendButton.addEventListener('click', this.sendMessage.bind(this));\n    this.abortButton.addEventListener('click', this.handleAbort.bind(this));\n    this.messageInput.addEventListener(\n      'keypress',\n      this.handleKeyPress.bind(this),\n    );\n  }\n\n  handleChatSelected = (chat) => {\n    window.history.pushState({}, '', `/chats/${chat.id}`);\n  };\n\n  handleAbort = () => {\n    this.ollamaApi.abort();\n    this.enableForm();\n    console.log('Request aborted');\n  };\n\n  handleKeyPress = (event) => {\n    if (event.key === 'Enter' && !event.shiftKey) {\n      this.sendMessage();\n    }\n  };\n\n  enableForm() {\n    DOM.hideElement(this.abortButton).enableInput(this.messageInput);\n    this.messageInput.focus();\n  }\n\n  disableForm() {\n    DOM.showElement(this.abortButton).disableInput(this.messageInput);\n  }\n\n  // https://github.com/jmorganca/ollama/blob/main/docs/api.md#generate-a-completion\n  async sendMessage() {\n    const userMessage = this.messageInput.value.trim();\n    // Get the current chat\n    let chat = await AppController.getCurrentChat();\n    const url = Settings.getUrl('/api/chat');\n    if (!url) {\n      UINotification.show(\n        'Please update the URL in the settings to continue. ',\n      );\n      return null;\n    }\n    if (userMessage) {\n      // Reset input\n      this.messageInput.value = '';\n      // Create new chat\n      if (!chat) {\n        chat = await AppController.createChat({\n          title: 'Untitled',\n          model: Settings.getModel(),\n        });\n      }\n      // Store user message\n      await chat.addMessage({\n        role: 'user',\n        content: userMessage,\n      });\n      const systemPrompt = Settings.getSystemPrompt();\n      const modelParameters = Settings.getModelParameters();\n      // Disable form\n      this.disableForm();\n      // Create user message\n      this.createChatMessage({ content: userMessage, role: 'user' });\n      // Create system message container\n      const responseElement = this.createChatMessage({\n        content: '',\n        role: 'system',\n      });\n      const requestContext = {\n        chat,\n        content: '', // TODO: Move this to the response?\n        responseElement,\n      };\n      const requestData = {\n        prompt: userMessage,\n        model: chat.model,\n        messages: (await chat.getMessages()).map((message) => ({\n          role: message.role,\n          content: message.content,\n        })),\n      };\n      // Add system prompt\n      if (systemPrompt) {\n        requestData.system = systemPrompt;\n      }\n      // Add model parameters\n      if (modelParameters) {\n        requestData.options = modelParameters;\n      }\n      // Show spinner\n      responseElement.innerHTML = '<div class=\"waiting\"></div>';\n      // Make request\n      this.ollamaApi.send(\n        url,\n        requestData,\n        (request, response) =>\n          this.handleResponse(request, response, requestContext),\n        (request, error) => this.handleResponseError(request, error),\n        (request, response) =>\n          this.handleDone(request, response, requestContext),\n      );\n    }\n  }\n\n  createChatMessage(message) {\n    return this.chatArea.createMessageDiv(message);\n  }\n\n  handleResponse(request, response, context) {\n    const responseElement = context.responseElement;\n    const sanitizedContent = this.sanitizeContent(response);\n    // Remember original response\n    context.content += sanitizedContent;\n    responseElement.textContent += sanitizedContent;\n    this.chatArea.scrollToEnd();\n  }\n\n  handleResponseError(request, error) {\n    // Ignore \"Abort\" button\n    if (error.name !== 'AbortError') {\n      console.error(\n        `Oops! It seems there's a problem with the connection to the server. Make sure the server is running: ${Settings.getUrl()}`,\n      );\n    }\n    this.chatArea.scrollToEnd();\n    this.enableForm();\n  }\n\n  async handleDone(request, response, context) {\n    const chat = context.chat;\n    console.log(`Chat ${chat.id} done`);\n    await chat.addMessage({\n      role: 'assistant',\n      content: context.content,\n    });\n    this.enableForm();\n  }\n\n  sanitizeContent = (content) => {\n    // TODO: Sanitization logic here\n    return content;\n  };\n\n  getIdParam = () => {\n    return new URL(window.location.href).pathname.split('/').pop();\n  };\n}\n","import { App } from './App.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\n// TODO: refactor\nasync function initialize() {\n  await Chat.initialize();\n  await ChatMessage.initialize();\n}\n\ninitialize().then(() => {\n  App.run();\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}