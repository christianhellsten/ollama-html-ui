{"version":3,"sources":["js/UINotification.js","js/models/Settings.js","js/Event.js","js/Dom.js","js/debounce.js","js/Database.js","js/Migrations.js","js/models/BaseModel.js","js/models/ChatMessage.js","js/models/Chat.js","js/AppController.js","js/ChatListItem.js","js/DragAndDrop.js","js/ChatList.js","js/DownloadChatsButton.js","js/models/LocalStorage.js","js/Sidebar.js","js/CopyButton.js","js/OllamaApi.js","js/DownloadButton.js","js/DropDownMenu.js","js/Modal.js","js/List.js","js/models/Models.js","js/ModelsList.js","js/SettingsDialog.js","js/ChatSettingsDialog.js","js/ChatModelInfo.js","js/ExportChat.js","js/Hoverable.js","js/ChatTitle.js","js/ChatForm.js","js/ChatArea.js","js/App.js","js/script.js","../../../../../usr/local/lib/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["simpleHash","str","hash","i","length","char","charCodeAt","UINotification","constructor","message","type","autoDismiss","id","JSON","stringify","domId","container","document","body","template","getElementById","content","_bindEventListeners","window","addEventListener","event","key","hide","setTimeout","show","notification","initialize","originalConsoleError","console","error","_len","arguments","args","Array","_key","apply","handleApplicationError","debug","clone","cloneNode","notificationElement","querySelector","textContent","classList","add","closeButton","onclick","appendChild","remove","exports","Settings","set","value","stringValue","localStorage","setItem","e","get","defaultValue","undefined","getItem","parse","removeItem","getUrl","uri","baseUrl","URL","href","setUrl","url","getModel","setModel","model","getSystemPrompt","setSystemPrompt","systemPrompt","getModelParameters","setModelParameters","modelParameters","getCurrentChatId","setCurrentChatId","chatId","Event","listen","eventName","handler","detail","emit","data","log","CustomEvent","bubbles","dispatchEvent","DOM","showElement","element","hideElement","enableInput","removeAttribute","disableInput","setAttribute","debounce","func","wait","timeout","funcWrapper","later","clearTimeout","Database","dbName","objectStores","migrations","dbConnection","open","Error","Promise","resolve","reject","request","indexedDB","version","onerror","target","onupgradeneeded","db","result","transaction","currentTarget","upgrade","oldVersion","onsuccess","storeName","mode","objectStore","store","handleRequest","put","delete","getAll","clear","Migrations","database","funcName","upgradeFunc","upgradeToVersion2","context","createObjectStore","keyPath","autoIncrement","chatMessages","createIndex","unique","_Database","require","_Migrations","BaseModel","Object","assign","create","save","jsonify","name","records","map","getAllByIndexAndId","indexName","index","messages","export","_BaseModel","ChatMessage","getAllByChatId","_ChatMessage","Chat","addMessage","getMessages","chat","_UINotification","_Event","_Chat","_Settings","AppController","updateChat","createChat","title","deleteChatMessage","messageId","deleteChat","getCurrentChat","setCurrentChat","clearChats","_AppController","ChatListItem","chatList","selected","setTitle","bindEventListeners","render","onMouseover","bind","onMouseout","onClick","selectChat","chatTitle","DragAndDrop","selector","listItems","querySelectorAll","draggedItem","initializeDragAndDrop","forEach","item","handleDragStart","handleDragOver","handleDrop","handleDragEnd","preventDefault","currentHTML","innerHTML","_ChatListItem","_DragAndDrop","ChatList","then","handleChatCreated","handleChatDeleted","handleChatsCleared","handleChatUpdated","handleChatSelected","appendChat","elements","listElement","previousListElement","newListElement","currentChatId","chats","chatListItem","DownloadChatsButton","button","exportChat","exportChatMessages","jsonData","blob","Blob","createObjectURL","a","createElement","download","click","revokeObjectURL","errorCode","LocalStorage","_debounce","_ChatList","_DownloadChatsButton","_LocalStorage","Sidebar","settings","newChatButton","clearButton","hamburgerButton","searchButton","downloadChatsButton","searchRow","searchInput","toggleSearch","performSearch","handleNewChat","handleClear","toggle","listItem","scrollIntoView","behavior","block","inline","focus","escapeRegExp","string","replace","query","trim","queryContent","regex","RegExp","matches","filter","match","test","includes","contains","CopyButton","targetSelector","getAttribute","textToCopy","innerText","textarea","select","execCommand","removeChild","OllamaApi","abortController","makeRequest","userMessage","requestData","prompt","role","system","options","send","onResponse","onError","onDone","response","postChatMessage","handleResponse","AbortController","signal","fetch","method","headers","ok","status","reader","getReader","partialLine","isRequestDone","done","read","textChunk","TextDecoder","decode","lines","split","pop","line","responseData","printResponseStats","abort","total_duration","totalDurationInSeconds","loadDurationInSeconds","load_duration","promptEvalDurationInSeconds","prompt_eval_duration","responseEvalDurationInSeconds","eval_duration","tokensPerSecond","eval_count","output","created_at","toFixed","prompt_eval_count","getModels","json","models","catch","DownloadButton","targetId","downloadElementContent","elementId","filename","DropDownMenu","buttonSelector","dropDownMenus","init","menuElement","closest","dropDownMenu","toggleMenu","menu","Modal","templateId","modal","createDialogElement","titleElement","modalElement","firstElementChild","handleShow","handleHide","List","items","clickHandler","setItems","setSelected","getSelected","ul","li","_OllamaApi","Models","load","getNames","findModelByName","find","_List","_Models","ModelsList","handleModelsLoaded","_Modal","_ModelsList","SettingsDialog","showButtonId","showButton","urlInput","modelInput","systemPromptInput","modelParametersInput","refreshModelsButton","modelList","handleUrlUpdated","handleSystemPromptUpdated","handleModelParametersUpdated","handleModelUpdated","refreshModels","parsedValue","prettyJSON","loadSettings","_SettingsDialog","ChatSettingsDialog","ChatModelInfo","nameElement","ExportChat","Hoverable","hoverable","ChatTitle","defaultTitle","hasFocus","activeElement","handleSave","blur","ChatForm","chatHistory","messageInput","sendButton","abortButton","_ExportChat","_Hoverable","_ChatTitle","_ChatForm","ChatArea","chatForm","editChatButton","scrollToTopButton","scrollToEndButton","deleteChatButton","exportChatButton","createMessageDiv","scrollToEnd","scrollToTop","handleEditChat","handleDeleteChat","currentMessage","next","previous","nextElementSibling","previousElementSibling","lastElementChild","messageClone","messageDiv","textSpan","deleteButton","copyButton","goodButton","badButton","flagButton","quality","spellcheck","dataset","textElement","stopPropagation","scrollTop","scrollHeight","_Dom","_Sidebar","_CopyButton","_DownloadButton","_DropDownMenu","_ChatSettingsDialog","_ChatModelInfo","_ChatArea","App","run","app","sidebar","chatArea","chatModelInfo","api","settingsDialog","chatSettingsDialog","downloadButton","initializeElements","logInitialization","msg","handleAbort","handleKeyPress","history","pushState","enableForm","shiftKey","sendMessage","disableForm","userPrompt","systemMessage","createChatMessage","responseElement","requestContext","handleResponseError","handleDone","sanitizedContent","sanitizeContent","getIdParam","location","pathname","_App","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","protocol","ws","onmessage","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","hmrApply","v","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","stack","overlay","createErrorOverlay","stackTrace","getParents","modules","parents","k","d","dep","isArray","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"script.d573be0b.js","sourceRoot":"..","sourcesContent":["function simpleHash(str) {\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return hash;\n}\n\n// Show all uncaught errors as UI notifications\n/*\nwindow.onerror = function (message, source, lineno, colno, error) {\n  const errorDetails = `${message} at ${source}:${lineno}:${colno}`;\n  UINotification.show(errorDetails, 'error');\n  return true;\n};\n*/\n\nexport class UINotification {\n  constructor(message, type, autoDismiss) {\n    const id = simpleHash(JSON.stringify(message));\n    this.type = type;\n    this.domId = `notification-${id}`;\n    this.container = document.body;\n    this.template = document.getElementById('notification-template').content;\n    this._bindEventListeners();\n    if (autoDismiss) {\n      this.autoDismiss();\n    }\n  }\n\n  _bindEventListeners() {\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  autoDismiss() {\n    setTimeout(() => {\n      this.hide();\n    }, 2000); // 2000 milliseconds (2 seconds)\n  }\n\n  static show(message, type) {\n    const notification = new UINotification(message, type);\n    notification.show(message);\n    return notification;\n  }\n\n  static initialize() {\n    // Store the original console.error function\n    const originalConsoleError = console.error;\n\n    // Override console.error\n    console.error = function (...args) {\n      UINotification.show(args);\n      // Call the original console.error with all arguments\n      originalConsoleError.apply(console, args);\n    };\n  }\n\n  static handleApplicationError(error) {\n    console.debug('caught error');\n    console.error(error);\n    UINotification.show(error);\n  }\n\n  show(message) {\n    // Clone the template\n    const clone = this.template.cloneNode(true);\n\n    // Find the root element of the notification in the clone\n    const notificationElement = clone.querySelector('.notification');\n    if (!notificationElement) {\n      console.error('Notification root element not found in template');\n      return;\n    }\n\n    // Set the message\n    clone.querySelector('.notification-message').textContent = message;\n\n    notificationElement.id = this.domId; // Set ID on the actual element, not the fragment\n    // Add type, for example, error\n    if (this.type) {\n      notificationElement.classList.add(`notification-${this.type}`);\n    }\n\n    // Add close functionality\n    const closeButton = clone.querySelector('.close-notification-button');\n    closeButton.onclick = () => this.hide();\n\n    // Don't show the same notification twice\n    if (!document.getElementById(this.domId)) {\n      // Append to the container and display\n      this.container.appendChild(clone);\n    }\n  }\n\n  hide() {\n    document.getElementById(this.domId)?.remove();\n  }\n}\n","export class Settings {\n  // Static method to set a value in localStorage\n  static set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Static method to get a value from localStorage\n  static get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Static method to remove a value from localStorage\n  static remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n\n  static getUrl(uri) {\n    try {\n      const baseUrl = Settings.get('url');\n      if (uri) {\n        return new URL(uri, baseUrl).href;\n      } else {\n        return baseUrl;\n      }\n    } catch (error) {\n      return null;\n    }\n  }\n\n  static setUrl(url) {\n    Settings.set('url', url);\n  }\n\n  static getModel() {\n    return Settings.get('model');\n  }\n\n  static setModel(model) {\n    Settings.set('model', model);\n  }\n\n  static getSystemPrompt() {\n    return Settings.get('system-prompt');\n  }\n\n  static setSystemPrompt(systemPrompt) {\n    if (systemPrompt === '') {\n      systemPrompt = null;\n    }\n    Settings.set('system-prompt', systemPrompt);\n  }\n\n  static getModelParameters() {\n    return Settings.get('model-parameters');\n  }\n\n  static setModelParameters(modelParameters) {\n    if (modelParameters === '') {\n      modelParameters = null;\n    }\n    Settings.set('model-parameters', modelParameters);\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static setCurrentChatId(chatId) {\n    if (chatId === undefined) {\n      chatId = null;\n    }\n    Settings.set('currentChatId', chatId);\n  }\n}\n","export class Event {\n  static listen(eventName, handler) {\n    window.addEventListener(eventName, (event) => {\n      handler(event.detail);\n    });\n  }\n\n  static emit(eventName, data) {\n    let log = `${eventName}`;\n    if (data?.id) {\n      log += ` id: ${data.id}`;\n    }\n    console.log(log);\n    const event = new CustomEvent(eventName, {\n      detail: data || {},\n      bubbles: true, // This makes the event bubble up through the DOM\n    });\n    window.dispatchEvent(event);\n  }\n}\n","export class DOM {\n  static showElement(element) {\n    element.classList.remove('hidden');\n    return this;\n  }\n\n  static hideElement(element) {\n    element.classList.add('hidden');\n    return this;\n  }\n\n  static enableInput(element) {\n    element.removeAttribute('disabled');\n    return this;\n  }\n\n  static disableInput(element) {\n    element.setAttribute('disabled', 'disabled');\n    return this;\n  }\n}\n","export function debounce(func, wait) {\n  let timeout;\n\n  return function funcWrapper(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n","export class Database {\n  constructor(dbName, objectStores, migrations) {\n    this.dbName = dbName;\n    this.objectStores = objectStores;\n    this.dbConnection = null; // Initialized in open\n    this.migrations = migrations;\n  }\n\n  async open() {\n    if (this.dbConnection) {\n      throw new Error('Connection already open');\n    }\n\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.migrations.version);\n\n      request.onerror = (event) => reject(event.target.error);\n      request.onupgradeneeded = (event) => {\n        const db = event.target.result;\n        const transaction = event.currentTarget.transaction;\n        this.migrations.upgrade(db, transaction, event.oldVersion);\n      };\n      request.onsuccess = (event) => {\n        this.dbConnection = event.target.result;\n        resolve(this.dbConnection);\n      };\n    });\n  }\n\n  async transaction(storeName, mode) {\n    return this.dbConnection\n      .transaction([storeName], mode)\n      .objectStore(storeName);\n  }\n\n  async add(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('add', store.add(data));\n  }\n\n  async get(storeName, id) {\n    const store = await this.transaction(storeName, 'readonly');\n    return this.handleRequest('get', store.get(id));\n  }\n\n  async put(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('put', store.put(data));\n  }\n\n  async delete(storeName, id) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('delete', store.delete(id));\n  }\n\n  async getAll(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('getAll', store.getAll());\n  }\n\n  async clear(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('deleteAll', store.clear());\n  }\n\n  handleRequest(type, request) {\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => resolve(request.result);\n\n      request.onerror = (event) => {\n        const error = `Database ${type} operation failed: ${event.target.error.message}`;\n        reject(new Error(JSON.stringify(error)));\n      };\n    });\n  }\n}\n","export class Migrations {\n  static version = 2;\n  static upgrade(database, transaction, oldVersion) {\n    console.debug(\n      `Migration needed. Old version ${oldVersion}. New version ${this.version}.`,\n    );\n    const funcName = `upgradeToVersion${this.version}`;\n    const upgradeFunc = this[funcName];\n    if (!upgradeFunc) {\n      throw new Error(`Upgrade function missing for ${funcName}`);\n    }\n    if (this.version >= oldVersion) {\n      upgradeFunc({ database, transaction });\n    }\n  }\n\n  static upgradeToVersion2(context) {\n    // Create chats\n    context.database.createObjectStore('chats', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    // Create chat_messages\n    const chatMessages = context.database.createObjectStore('chat_messages', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    chatMessages.createIndex('by_chat', 'chatId', { unique: false });\n  }\n}\n","import { Database } from '../Database.js';\nimport { Migrations } from '../Migrations.js';\n\nexport class BaseModel {\n  constructor(data) {\n    Object.assign(this, data);\n  }\n\n  async create() {\n    const key = await this.constructor.db.add(this.constructor.storeName, this);\n    if (!this.id) {\n      this.id = key;\n    }\n    return this;\n  }\n\n  async save() {\n    return await this.constructor.db.put(this.constructor.storeName, this);\n  }\n\n  async delete() {\n    return await this.constructor.db.delete(\n      this.constructor.storeName,\n      this.id,\n    );\n  }\n\n  jsonify() {\n    return JSON.stringify(this);\n  }\n\n  static async database(name, store) {\n    this.dbName = name;\n    this.storeName = store;\n    this.db = new Database(name, [store], Migrations);\n    await this.db.open();\n  }\n\n  static async transaction(mode) {\n    return await this.db.transaction(this.storeName, mode);\n  }\n\n  async transaction(mode) {\n    return await this.constructor.transaction(mode);\n  }\n\n  static async get(id) {\n    const data = await this.db.get(this.storeName, id);\n    return new this(data);\n  }\n\n  static async clear() {\n    return await this.db.clear(this.storeName);\n  }\n\n  // TODO: sorting and selecting only certain attributes\n  static async getAll() {\n    const records = await this.db.getAll(this.storeName);\n    return records.map((data) => new this(data));\n  }\n\n  /**\n   * Retrieves all objects associated with a given ID and index.\n   *\n   * @param {number|string} chatId - The ID of the chat.\n   * @returns {Promise<Array>} A promise that resolves to an array.\n   */\n  static async getAllByIndexAndId(indexName, id) {\n    // Open a transaction and access the messages store\n    const transaction = await this.transaction('readonly');\n\n    // Use an index to find objects with the specified id\n    const index = transaction.index(indexName);\n    const request = index.getAll(id);\n\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => {\n        // Convert the result into instances\n        const messages = request.result.map((data) => new this(data));\n        resolve(messages);\n      };\n      request.onerror = () => {\n        reject(request.error);\n      };\n    });\n  }\n\n  // Exports the whole store\n  static async export() {\n    let transaction = await this.db.transaction(this.storeName, 'readonly');\n    let store = await transaction.transaction.objectStore(this.storeName);\n    return store.getAll();\n  }\n}\n","import { BaseModel } from './BaseModel.js';\n\nexport class ChatMessage extends BaseModel {\n  static async initialize() {\n    await this.database('ChatApp', 'chat_messages');\n  }\n\n  static async getAllByChatId(chatId) {\n    return this.getAllByIndexAndId('by_chat', chatId);\n  }\n}\n","import { BaseModel } from './BaseModel.js';\nimport { ChatMessage } from './ChatMessage.js';\n\nexport class Chat extends BaseModel {\n  async addMessage(data) {\n    data.chatId = this.id;\n    return await new ChatMessage(data).create();\n  }\n\n  async getMessages() {\n    const messages = await ChatMessage.getAllByChatId(this.id);\n    this.messages = messages;\n    return this.messages;\n  }\n\n  static async initialize() {\n    await this.database('ChatApp', ['chats']);\n  }\n\n  static async clear() {\n    await ChatMessage.clear();\n    await super.clear();\n  }\n\n  static async get(id) {\n    const chat = await super.get(id);\n\n    /*\n    if (chat) {\n      // Fetch all messages for this chat\n      const messages = await ChatMessage.getAllByChatId(id);\n      chat.messages = messages;\n    }\n    */\n\n    return chat;\n  }\n\n  static async delete(id) {\n    // Delete the chat instance\n    await super.delete(id);\n\n    // Delete all associated messages\n    const messages = await ChatMessage.getAllByChatId(id);\n    for (const message of messages) {\n      await message.delete();\n    }\n  }\n}\n","import { UINotification } from './UINotification.js';\nimport { Event } from './Event.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\nimport { Settings } from './models/Settings.js';\n\n// TODO: Move all actions here?\n// TODO: Cache current chat here\nexport class AppController {\n  static async updateChat(chat, data) {\n    Object.assign(chat, data);\n    await chat.save();\n    // TODO: Move to BaseModel\n    Event.emit('chatUpdated', chat);\n  }\n\n  static async createChat(data) {\n    if (!data) {\n      data = {};\n    }\n    if (!data.title) {\n      data.title = 'Untitled';\n    }\n    if (!data.model) {\n      data.model = Settings.getModel();\n    }\n    const chat = await new Chat(data).create();\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatCreated', chat);\n    Event.emit('chatSelected', chat);\n    return chat;\n  }\n\n  static async deleteChatMessage(messageId) {\n    UINotification.show('Deleted message').autoDismiss();\n    const message = await ChatMessage.get(messageId);\n    message.delete();\n  }\n\n  static async deleteChat(chat) {\n    await chat.delete();\n    if (Settings.getCurrentChatId() === chat.id) {\n      Settings.setCurrentChatId(null);\n    }\n    Event.emit('chatDeleted', chat);\n  }\n\n  static async getCurrentChat() {\n    const chatId = this.getCurrentChatId();\n    if (chatId) {\n      return await Chat.get(chatId);\n    }\n    return null;\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static async setCurrentChat(chat) {\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatSelected', chat);\n  }\n\n  static async setCurrentChatId(chatId) {\n    const chat = await Chat.get(chatId);\n    if (chat) {\n      await this.setCurrentChat(chat);\n    }\n  }\n\n  static async clearChats() {\n    Settings.setCurrentChatId(null);\n    await Chat.clear();\n    Event.emit('chatsCleared');\n  }\n}\n","import { AppController } from './AppController.js';\n\nexport class ChatListItem {\n  constructor(chat, chatList, selected) {\n    this.chat = chat;\n    this.chatList = chatList;\n    this.content = document\n      .getElementById('chat-list-item-template')\n      .content.cloneNode(true);\n    this.element = this.content.querySelector('.chat-list-item');\n    this.element.title = this.chat.title;\n    this.element.data = { id: this.chat.id };\n    this.element.classList.add(`chat${this.chat.id}`);\n    if (selected === true) {\n      this.element.classList.add('selected');\n      // this.content.querySelector('.icon-selected').classList.remove('hidden')\n    }\n    this.setTitle();\n    this.bindEventListeners();\n  }\n\n  render() {}\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', this.onMouseover.bind(this));\n    this.element.addEventListener('mouseout', this.onMouseout.bind(this));\n    this.element.addEventListener('click', this.onClick.bind(this));\n    this.element\n      .querySelector('.list-item-delete')\n      .addEventListener('click', this.deleteChat.bind(this));\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n\n  onClick() {\n    this.chatList.selectChat(this.chat.id);\n  }\n\n  setTitle() {\n    const chatTitle = this.content.querySelector('.chat-title');\n    chatTitle.textContent = this.chat.title;\n  }\n\n  deleteChat() {\n    AppController.deleteChat(this.chat);\n    this.element.remove();\n  }\n}\n","export class DragAndDrop {\n  constructor(selector) {\n    this.listItems = document.querySelectorAll(selector);\n    this.draggedItem = null;\n    this.initializeDragAndDrop();\n  }\n\n  initializeDragAndDrop() {\n    this.listItems.forEach((item) => {\n      item.addEventListener('dragstart', this.handleDragStart.bind(this, item));\n      item.addEventListener('dragover', this.handleDragOver.bind(this));\n      item.addEventListener('drop', this.handleDrop.bind(this, item));\n      item.addEventListener('dragend', this.handleDragEnd.bind(this));\n    });\n  }\n\n  handleDragStart(item) {\n    this.draggedItem = item;\n  }\n\n  handleDragOver(e) {\n    e.preventDefault();\n  }\n\n  handleDrop(item) {\n    if (item !== this.draggedItem) {\n      let currentHTML = item.innerHTML;\n      item.innerHTML = this.draggedItem.innerHTML;\n      this.draggedItem.innerHTML = currentHTML;\n      console.debug('dnd drop');\n    }\n  }\n\n  handleDragEnd() {\n    this.draggedItem = null;\n  }\n}\n","import { Event } from './Event.js';\nimport { ChatListItem } from './ChatListItem.js';\nimport { DragAndDrop } from './DragAndDrop.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatList {\n  constructor() {\n    this.element = document.getElementById('chat-list');\n    this.template = document.getElementById('chat-list-item-template').content;\n    this.bindEventListeners();\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n    });\n  }\n\n  bindEventListeners() {\n    Event.listen('chatCreated', this.handleChatCreated.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatsCleared', this.handleChatsCleared.bind(this));\n    Event.listen('chatUpdated', this.handleChatUpdated.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  async selectChat(chatId) {\n    await AppController.setCurrentChatId(chatId);\n  }\n\n  handleChatCreated(chat) {\n    this.appendChat(chat, true);\n  }\n\n  handleChatDeleted(chat) {\n    if (this.chat?.id === chat.id) {\n      this.chat = null;\n    }\n    this.element.querySelector(`.chat${chat.id}`)?.remove();\n  }\n\n  handleChatsCleared() {\n    const elements = this.element.querySelectorAll('.chat-list-item');\n    elements.forEach((element) => element.remove());\n  }\n\n  handleChatUpdated(chat) {\n    const listElement = this.element.querySelector(\n      `.chat${chat.id} .chat-title`,\n    );\n    if (listElement) {\n      listElement.textContent = chat.title;\n    }\n  }\n\n  handleChatSelected(chat) {\n    if (this.chat) {\n      const previousListElement = this.element.querySelector(\n        `.chat${this.chat.id}`,\n      );\n      if (previousListElement) {\n        previousListElement.classList.remove('selected');\n      }\n    }\n    const newListElement = this.element.querySelector(`.chat${chat.id}`);\n    if (newListElement) {\n      newListElement.classList.add('selected');\n    }\n    // Remember selected chat\n    this.chat = chat;\n  }\n\n  render() {\n    const currentChatId = AppController.getCurrentChatId();\n    this.element.innerHTML = '';\n    Chat.getAll().then((chats) => {\n      chats.forEach((chat) => {\n        const selected = chat.id === currentChatId;\n        this.appendChat(chat, selected);\n      });\n      new DragAndDrop('.chat-list-item');\n    });\n  }\n\n  appendChat(chat, selected) {\n    const chatListItem = new ChatListItem(chat, this, selected);\n    this.element.appendChild(chatListItem.element);\n    return chatListItem;\n  }\n}\n","import { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\nexport class DownloadChatsButton {\n  constructor() {\n    this.button = document.querySelector('#export-button');\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.button.addEventListener('click', () => {\n      this.exportChat();\n      this.exportChatMessages();\n    });\n  }\n\n  async exportChat() {\n    const request = await Chat.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chats.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n\n  async exportChatMessages() {\n    const request = await ChatMessage.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chat_messages.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n}\n","export class LocalStorage {\n  // Set a value in localStorage\n  set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Get a value from localStorage, return defaultValue if key doesn't exist\n  get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Remove a value from localStorage\n  remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n}\n","import { debounce } from './debounce.js';\nimport { Event } from './Event.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\nimport { ChatList } from './ChatList.js';\nimport { DownloadChatsButton } from './DownloadChatsButton.js';\nimport { LocalStorage } from './models/LocalStorage.js';\n\nexport class Sidebar {\n  constructor() {\n    this.settings = new LocalStorage();\n    this.chatList = new ChatList();\n    this.element = document.getElementById('sidebar');\n    this.newChatButton = this.element.querySelector('#new-chat-button');\n    this.clearButton = this.element.querySelector('#clear-button');\n    this.hamburgerButton = document.getElementById('hamburger-menu');\n    this.searchButton = document.getElementById('search-button');\n    this.downloadChatsButton = new DownloadChatsButton();\n    this.searchRow = document.getElementById('search-row');\n    this.searchInput = document.getElementById('search-input');\n    if (this.settings.get('sidebar-collapsed') === true) {\n      this.element.classList.add('collapsed');\n    }\n    this.bindEventListeners();\n    this.render();\n  }\n\n  render() {\n    this.chatList.render();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    this.searchButton.addEventListener('click', this.toggleSearch.bind(this));\n    this.searchInput.addEventListener(\n      'keypress',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.searchInput.addEventListener(\n      'keyup',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.newChatButton.addEventListener('click', this.handleNewChat.bind(this));\n    this.clearButton.addEventListener('click', this.handleClear.bind(this));\n    this.hamburgerButton.addEventListener('click', this.toggle.bind(this));\n  }\n\n  // TODO: Fix\n  handleChatSelected = (chat) => {\n    const listItem = this.element.querySelector(`chat${chat.id}`);\n    if (listItem) {\n      listItem.scrollIntoView({\n        behavior: 'smooth',\n        block: 'start', // \"start\" will bring the top of the element into view\n        inline: 'nearest', // \"nearest\" will scroll to the nearest edge if partially visible\n      });\n    }\n  };\n\n  toggleSearch() {\n    const searchRow = document.getElementById('search-row');\n    searchRow.classList.toggle('hidden');\n    this.searchInput.focus();\n  }\n\n  performSearch() {\n    function escapeRegExp(string) {\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // Escapes special characters\n    }\n    const query = escapeRegExp(this.searchInput.value.trim()).replace(\n      /\\s+/g,\n      '.*',\n    );\n    const queryContent = query.length > 2; // Nobody wants to query content based on one character?\n    const regex = new RegExp(query, 'i'); // 'i' for case-insensitive matching\n    console.log(`Search ${query}`);\n    Chat.getAll().then((chats) => {\n      const matches = chats\n        .filter((chat) => {\n          let match = regex.test(chat.title);\n          if (queryContent) {\n            match ||= regex.test(chat.content);\n          }\n          return match;\n        })\n        .map((chat) => chat.id);\n      this.element.querySelectorAll('.chat-list-item').forEach((item) => {\n        if (matches.includes(item.data.id)) {\n          // Now matches the type\n          item.classList.remove('hidden');\n        } else {\n          item.classList.add('hidden');\n        }\n      });\n    });\n  }\n\n  toggle() {\n    this.element.classList.toggle('collapsed');\n    this.hamburgerButton.classList.toggle('collapsed');\n    if (this.element.classList.contains('collapsed')) {\n      this.settings.set('sidebar-collapsed', true);\n    } else {\n      this.settings.set('sidebar-collapsed', false);\n    }\n  }\n\n  async handleNewChat() {\n    await AppController.createChat();\n  }\n\n  async handleClear() {\n    await AppController.clearChats();\n  }\n}\n","import { UINotification } from './UINotification.js';\n\nexport class CopyButton {\n  constructor() {\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('copy-button')) {\n        const targetSelector = event.target.getAttribute('data-target');\n        if (!targetSelector) {\n          console.error('The data-target attribute is not set');\n          return;\n        }\n        const textToCopy = document.getElementById(targetSelector).innerText;\n        // Create a temporary textarea element\n        const textarea = document.createElement('textarea');\n        textarea.value = textToCopy;\n        document.body.appendChild(textarea);\n\n        // Select the text and copy it\n        textarea.select();\n        document.execCommand('copy');\n\n        // Remove the temporary textarea\n        document.body.removeChild(textarea);\n\n        // Optional: Display a message or change the button text/content\n        UINotification.show('Text copied to clipboard').autoDismiss();\n      }\n    });\n  }\n}\n","export class OllamaApi {\n  constructor() {\n    this.abortController = null;\n  }\n\n  async makeRequest(chat, userMessage, systemPrompt, modelParameters) {\n    const requestData = {\n      prompt: userMessage,\n      model: chat.model,\n      messages: (await chat.getMessages()).map((message) => ({\n        role: message.role,\n        content: message.content,\n      })),\n    };\n    // Add system prompt\n    if (systemPrompt) {\n      requestData.system = systemPrompt;\n    }\n    // Add model parameters\n    if (modelParameters) {\n      requestData.options = modelParameters;\n    }\n    return requestData;\n  }\n\n  async send(url, data, onResponse, onError, onDone) {\n    const request = { data };\n    try {\n      const response = await this.postChatMessage(url, data);\n      await this.handleResponse(request, response, onResponse, onDone);\n    } catch (error) {\n      onError(request, error);\n    }\n  }\n\n  async postChatMessage(url, data) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n    const response = await fetch(url, {\n      signal,\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      throw new Error(`${url} failed with status ${response.status}`);\n    }\n\n    return response;\n  }\n\n  async handleResponse(request, response, onResponse, onDone) {\n    const reader = response.body.getReader();\n    let partialLine = '';\n    var isRequestDone = false;\n\n    while (!isRequestDone) {\n      const { done, value } = await reader.read();\n      if (done) {\n        onDone(request, response);\n        isRequestDone = true;\n        continue;\n      }\n\n      const textChunk = new TextDecoder().decode(value);\n      const lines = (partialLine + textChunk).split('\\n');\n      partialLine = lines.pop();\n\n      lines.forEach((line) => {\n        const responseData = JSON.parse(line);\n        if (line.trim()) {\n          // TODO: Move this line:\n          this.printResponseStats(responseData);\n          onResponse(request, responseData.message.content);\n        }\n      });\n    }\n\n    if (partialLine.trim()) {\n      onResponse(request, partialLine);\n    }\n  }\n\n  abort() {\n    if (this.abortController) {\n      this.abortController.abort();\n    }\n  }\n\n  printResponseStats(data) {\n    if (!data.total_duration) {\n      return;\n    }\n    // Convert nanoseconds to seconds for durations\n    const totalDurationInSeconds = data.total_duration / 1e9;\n    const loadDurationInSeconds = data.load_duration / 1e9;\n    const promptEvalDurationInSeconds = data.prompt_eval_duration / 1e9;\n    const responseEvalDurationInSeconds = data.eval_duration / 1e9;\n\n    // Calculate tokens per second (token/s)\n    const tokensPerSecond = data.eval_count / responseEvalDurationInSeconds;\n    const output = `\nModel: ${data.model}\nCreated At: ${data.created_at}\nTotal Duration (s): ${totalDurationInSeconds.toFixed(2)}\nLoad Duration (s): ${loadDurationInSeconds.toFixed(2)}\nPrompt Evaluation Count: ${data.prompt_eval_count}\nPrompt Evaluation Duration (s): ${promptEvalDurationInSeconds.toFixed(2)}\nResponse Evaluation Count: ${data.eval_count}\nResponse Evaluation Duration (s): ${responseEvalDurationInSeconds.toFixed(2)}\nTokens Per Second: ${tokensPerSecond.toFixed(2)} token/s\n    `;\n    console.log(output);\n  }\n\n  static getModels(url, onResponse) {\n    if (!url) {\n      return null;\n    }\n\n    return fetch(url)\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error(`Unable to fetch models from ${url}`);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        onResponse(data.models);\n      })\n      .catch((error) => {\n        console.debug(error);\n        console.error(\n          `Please ensure the server is running at: ${url}. Error code: 39847`,\n        );\n        onResponse([]);\n      });\n  }\n}\n","export class DownloadButton {\n  constructor() {\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('download-button')) {\n        // Get the index from the data-target attribute\n        const targetId = event.target.getAttribute('data-target');\n        this.downloadElementContent(targetId, 'chat.html');\n      }\n    });\n  }\n\n  downloadElementContent(elementId, filename) {\n    // Get the element\n    const element = document.getElementById(elementId);\n    if (!element) {\n      console.error('Element not found');\n      return;\n    }\n\n    // Get the contents of the element\n    const content = element.innerText;\n\n    // Create a Blob with the content\n    const blob = new Blob([content], { type: 'text/html' });\n\n    // Create an anchor element and set the href to the blob\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = filename;\n\n    // Append the anchor to the document, trigger a click, and then remove it\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n\n    // Revoke the blob URL\n    URL.revokeObjectURL(a.href);\n  }\n}\n","export class DropDownMenu {\n  constructor() {\n    this.buttonSelector = '.drop-down-menu';\n    this.dropDownMenus = document.querySelectorAll(this.buttonSelector);\n    this.init();\n  }\n\n  init() {\n    // Add a click listener to the whole document\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element or any of its parents has the 'drop-down-menu' class\n      const menuElement = event.target.closest(this.buttonSelector);\n      if (menuElement) {\n        const dropDownMenu = menuElement.querySelector('.drop-down-menu-items');\n        if (dropDownMenu) {\n          this.toggleMenu(dropDownMenu);\n        }\n      }\n    });\n  }\n\n  toggleMenu(menu) {\n    menu.classList.toggle('hidden');\n    menu.classList.toggle('visible');\n  }\n}\n","// Modal base class\nexport class Modal {\n  constructor(templateId, title) {\n    this.templateId = templateId;\n    this.modal = this.createDialogElement();\n    this.titleElement = this.modal.querySelector('.modal-title');\n    this.closeButton = this.modal.querySelector('.button-close');\n    this.closeButton.onclick = () => this.hide();\n    this._bindEventListeners();\n    this.setTitle(title);\n  }\n\n  setTitle(title) {\n    this.titleElement.textContent = title;\n  }\n\n  _bindEventListeners() {\n    this.modal.addEventListener('click', (event) => {\n      if (event.target == this.modal) {\n        this.hide();\n      }\n    });\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  createDialogElement() {\n    const template = document.getElementById(this.templateId);\n    if (!template) {\n      console.error(`Template with ID ${this.templateId} not found.`);\n      return;\n    }\n\n    const clone = template.content.cloneNode(true);\n    const modalElement = clone.firstElementChild;\n\n    if (!modalElement) {\n      console.error(\n        `No modal element found in the template with ID ${this.templateId}.`,\n      );\n      return;\n    }\n\n    document.body.appendChild(modalElement);\n\n    return modalElement;\n  }\n\n  show() {\n    this.handleShow();\n  }\n\n  hide() {\n    this.handleHide();\n  }\n\n  handleShow() {\n    this.modal.classList.add('show');\n  }\n\n  handleHide() {\n    this.modal.classList.remove('show');\n  }\n}\n","export class List {\n  constructor(container, items) {\n    this.container = container;\n    this.items = items;\n    this.render();\n    this.clickHandler = null;\n  }\n\n  onClick(handler) {\n    this.clickHandler = handler;\n    return this; // Allow chaining\n  }\n\n  setItems(items) {\n    this.items = items;\n    this.render();\n  }\n\n  setSelected(selected) {\n    console.debug(`Select ${selected}`);\n    this.selected = selected;\n    this.render();\n  }\n\n  getSelected() {\n    return this.selected;\n  }\n\n  render() {\n    this.container.innerHTML = ''; // Clear existing content\n    const ul = document.createElement('ul');\n    ul.classList.add('list');\n    this.items.forEach((item) => {\n      const li = document.createElement('li');\n      li.classList.add('list-item');\n      if (item === this.selected) {\n        li.classList.add('selected');\n      }\n      li.textContent = item;\n      li.item = item;\n      li.addEventListener('click', () => {\n        this.setSelected(item);\n        if (this.clickHandler) {\n          this.clickHandler(item);\n        }\n      });\n      ul.appendChild(li);\n    });\n    this.container.appendChild(ul);\n  }\n}\n","import { Event } from '../Event.js';\nimport { Settings } from './Settings.js';\nimport { OllamaApi } from '../OllamaApi.js';\n\nexport class Models {\n  static models = [];\n\n  static getUrl() {\n    return Settings.getUrl('/api/tags');\n  }\n\n  static load() {\n    if (!this.getUrl()) {\n      return null;\n    }\n    return OllamaApi.getModels(this.getUrl(), (models) => {\n      Models.models = models;\n      Settings.set('models', Models.models);\n      Event.emit('modelsLoaded', Models.models);\n    });\n  }\n\n  static getAll() {\n    return Models.models;\n  }\n\n  static getNames() {\n    return Models.models.map((model) => model.name);\n  }\n\n  static findModelByName(name) {\n    return Models.models.find((model) => model.name === name);\n  }\n}\n","import { List } from './List.js';\nimport { Event } from './Event.js';\nimport { Models } from './models/Models.js';\n\nexport class ModelsList extends List {\n  constructor(container) {\n    super(container, Models.getNames());\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    Event.listen('modelsLoaded', this.handleModelsLoaded.bind(this));\n  }\n\n  handleModelsLoaded() {\n    this.setItems(Models.getNames());\n  }\n}\n","import { Modal } from './Modal.js';\nimport { UINotification } from './UINotification.js';\nimport { ModelsList } from './ModelsList.js';\nimport { Models } from './models/Models.js';\nimport { Settings } from './models/Settings.js';\n\nexport class SettingsDialog extends Modal {\n  static templateId = 'settings-dialog-template';\n\n  constructor(showButtonId, title) {\n    super(SettingsDialog.templateId, title);\n    this.showButton = document.getElementById(showButtonId);\n    this.urlInput = this.modal.querySelector('#input-url');\n    this.modelInput = this.modal.querySelector('#input-model');\n    this.systemPromptInput = this.modal.querySelector('#input-system-prompt');\n    this.modelParametersInput = this.modal.querySelector(\n      '#input-model-parameters',\n    );\n    this.refreshModelsButton = this.modal.querySelector(\n      '.refresh-models-button',\n    );\n    this.modelList = new ModelsList(this.modal.querySelector('#model-list'));\n    this.bindEventListeners();\n  }\n\n  getSelected() {\n    return Settings.getModel();\n  }\n\n  bindEventListeners() {\n    this.urlInput.addEventListener('blur', this.handleUrlUpdated.bind(this));\n    this.systemPromptInput.addEventListener(\n      'blur',\n      this.handleSystemPromptUpdated.bind(this),\n    );\n    this.modelParametersInput.addEventListener('blur', () =>\n      this.handleModelParametersUpdated.bind(this),\n    );\n    this.modelList.onClick(this.handleModelUpdated.bind(this));\n    this.showButton.addEventListener('click', this.show.bind(this));\n    this.refreshModelsButton.addEventListener(\n      'click',\n      this.refreshModels.bind(this),\n    );\n    this.closeButton.addEventListener('click', this.hide.bind(this));\n  }\n\n  handleSystemPromptUpdated() {\n    Settings.setSystemPrompt(this.systemPromptInput.value.trim());\n  }\n\n  handleModelUpdated() {\n    Settings.setModel(this.modelList.getSelected());\n  }\n\n  handleModelParametersUpdated() {\n    const value = this.modelParametersInput.value.trim();\n    if (value === '') {\n      return;\n    }\n    try {\n      const parsedValue = JSON.parse(value);\n      const prettyJSON = JSON.stringify(parsedValue, 2);\n      Settings.setModelParameters(parsedValue);\n      this.modelParametersInput.value = prettyJSON;\n      this.modelParametersInput.classList.remove('error');\n    } catch (error) {\n      if (error.name === 'SyntaxError') {\n        this.modelParametersInput.classList.add('error');\n      } else {\n        console.error(error);\n      }\n    }\n  }\n\n  handleUrlUpdated() {\n    const value = this.urlInput.value.trim();\n    Settings.setUrl(value);\n  }\n\n  show() {\n    this.loadSettings();\n    Models.load();\n    this.handleShow();\n  }\n\n  refreshModels() {\n    if (!Models.getUrl()) {\n      UINotification.show('Please update the URL in the settings to continue.');\n    } else {\n      Models.load();\n    }\n  }\n\n  loadSettings() {\n    this.modelList.setSelected(this.getSelected());\n    this.urlInput.value = Settings.getUrl();\n    const modelParameters = Settings.getModelParameters();\n    if (modelParameters) {\n      this.modelParametersInput.value = JSON.stringify(modelParameters, 2);\n    }\n  }\n}\n","import { AppController } from './AppController.js';\nimport { SettingsDialog } from './SettingsDialog.js';\nimport { Settings } from './models/Settings.js';\n\nexport class ChatSettingsDialog extends SettingsDialog {\n  constructor(showButtonId, title) {\n    super(showButtonId, title);\n  }\n\n  getSelected() {\n    return this.chat?.model;\n  }\n\n  async handleSystemPromptUpdated() {\n    this.chat.systemPrompt = this.systemPromptInput.value.trim();\n    await this.chat.save();\n  }\n\n  async handleModelUpdated() {\n    this.chat.model = this.modelList.getSelected();\n    await this.chat.save();\n  }\n\n  async handleModelParametersUpdated() {\n    this.chat.modelParameters = this.modelParametersInput.value.trim();\n    await this.chat.save();\n  }\n\n  async handleUrlUpdated() {\n    this.chat.url = this.urlInput.value.trim();\n    await this.chat.save();\n  }\n\n  loadSettings() {\n    AppController.getCurrentChat().then((chat) => {\n      this.modelList.setSelected(chat.model);\n      this.chat = chat;\n      this.urlInput.value = this.chat.url || Settings.getUrl();\n      const modelParameters =\n        this.chat.modelParameters || Settings.getModelParameters();\n      if (modelParameters) {\n        this.modelParametersInput.value = JSON.stringify(modelParameters, 2);\n      }\n    });\n  }\n}\n","import { Event } from './Event.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatModelInfo {\n  constructor() {\n    this.element = document.getElementById('chat-model-info');\n    this.nameElement = this.element.querySelector('.chat-model-name');\n    this.bindEventListeners();\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.render();\n    });\n  }\n\n  render() {\n    this.nameElement.textContent = this.chat?.model;\n  }\n\n  bindEventListeners() {\n    // Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.render();\n  }\n}\n","export class ExportChat {\n  static exportChat(chat, filename) {\n    // Get the contents of the element\n    const content = chat.jsonify();\n\n    // Create a Blob with the content\n    const blob = new Blob([content], { type: 'application/json' });\n\n    // Create an anchor element and set the href to the blob\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = filename;\n\n    // Append the anchor to the document, trigger a click, and then remove it\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n\n    // Revoke the blob URL\n    URL.revokeObjectURL(a.href);\n  }\n}\n","export class Hoverable {\n  constructor(element) {\n    this.element = element;\n    element.hoverable = this;\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', () => this.onMouseover());\n    this.element.addEventListener('mouseout', () => this.onMouseout());\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n}\n","import { Event } from './Event.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatTitle {\n  constructor() {\n    this.defaultTitle = 'Untitled';\n    this.element = document.getElementById('chat-title');\n    this.bindEventListeners();\n    this.render();\n  }\n\n  render() {\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.setTitle(chat?.title);\n    });\n  }\n\n  setTitle(title) {\n    this.element.textContent = title || this.defaultTitle;\n  }\n\n  focus() {\n    const hasFocus = document.activeElement === this.element;\n    if (!hasFocus) {\n      this.element.focus();\n    }\n  }\n\n  bindEventListeners() {\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    this.element.addEventListener('blur', this.handleSave.bind(this));\n    this.element.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        this.element.blur();\n      }\n    });\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.setTitle(chat.title);\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat.id) {\n      this.setTitle(this.defaultTitle);\n    }\n  }\n\n  async handleSave() {\n    let title = this.element.textContent.trim();\n    if (title.length === 0) {\n      title = this.defaultTitle;\n      this.element.classList.add('error');\n    } else {\n      this.element.classList.remove('error');\n    }\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.updateChat(chat, { title });\n    } else {\n      await AppController.createChat({ title });\n    }\n  }\n}\n","// TODO: Move code here from App.js\nexport class ChatForm {\n  constructor() {\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n  }\n}\n","import { UINotification } from './UINotification.js';\nimport { AppController } from './AppController.js';\nimport { ExportChat } from './ExportChat.js';\nimport { Event } from './Event.js';\nimport { Hoverable } from './Hoverable.js';\nimport { ChatTitle } from './ChatTitle.js';\nimport { ChatForm } from './ChatForm.js';\n\nexport class ChatArea {\n  constructor() {\n    this.chatTitle = new ChatTitle();\n    this.chatForm = new ChatForm();\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.editChatButton = document.getElementById('edit-chat-button');\n    this.scrollToTopButton = document.getElementById('scroll-to-top-button');\n    this.scrollToEndButton = document.getElementById('scroll-to-end-button');\n    this.deleteChatButton = document.getElementById('delete-chat-button');\n    this.exportChatButton = document.getElementById('export-chat-button');\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.render();\n    });\n    this.bindEventListeners();\n  }\n\n  render() {\n    // Clear history view\n    this.chatHistory.innerText = '';\n    if (this.chat) {\n      this.chat // Render chat history\n        .getMessages()\n        .then((messages) => {\n          messages.forEach((message) => {\n            this.createMessageDiv(message);\n          });\n        });\n      this.scrollToEnd();\n    }\n    this.messageInput.focus();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    this.scrollToTopButton.addEventListener(\n      'click',\n      this.scrollToTop.bind(this),\n    );\n    this.scrollToEndButton.addEventListener(\n      'click',\n      this.scrollToEnd.bind(this),\n    );\n    this.editChatButton.addEventListener(\n      'click',\n      this.handleEditChat.bind(this),\n    );\n    this.deleteChatButton.addEventListener(\n      'click',\n      this.handleDeleteChat.bind(this),\n    );\n    this.exportChatButton.addEventListener('click', () => {\n      ExportChat.exportChat(this.chat, `chat-${this.chat.id}.json`);\n    });\n    this.currentMessage = this.chatHistory.querySelector('.selected');\n    // Select chat message with arrow up and arrow down keys\n    document.addEventListener('keydown', (event) => {\n      let next, previous;\n\n      if (event.key === 'ArrowDown') {\n        next = this.currentMessage\n          ? this.currentMessage.nextElementSibling\n          : this.chatHistory.firstElementChild;\n        if (next) {\n          if (this.currentMessage)\n            this.currentMessage.classList.remove('hover');\n          next.classList.add('hover');\n          this.currentMessage = next; // Update currentMessage\n          this.currentMessage.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          }); // Scroll into view\n        }\n      } else if (event.key === 'ArrowUp') {\n        previous = this.currentMessage\n          ? this.currentMessage.previousElementSibling\n          : this.chatHistory.lastElementChild;\n        if (previous) {\n          if (this.currentMessage)\n            this.currentMessage.classList.remove('hover');\n          previous.classList.add('hover');\n        }\n        this.currentMessage = previous; // Update currentMessage\n        this.currentMessage.scrollIntoView({\n          behavior: 'smooth',\n          block: 'nearest',\n        }); // Scroll into view\n      }\n    });\n  }\n\n  createMessageDiv(message) {\n    const domId = `chat-message-${message.id}`;\n    const role = message.role;\n    const content = message.content;\n    // Get the template and its content\n    const template = document.getElementById('chat-message-template');\n    const messageClone = template.content.cloneNode(true);\n    // Find the div and span elements within the cloned template\n    const messageDiv = messageClone.querySelector('.chat-message');\n    const textSpan = messageClone.querySelector('.chat-message-text');\n    const deleteButton = messageClone.querySelector(\n      '.delete-chat-message-button',\n    );\n    const copyButton = messageClone.querySelector(\n      '.copy-chat-message-button .copy-button',\n    );\n    const goodButton = messageClone.querySelector('.good-chat-message-button');\n    const badButton = messageClone.querySelector('.bad-chat-message-button');\n    const flagButton = messageClone.querySelector('.flag-chat-message-button');\n\n    if (message.quality == 'bad') {\n      badButton.classList.add('selected');\n    } else if (message.quality == 'good') {\n      goodButton.classList.add('selected');\n    } else if (message.quality == 'flagged') {\n      flagButton.classList.add('selected');\n    }\n\n    // Set the class for role and text content\n    messageDiv.classList.add(`${role}-chat-message`);\n    messageDiv.id = domId;\n    textSpan.textContent = content;\n    messageDiv.spellcheck = false;\n\n    // Append to chatHistory and adjust scroll\n    this.chatHistory.appendChild(messageDiv);\n    messageDiv.dataset['id'] = message.id;\n    new Hoverable(messageDiv);\n    deleteButton.addEventListener('click', async () => {\n      await AppController.deleteChatMessage(message.id);\n      messageDiv.remove();\n    });\n    copyButton.dataset['target'] = domId;\n    flagButton.addEventListener('click', async () => {\n      UINotification.show('Flagged message').autoDismiss();\n      message.quality = 'flagged';\n      await message.save();\n    });\n    goodButton.addEventListener('click', async () => {\n      UINotification.show('Marked message as good').autoDismiss();\n      message.quality = 'good';\n      await message.save();\n    });\n    badButton.addEventListener('click', async () => {\n      UINotification.show('Marked message as bad').autoDismiss();\n      message.quality = 'bad';\n      await message.save();\n    });\n    return { element: messageDiv, textElement: textSpan };\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat?.id) {\n      this.chat = null;\n    } else {\n      this.chat = chat;\n    }\n    this.render();\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.render();\n  }\n\n  handleEditChat() {\n    this.chatTitle.focus();\n    event.stopPropagation();\n  }\n\n  async handleDeleteChat() {\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.deleteChat(chat);\n    }\n  }\n\n  scrollToTop() {\n    this.chatHistory.scrollTop = 0;\n  }\n\n  scrollToEnd() {\n    this.chatHistory.scrollTop = this.chatHistory.scrollHeight;\n  }\n}\n","import { UINotification } from './UINotification.js';\nimport { Settings } from './models/Settings.js';\nimport { Event } from './Event.js';\nimport { DOM } from './Dom.js';\nimport { Sidebar } from './Sidebar.js';\nimport { AppController } from './AppController.js';\nimport { CopyButton } from './CopyButton.js';\nimport { OllamaApi } from './OllamaApi.js';\n// import { OpenAiApi } from './OpenAiApi.js';\nimport { DownloadButton } from './DownloadButton.js';\nimport { DropDownMenu } from './DropDownMenu.js';\nimport { SettingsDialog } from './SettingsDialog.js';\nimport { ChatSettingsDialog } from './ChatSettingsDialog.js';\nimport { ChatModelInfo } from './ChatModelInfo.js';\n// import { MarkdownFormatter } from './MarkdownFormatter.js'\nimport { ChatArea } from './ChatArea.js';\n\n// TODO: Review and refactor\nexport class App {\n  static run() {\n    UINotification.initialize();\n    const app = new App();\n    return app;\n  }\n\n  constructor() {\n    this.sidebar = new Sidebar();\n    this.chatArea = new ChatArea();\n    this.chatModelInfo = new ChatModelInfo();\n    this.api = new OllamaApi();\n    // this.api = new OpenAiApi();\n    this.settingsDialog = new SettingsDialog(\n      'settings-button',\n      'Global settings',\n    );\n    this.chatSettingsDialog = new ChatSettingsDialog(\n      'chat-settings-button',\n      'Chat settings',\n    );\n    this.downloadButton = new DownloadButton();\n    this.copyButton = new CopyButton();\n    this.dropDownMenu = new DropDownMenu();\n    this.initializeElements();\n    this.bindEventListeners();\n    this.logInitialization();\n  }\n\n  initializeElements() {\n    // this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n    this.messageInput = document.getElementById('message-input');\n    this.chatHistory = document.getElementById('chat-history');\n  }\n\n  logInitialization() {\n    const msg = `~~~~\\nChat\\n~~~~\nModel:       ${Settings.getModel()}\nURL:         ${Settings.getUrl()}\nChat:        ${Settings.getCurrentChatId()}\nParameters:  ${JSON.stringify(Settings.getModelParameters())}\n`;\n    console.log(msg);\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    // this.sendButton.addEventListener('click', this.sendMessage.bind(this));\n    this.abortButton.addEventListener('click', this.handleAbort.bind(this));\n    this.messageInput.addEventListener(\n      'keypress',\n      this.handleKeyPress.bind(this),\n    );\n  }\n\n  handleChatSelected = (chat) => {\n    window.history.pushState({}, '', `/chats/${chat.id}`);\n  };\n\n  handleAbort = () => {\n    this.api.abort();\n    this.enableForm();\n    console.log('Request aborted');\n  };\n\n  handleKeyPress = (event) => {\n    if (event.key === 'Enter' && !event.shiftKey) {\n      this.sendMessage();\n    }\n  };\n\n  enableForm() {\n    DOM.hideElement(this.abortButton).enableInput(this.messageInput);\n    this.messageInput.focus();\n  }\n\n  disableForm() {\n    DOM.showElement(this.abortButton).disableInput(this.messageInput);\n  }\n\n  // https://github.com/jmorganca/ollama/blob/main/docs/api.md#generate-a-completion\n  async sendMessage() {\n    const userPrompt = this.messageInput.value.trim();\n    // Get the current chat\n    let chat = await AppController.getCurrentChat();\n    const url = Settings.getUrl('/api/chat');\n    if (!url) {\n      UINotification.show(\n        'Please update the URL in the settings to continue. ',\n      );\n      return null;\n    }\n    if (userPrompt) {\n      // Reset input\n      this.messageInput.value = '';\n      // Create new chat\n      if (!chat) {\n        chat = await AppController.createChat({\n          title: 'Untitled',\n          model: Settings.getModel(),\n        });\n      }\n      // Store user message\n      const userMessage = await chat.addMessage({\n        role: 'user',\n        content: userPrompt,\n      });\n      const systemMessage = await chat.addMessage({\n        role: 'assistant',\n        content: '',\n      });\n      const systemPrompt = Settings.getSystemPrompt();\n      const modelParameters = Settings.getModelParameters();\n      // Disable form\n      this.disableForm();\n      // Create user message\n      this.createChatMessage(userMessage);\n      // Create system message container\n      const responseElement = this.createChatMessage(systemMessage);\n      const requestContext = {\n        chat,\n        userMessage,\n        systemMessage,\n        responseElement,\n      };\n      const requestData = await this.api.makeRequest(\n        chat,\n        userMessage,\n        systemPrompt,\n        modelParameters,\n      );\n      /*\n      console.dir(requestData);\n      const requestData = {\n        prompt: userMessage,\n        model: chat.model,\n        messages: (await chat.getMessages()).map((message) => ({\n          role: message.role,\n          content: message.content,\n        })),\n      };\n      // Add system prompt\n      if (systemPrompt) {\n        requestData.system = systemPrompt;\n      }\n      // Add model parameters\n      if (modelParameters) {\n        requestData.options = modelParameters;\n      }\n      */\n      // Show spinner\n      responseElement.textElement.innerHTML = '<div class=\"waiting\"></div>';\n      this.chatArea.scrollToEnd();\n      // Make request\n      this.api.send(\n        url,\n        requestData,\n        (request, response) =>\n          this.handleResponse(request, response, requestContext),\n        (request, error) => this.handleResponseError(request, error),\n        (request, response) =>\n          this.handleDone(request, response, requestContext),\n      );\n    }\n  }\n\n  createChatMessage(message) {\n    return this.chatArea.createMessageDiv(message);\n  }\n\n  handleResponse(request, response, context) {\n    const responseElement = context.responseElement;\n    const sanitizedContent = this.sanitizeContent(response);\n    // Remember original response\n    context.systemMessage.content += sanitizedContent;\n    responseElement.textElement.textContent += sanitizedContent;\n    this.chatArea.scrollToEnd();\n  }\n\n  handleResponseError(request, error) {\n    // Ignore \"Abort\" button\n    if (error !== undefined && error.name !== 'AbortError') {\n      console.error(`Error: ${error.message}`);\n    }\n    this.chatArea.scrollToEnd();\n    this.enableForm();\n  }\n\n  async handleDone(request, response, context) {\n    const chat = context.chat;\n    console.log(`Chat ${chat.id} done`);\n    await context.systemMessage.save();\n    this.enableForm();\n  }\n\n  sanitizeContent = (content) => {\n    // TODO: Sanitization logic here\n    return content;\n  };\n\n  getIdParam = () => {\n    return new URL(window.location.href).pathname.split('/').pop();\n  };\n}\n","import { App } from './App.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\n// TODO: refactor\nasync function initialize() {\n  await Chat.initialize();\n  await ChatMessage.initialize();\n}\n\ninitialize().then(() => {\n  App.run();\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}