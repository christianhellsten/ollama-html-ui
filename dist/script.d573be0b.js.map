{"version":3,"sources":["js/UINotification.js","js/models/Settings.js","js/Event.js","js/Dom.js","js/debounce.js","js/Database.js","js/Migrations.js","js/models/BaseModel.js","js/models/ChatMessage.js","js/models/Chat.js","js/AppController.js","js/ChatListItem.js","js/DragAndDrop.js","js/ChatList.js","js/DownloadChatsButton.js","js/models/LocalStorage.js","js/Sidebar.js","js/CopyButton.js","js/OllamaApi.js","js/DownloadButton.js","js/DropDownMenu.js","js/Modal.js","js/List.js","js/models/Models.js","js/ModelsList.js","js/SettingsDialog.js","js/ChatSettingsDialog.js","js/ExportChat.js","js/Hoverable.js","js/ChatTitle.js","js/ChatForm.js","js/ChatArea.js","js/App.js","js/script.js","../../../../../usr/local/lib/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["simpleHash","str","hash","i","length","char","charCodeAt","UINotification","constructor","message","type","id","JSON","stringify","domId","container","document","body","template","getElementById","content","_bindEventListeners","window","addEventListener","event","key","hide","show","notification","initialize","originalConsoleError","console","error","_len","arguments","args","Array","_key","apply","handleApplicationError","debug","clone","cloneNode","notificationElement","querySelector","textContent","classList","add","closeButton","onclick","appendChild","remove","exports","Settings","set","value","stringValue","localStorage","setItem","e","get","defaultValue","undefined","getItem","parse","removeItem","getUrl","uri","baseUrl","URL","href","setUrl","url","getModel","setModel","model","getSystemPrompt","setSystemPrompt","systemPrompt","getModelParameters","setModelParameters","modelParameters","getCurrentChatId","setCurrentChatId","chatId","Event","listen","eventName","handler","detail","emit","data","log","CustomEvent","bubbles","dispatchEvent","DOM","showElement","element","hideElement","enableInput","removeAttribute","disableInput","setAttribute","debounce","func","wait","timeout","funcWrapper","later","clearTimeout","setTimeout","Database","dbName","objectStores","migrations","dbConnection","open","Error","Promise","resolve","reject","request","indexedDB","version","onerror","target","onupgradeneeded","db","result","transaction","currentTarget","upgrade","oldVersion","onsuccess","storeName","mode","objectStore","store","handleRequest","put","delete","getAll","clear","Migrations","database","funcName","upgradeFunc","upgradeToVersion2","context","createObjectStore","keyPath","autoIncrement","chatMessages","createIndex","unique","_Database","require","_Migrations","BaseModel","Object","assign","create","save","jsonify","name","records","map","getAllByIndexAndId","indexName","index","messages","export","_BaseModel","ChatMessage","getAllByChatId","_ChatMessage","Chat","addMessage","getMessages","chat","_Event","_Chat","_Settings","AppController","updateChat","createChat","title","deleteChatMessage","messageId","deleteChat","getCurrentChat","setCurrentChat","clearChats","_AppController","ChatListItem","chatList","selected","setTitle","bindEventListeners","render","onMouseover","bind","onMouseout","onClick","selectChat","chatTitle","DragAndDrop","selector","listItems","querySelectorAll","draggedItem","initializeDragAndDrop","forEach","item","handleDragStart","handleDragOver","handleDrop","handleDragEnd","preventDefault","currentHTML","innerHTML","_ChatListItem","_DragAndDrop","ChatList","then","handleChatCreated","handleChatDeleted","handleChatsCleared","handleChatUpdated","handleChatSelected","appendChat","elements","listElement","previousListElement","newListElement","currentChatId","chats","chatListItem","DownloadChatsButton","button","exportChat","exportChatMessages","jsonData","blob","Blob","createObjectURL","a","createElement","download","click","revokeObjectURL","errorCode","LocalStorage","_debounce","_ChatList","_DownloadChatsButton","_LocalStorage","Sidebar","settings","newChatButton","clearButton","hamburgerButton","searchButton","downloadChatsButton","searchRow","searchInput","toggleSearch","performSearch","handleNewChat","handleClear","toggle","listItem","scrollIntoView","behavior","block","inline","focus","escapeRegExp","string","replace","query","trim","queryContent","regex","RegExp","matches","filter","match","test","includes","contains","CopyButton","targetSelector","getAttribute","textToCopy","innerText","textarea","select","execCommand","removeChild","alert","OllamaApi","abortController","send","onResponse","onError","onDone","response","postChatMessage","handleResponse","AbortController","signal","fetch","method","headers","ok","status","reader","getReader","partialLine","isRequestDone","done","read","textChunk","TextDecoder","decode","lines","split","pop","line","responseData","printResponseStats","abort","total_duration","totalDurationInSeconds","loadDurationInSeconds","load_duration","promptEvalDurationInSeconds","prompt_eval_duration","responseEvalDurationInSeconds","eval_duration","tokensPerSecond","eval_count","output","created_at","toFixed","prompt_eval_count","getModels","json","models","catch","DownloadButton","targetId","downloadElementContent","elementId","filename","DropDownMenu","buttonSelector","dropDownMenus","init","menuElement","closest","dropDownMenu","toggleMenu","menu","Modal","modal","handleShow","handleHide","List","containerId","items","clickHandler","setItems","setSelected","getSelected","ul","li","_OllamaApi","Models","load","getNames","findModelByName","find","_List","_Models","ModelsList","selectedModel","modelList","handleModelsLoaded","_Modal","_UINotification","_ModelsList","SettingsDialog","showButton","urlInput","modelInput","systemPromptInput","modelParametersInput","refreshModelsButton","loadSettings","parsedValue","prettyJSON","refreshModels","ChatSettingsDialog","ExportChat","Hoverable","hoverable","ChatTitle","defaultTitle","hasFocus","activeElement","handleSave","blur","ChatForm","chatHistory","messageInput","sendButton","abortButton","_ExportChat","_Hoverable","_ChatTitle","_ChatForm","ChatArea","chatForm","editChatButton","scrollToTopButton","scrollToEndButton","deleteChatButton","exportChatButton","createMessageDiv","scrollToEnd","scrollToTop","handleEditChat","handleDeleteChat","currentMessage","next","previous","nextElementSibling","firstElementChild","previousElementSibling","lastElementChild","role","messageClone","messageDiv","textSpan","deleteButton","copyButton","goodButton","badButton","flagButton","quality","spellcheck","dataset","textElement","stopPropagation","scrollTop","scrollHeight","_Dom","_Sidebar","_CopyButton","_DownloadButton","_DropDownMenu","_SettingsDialog","_ChatSettingsDialog","_ChatArea","App","run","app","sidebar","chatArea","ollamaApi","settingsDialog","chatSettingsDialog","downloadButton","initializeElements","logInitialization","msg","handleAbort","handleKeyPress","history","pushState","enableForm","shiftKey","sendMessage","disableForm","userPrompt","userMessage","systemMessage","createChatMessage","responseElement","requestContext","requestData","prompt","system","options","handleResponseError","handleDone","sanitizedContent","sanitizeContent","getIdParam","location","pathname","_App","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","protocol","ws","onmessage","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","hmrApply","v","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","stack","overlay","createErrorOverlay","stackTrace","getParents","modules","parents","k","d","dep","isArray","concat","Function","deps","cached","cache","some","cb"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,UAAUA,CAACC,GAAG,EAAE;EACvB,IAAIC,IAAI,GAAG,CAAC;EACZ,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;IACnC,MAAME,IAAI,GAAGJ,GAAG,CAACK,UAAU,CAACH,CAAC,CAAC;IAC9BD,IAAI,GAAG,CAACA,IAAI,IAAI,CAAC,IAAIA,IAAI,GAAGG,IAAI;IAChCH,IAAI,GAAGA,IAAI,GAAGA,IAAI,CAAC,CAAC;EACtB;EACA,OAAOA,IAAI;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO,MAAMK,cAAc,CAAC;EAC1BC,WAAWA,CAACC,OAAO,EAAEC,IAAI,EAAE;IACzB,MAAMC,EAAE,GAAGX,UAAU,CAACY,IAAI,CAACC,SAAS,CAACJ,OAAO,CAAC,CAAC;IAC9C,IAAI,CAACC,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACI,KAAK,GAAI,gBAAeH,EAAG,EAAC;IACjC,IAAI,CAACI,SAAS,GAAGC,QAAQ,CAACC,IAAI;IAC9B,IAAI,CAACC,QAAQ,GAAGF,QAAQ,CAACG,cAAc,CAAC,uBAAuB,CAAC,CAACC,OAAO;IACxE,IAAI,CAACC,mBAAmB,CAAC,CAAC;EAC5B;EAEAA,mBAAmBA,CAAA,EAAG;IACpBC,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAGC,KAAK,IAAK;MAC5C,IAAIA,KAAK,CAACC,GAAG,KAAK,QAAQ,EAAE;QAC1B,IAAI,CAACC,IAAI,CAAC,CAAC;MACb;IACF,CAAC,CAAC;EACJ;EAEA,OAAOC,IAAIA,CAAClB,OAAO,EAAEC,IAAI,EAAE;IACzB,MAAMkB,YAAY,GAAG,IAAIrB,cAAc,CAACE,OAAO,EAAEC,IAAI,CAAC;IACtDkB,YAAY,CAACD,IAAI,CAAClB,OAAO,CAAC;EAC5B;EAEA,OAAOoB,UAAUA,CAAA,EAAG;IAClB;IACA,MAAMC,oBAAoB,GAAGC,OAAO,CAACC,KAAK;;IAE1C;IACAD,OAAO,CAACC,KAAK,GAAG,YAAmB;MAAA,SAAAC,IAAA,GAAAC,SAAA,CAAA9B,MAAA,EAAN+B,IAAI,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;QAAJF,IAAI,CAAAE,IAAA,IAAAH,SAAA,CAAAG,IAAA;MAAA;MAC/B9B,cAAc,CAACoB,IAAI,CAACQ,IAAI,CAAC;MACzB;MACAL,oBAAoB,CAACQ,KAAK,CAACP,OAAO,EAAEI,IAAI,CAAC;IAC3C,CAAC;EACH;EAEA,OAAOI,sBAAsBA,CAACP,KAAK,EAAE;IACnCD,OAAO,CAACS,KAAK,CAAC,cAAc,CAAC;IAC7BT,OAAO,CAACC,KAAK,CAACA,KAAK,CAAC;IACpBzB,cAAc,CAACoB,IAAI,CAACK,KAAK,CAAC;EAC5B;EAEAL,IAAIA,CAAClB,OAAO,EAAE;IACZ;IACA,MAAMgC,KAAK,GAAG,IAAI,CAACvB,QAAQ,CAACwB,SAAS,CAAC,IAAI,CAAC;;IAE3C;IACA,MAAMC,mBAAmB,GAAGF,KAAK,CAACG,aAAa,CAAC,eAAe,CAAC;IAChE,IAAI,CAACD,mBAAmB,EAAE;MACxBZ,OAAO,CAACC,KAAK,CAAC,iDAAiD,CAAC;MAChE;IACF;;IAEA;IACAS,KAAK,CAACG,aAAa,CAAC,uBAAuB,CAAC,CAACC,WAAW,GAAGpC,OAAO;IAElEkC,mBAAmB,CAAChC,EAAE,GAAG,IAAI,CAACG,KAAK,CAAC,CAAC;IACrC;IACA,IAAI,IAAI,CAACJ,IAAI,EAAE;MACbiC,mBAAmB,CAACG,SAAS,CAACC,GAAG,CAAE,gBAAe,IAAI,CAACrC,IAAK,EAAC,CAAC;IAChE;;IAEA;IACA,MAAMsC,WAAW,GAAGP,KAAK,CAACG,aAAa,CAAC,4BAA4B,CAAC;IACrEI,WAAW,CAACC,OAAO,GAAG,MAAM,IAAI,CAACvB,IAAI,CAAC,CAAC;;IAEvC;IACA,IAAI,CAACV,QAAQ,CAACG,cAAc,CAAC,IAAI,CAACL,KAAK,CAAC,EAAE;MACxC;MACA,IAAI,CAACC,SAAS,CAACmC,WAAW,CAACT,KAAK,CAAC;IACnC;EACF;EAEAf,IAAIA,CAAA,EAAG;IACLV,QAAQ,CAACG,cAAc,CAAC,IAAI,CAACL,KAAK,CAAC,EAAEqC,MAAM,CAAC,CAAC;EAC/C;AACF;AAACC,OAAA,CAAA7C,cAAA,GAAAA,cAAA;;;;;;;;AC9FM,MAAM8C,QAAQ,CAAC;EACpB;EACA,OAAOC,GAAGA,CAAC7B,GAAG,EAAE8B,KAAK,EAAE;IACrB,IAAI;MACF,MAAMC,WAAW,GAAG5C,IAAI,CAACC,SAAS,CAAC0C,KAAK,CAAC;MACzCE,YAAY,CAACC,OAAO,CAACjC,GAAG,EAAE+B,WAAW,CAAC;IACxC,CAAC,CAAC,OAAOG,CAAC,EAAE;MACV5B,OAAO,CAACC,KAAK,CAAC,8BAA8B,EAAE2B,CAAC,CAAC;IAClD;EACF;;EAEA;EACA,OAAOC,GAAGA,CAACnC,GAAG,EAAuB;IAAA,IAArBoC,YAAY,GAAA3B,SAAA,CAAA9B,MAAA,QAAA8B,SAAA,QAAA4B,SAAA,GAAA5B,SAAA,MAAG,IAAI;IACjC,IAAI;MACF,MAAMqB,KAAK,GAAGE,YAAY,CAACM,OAAO,CAACtC,GAAG,CAAC;MACvC,OAAO8B,KAAK,KAAK,IAAI,GAAG3C,IAAI,CAACoD,KAAK,CAACT,KAAK,CAAC,GAAGM,YAAY;IAC1D,CAAC,CAAC,OAAOF,CAAC,EAAE;MACV5B,OAAO,CAACC,KAAK,CAAC,iCAAiC,EAAE2B,CAAC,CAAC;MACnD,OAAOE,YAAY;IACrB;EACF;;EAEA;EACA,OAAOV,MAAMA,CAAC1B,GAAG,EAAE;IACjB,IAAI;MACFgC,YAAY,CAACQ,UAAU,CAACxC,GAAG,CAAC;IAC9B,CAAC,CAAC,OAAOkC,CAAC,EAAE;MACV5B,OAAO,CAACC,KAAK,CAAC,kCAAkC,EAAE2B,CAAC,CAAC;IACtD;EACF;EAEA,OAAOO,MAAMA,CAACC,GAAG,EAAE;IACjB,IAAI;MACF,MAAMC,OAAO,GAAGf,QAAQ,CAACO,GAAG,CAAC,KAAK,CAAC;MACnC,IAAIO,GAAG,EAAE;QACP,OAAO,IAAIE,GAAG,CAACF,GAAG,EAAEC,OAAO,CAAC,CAACE,IAAI;MACnC,CAAC,MAAM;QACL,OAAOF,OAAO;MAChB;IACF,CAAC,CAAC,OAAOpC,KAAK,EAAE;MACd,OAAO,IAAI;IACb;EACF;EAEA,OAAOuC,MAAMA,CAACC,GAAG,EAAE;IACjBnB,QAAQ,CAACC,GAAG,CAAC,KAAK,EAAEkB,GAAG,CAAC;EAC1B;EAEA,OAAOC,QAAQA,CAAA,EAAG;IAChB,OAAOpB,QAAQ,CAACO,GAAG,CAAC,OAAO,CAAC;EAC9B;EAEA,OAAOc,QAAQA,CAACC,KAAK,EAAE;IACrBtB,QAAQ,CAACC,GAAG,CAAC,OAAO,EAAEqB,KAAK,CAAC;EAC9B;EAEA,OAAOC,eAAeA,CAAA,EAAG;IACvB,OAAOvB,QAAQ,CAACO,GAAG,CAAC,eAAe,CAAC;EACtC;EAEA,OAAOiB,eAAeA,CAACC,YAAY,EAAE;IACnC,IAAIA,YAAY,KAAK,EAAE,EAAE;MACvBA,YAAY,GAAG,IAAI;IACrB;IACAzB,QAAQ,CAACC,GAAG,CAAC,eAAe,EAAEwB,YAAY,CAAC;EAC7C;EAEA,OAAOC,kBAAkBA,CAAA,EAAG;IAC1B,OAAO1B,QAAQ,CAACO,GAAG,CAAC,kBAAkB,CAAC;EACzC;EAEA,OAAOoB,kBAAkBA,CAACC,eAAe,EAAE;IACzC,IAAIA,eAAe,KAAK,EAAE,EAAE;MAC1BA,eAAe,GAAG,IAAI;IACxB;IACA5B,QAAQ,CAACC,GAAG,CAAC,kBAAkB,EAAE2B,eAAe,CAAC;EACnD;EAEA,OAAOC,gBAAgBA,CAAA,EAAG;IACxB,OAAO7B,QAAQ,CAACO,GAAG,CAAC,eAAe,CAAC;EACtC;EAEA,OAAOuB,gBAAgBA,CAACC,MAAM,EAAE;IAC9B,IAAIA,MAAM,KAAKtB,SAAS,EAAE;MACxBsB,MAAM,GAAG,IAAI;IACf;IACA/B,QAAQ,CAACC,GAAG,CAAC,eAAe,EAAE8B,MAAM,CAAC;EACvC;AACF;AAAChC,OAAA,CAAAC,QAAA,GAAAA,QAAA;;;;;;;;ACxFM,MAAMgC,KAAK,CAAC;EACjB,OAAOC,MAAMA,CAACC,SAAS,EAAEC,OAAO,EAAE;IAChClE,MAAM,CAACC,gBAAgB,CAACgE,SAAS,EAAG/D,KAAK,IAAK;MAC5CgE,OAAO,CAAChE,KAAK,CAACiE,MAAM,CAAC;IACvB,CAAC,CAAC;EACJ;EAEA,OAAOC,IAAIA,CAACH,SAAS,EAAEI,IAAI,EAAE;IAC3B,IAAIC,GAAG,GAAI,GAAEL,SAAU,EAAC;IACxB,IAAII,IAAI,EAAEhF,EAAE,EAAE;MACZiF,GAAG,IAAK,QAAOD,IAAI,CAAChF,EAAG,EAAC;IAC1B;IACAoB,OAAO,CAAC6D,GAAG,CAACA,GAAG,CAAC;IAChB,MAAMpE,KAAK,GAAG,IAAIqE,WAAW,CAACN,SAAS,EAAE;MACvCE,MAAM,EAAEE,IAAI,IAAI,CAAC,CAAC;MAClBG,OAAO,EAAE,IAAI,CAAE;IACjB,CAAC,CAAC;IACFxE,MAAM,CAACyE,aAAa,CAACvE,KAAK,CAAC;EAC7B;AACF;AAAC4B,OAAA,CAAAiC,KAAA,GAAAA,KAAA;;;;;;;;ACnBM,MAAMW,GAAG,CAAC;EACf,OAAOC,WAAWA,CAACC,OAAO,EAAE;IAC1BA,OAAO,CAACpD,SAAS,CAACK,MAAM,CAAC,QAAQ,CAAC;IAClC,OAAO,IAAI;EACb;EAEA,OAAOgD,WAAWA,CAACD,OAAO,EAAE;IAC1BA,OAAO,CAACpD,SAAS,CAACC,GAAG,CAAC,QAAQ,CAAC;IAC/B,OAAO,IAAI;EACb;EAEA,OAAOqD,WAAWA,CAACF,OAAO,EAAE;IAC1BA,OAAO,CAACG,eAAe,CAAC,UAAU,CAAC;IACnC,OAAO,IAAI;EACb;EAEA,OAAOC,YAAYA,CAACJ,OAAO,EAAE;IAC3BA,OAAO,CAACK,YAAY,CAAC,UAAU,EAAE,UAAU,CAAC;IAC5C,OAAO,IAAI;EACb;AACF;AAACnD,OAAA,CAAA4C,GAAA,GAAAA,GAAA;;;;;;;;ACpBM,SAASQ,QAAQA,CAACC,IAAI,EAAEC,IAAI,EAAE;EACnC,IAAIC,OAAO;EAEX,OAAO,SAASC,WAAWA,CAAA,EAAU;IAAA,SAAA3E,IAAA,GAAAC,SAAA,CAAA9B,MAAA,EAAN+B,IAAI,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;MAAJF,IAAI,CAAAE,IAAA,IAAAH,SAAA,CAAAG,IAAA;IAAA;IACjC,MAAMwE,KAAK,GAAGA,CAAA,KAAM;MAClBC,YAAY,CAACH,OAAO,CAAC;MACrBF,IAAI,CAAC,GAAGtE,IAAI,CAAC;IACf,CAAC;IAED2E,YAAY,CAACH,OAAO,CAAC;IACrBA,OAAO,GAAGI,UAAU,CAACF,KAAK,EAAEH,IAAI,CAAC;EACnC,CAAC;AACH;;;;;;;;ACZO,MAAMM,QAAQ,CAAC;EACpBxG,WAAWA,CAACyG,MAAM,EAAEC,YAAY,EAAEC,UAAU,EAAE;IAC5C,IAAI,CAACF,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,YAAY,GAAGA,YAAY;IAChC,IAAI,CAACE,YAAY,GAAG,IAAI,CAAC,CAAC;IAC1B,IAAI,CAACD,UAAU,GAAGA,UAAU;EAC9B;EAEA,MAAME,IAAIA,CAAA,EAAG;IACX,IAAI,IAAI,CAACD,YAAY,EAAE;MACrB,MAAM,IAAIE,KAAK,CAAC,yBAAyB,CAAC;IAC5C;IAEA,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtC,MAAMC,OAAO,GAAGC,SAAS,CAACN,IAAI,CAAC,IAAI,CAACJ,MAAM,EAAE,IAAI,CAACE,UAAU,CAACS,OAAO,CAAC;MAEpEF,OAAO,CAACG,OAAO,GAAIrG,KAAK,IAAKiG,MAAM,CAACjG,KAAK,CAACsG,MAAM,CAAC9F,KAAK,CAAC;MACvD0F,OAAO,CAACK,eAAe,GAAIvG,KAAK,IAAK;QACnC,MAAMwG,EAAE,GAAGxG,KAAK,CAACsG,MAAM,CAACG,MAAM;QAC9B,MAAMC,WAAW,GAAG1G,KAAK,CAAC2G,aAAa,CAACD,WAAW;QACnD,IAAI,CAACf,UAAU,CAACiB,OAAO,CAACJ,EAAE,EAAEE,WAAW,EAAE1G,KAAK,CAAC6G,UAAU,CAAC;MAC5D,CAAC;MACDX,OAAO,CAACY,SAAS,GAAI9G,KAAK,IAAK;QAC7B,IAAI,CAAC4F,YAAY,GAAG5F,KAAK,CAACsG,MAAM,CAACG,MAAM;QACvCT,OAAO,CAAC,IAAI,CAACJ,YAAY,CAAC;MAC5B,CAAC;IACH,CAAC,CAAC;EACJ;EAEA,MAAMc,WAAWA,CAACK,SAAS,EAAEC,IAAI,EAAE;IACjC,OAAO,IAAI,CAACpB,YAAY,CACrBc,WAAW,CAAC,CAACK,SAAS,CAAC,EAAEC,IAAI,CAAC,CAC9BC,WAAW,CAACF,SAAS,CAAC;EAC3B;EAEA,MAAMxF,GAAGA,CAACwF,SAAS,EAAE5C,IAAI,EAAE;IACzB,MAAM+C,KAAK,GAAG,MAAM,IAAI,CAACR,WAAW,CAACK,SAAS,EAAE,WAAW,CAAC;IAC5D,OAAO,IAAI,CAACI,aAAa,CAAC,KAAK,EAAED,KAAK,CAAC3F,GAAG,CAAC4C,IAAI,CAAC,CAAC;EACnD;EAEA,MAAM/B,GAAGA,CAAC2E,SAAS,EAAE5H,EAAE,EAAE;IACvB,MAAM+H,KAAK,GAAG,MAAM,IAAI,CAACR,WAAW,CAACK,SAAS,EAAE,UAAU,CAAC;IAC3D,OAAO,IAAI,CAACI,aAAa,CAAC,KAAK,EAAED,KAAK,CAAC9E,GAAG,CAACjD,EAAE,CAAC,CAAC;EACjD;EAEA,MAAMiI,GAAGA,CAACL,SAAS,EAAE5C,IAAI,EAAE;IACzB,MAAM+C,KAAK,GAAG,MAAM,IAAI,CAACR,WAAW,CAACK,SAAS,EAAE,WAAW,CAAC;IAC5D,OAAO,IAAI,CAACI,aAAa,CAAC,KAAK,EAAED,KAAK,CAACE,GAAG,CAACjD,IAAI,CAAC,CAAC;EACnD;EAEA,MAAMkD,MAAMA,CAACN,SAAS,EAAE5H,EAAE,EAAE;IAC1B,MAAM+H,KAAK,GAAG,MAAM,IAAI,CAACR,WAAW,CAACK,SAAS,EAAE,WAAW,CAAC;IAC5D,OAAO,IAAI,CAACI,aAAa,CAAC,QAAQ,EAAED,KAAK,CAACG,MAAM,CAAClI,EAAE,CAAC,CAAC;EACvD;EAEA,MAAMmI,MAAMA,CAACP,SAAS,EAAE;IACtB,MAAMG,KAAK,GAAG,MAAM,IAAI,CAACR,WAAW,CAACK,SAAS,EAAE,WAAW,CAAC;IAC5D,OAAO,IAAI,CAACI,aAAa,CAAC,QAAQ,EAAED,KAAK,CAACI,MAAM,CAAC,CAAC,CAAC;EACrD;EAEA,MAAMC,KAAKA,CAACR,SAAS,EAAE;IACrB,MAAMG,KAAK,GAAG,MAAM,IAAI,CAACR,WAAW,CAACK,SAAS,EAAE,WAAW,CAAC;IAC5D,OAAO,IAAI,CAACI,aAAa,CAAC,WAAW,EAAED,KAAK,CAACK,KAAK,CAAC,CAAC,CAAC;EACvD;EAEAJ,aAAaA,CAACjI,IAAI,EAAEgH,OAAO,EAAE;IAC3B,OAAO,IAAIH,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtCC,OAAO,CAACY,SAAS,GAAG,MAAMd,OAAO,CAACE,OAAO,CAACO,MAAM,CAAC;MAEjDP,OAAO,CAACG,OAAO,GAAIrG,KAAK,IAAK;QAC3B,MAAMQ,KAAK,GAAI,YAAWtB,IAAK,sBAAqBc,KAAK,CAACsG,MAAM,CAAC9F,KAAK,CAACvB,OAAQ,EAAC;QAChFgH,MAAM,CAAC,IAAIH,KAAK,CAAC1G,IAAI,CAACC,SAAS,CAACmB,KAAK,CAAC,CAAC,CAAC;MAC1C,CAAC;IACH,CAAC,CAAC;EACJ;AACF;AAACoB,OAAA,CAAA4D,QAAA,GAAAA,QAAA;;;;;;;;AC3EM,MAAMgC,UAAU,CAAC;EACtB,OAAOpB,OAAO,GAAG,CAAC;EAClB,OAAOQ,OAAOA,CAACa,QAAQ,EAAEf,WAAW,EAAEG,UAAU,EAAE;IAChDtG,OAAO,CAACS,KAAK,CACV,iCAAgC6F,UAAW,iBAAgB,IAAI,CAACT,OAAQ,GAC3E,CAAC;IACD,MAAMsB,QAAQ,GAAI,mBAAkB,IAAI,CAACtB,OAAQ,EAAC;IAClD,MAAMuB,WAAW,GAAG,IAAI,CAACD,QAAQ,CAAC;IAClC,IAAI,CAACC,WAAW,EAAE;MAChB,MAAM,IAAI7B,KAAK,CAAE,gCAA+B4B,QAAS,EAAC,CAAC;IAC7D;IACA,IAAI,IAAI,CAACtB,OAAO,IAAIS,UAAU,EAAE;MAC9Bc,WAAW,CAAC;QAAEF,QAAQ;QAAEf;MAAY,CAAC,CAAC;IACxC;EACF;EAEA,OAAOkB,iBAAiBA,CAACC,OAAO,EAAE;IAChC;IACAA,OAAO,CAACJ,QAAQ,CAACK,iBAAiB,CAAC,OAAO,EAAE;MAC1CC,OAAO,EAAE,IAAI;MACbC,aAAa,EAAE;IACjB,CAAC,CAAC;IACF;IACA,MAAMC,YAAY,GAAGJ,OAAO,CAACJ,QAAQ,CAACK,iBAAiB,CAAC,eAAe,EAAE;MACvEC,OAAO,EAAE,IAAI;MACbC,aAAa,EAAE;IACjB,CAAC,CAAC;IACFC,YAAY,CAACC,WAAW,CAAC,SAAS,EAAE,QAAQ,EAAE;MAAEC,MAAM,EAAE;IAAM,CAAC,CAAC;EAClE;AACF;AAACvG,OAAA,CAAA4F,UAAA,GAAAA,UAAA;;;;;;;;AC7BD,IAAAY,SAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AAEO,MAAME,SAAS,CAAC;EACrBvJ,WAAWA,CAACmF,IAAI,EAAE;IAChBqE,MAAM,CAACC,MAAM,CAAC,IAAI,EAAEtE,IAAI,CAAC;EAC3B;EAEA,MAAMuE,MAAMA,CAAA,EAAG;IACb,MAAMzI,GAAG,GAAG,MAAM,IAAI,CAACjB,WAAW,CAACwH,EAAE,CAACjF,GAAG,CAAC,IAAI,CAACvC,WAAW,CAAC+H,SAAS,EAAE,IAAI,CAAC;IAC3E,IAAI,CAAC,IAAI,CAAC5H,EAAE,EAAE;MACZ,IAAI,CAACA,EAAE,GAAGc,GAAG;IACf;IACA,OAAO,IAAI;EACb;EAEA,MAAM0I,IAAIA,CAAA,EAAG;IACX,OAAO,MAAM,IAAI,CAAC3J,WAAW,CAACwH,EAAE,CAACY,GAAG,CAAC,IAAI,CAACpI,WAAW,CAAC+H,SAAS,EAAE,IAAI,CAAC;EACxE;EAEA,MAAMM,MAAMA,CAAA,EAAG;IACb,OAAO,MAAM,IAAI,CAACrI,WAAW,CAACwH,EAAE,CAACa,MAAM,CACrC,IAAI,CAACrI,WAAW,CAAC+H,SAAS,EAC1B,IAAI,CAAC5H,EACP,CAAC;EACH;EAEAyJ,OAAOA,CAAA,EAAG;IACR,OAAOxJ,IAAI,CAACC,SAAS,CAAC,IAAI,CAAC;EAC7B;EAEA,aAAaoI,QAAQA,CAACoB,IAAI,EAAE3B,KAAK,EAAE;IACjC,IAAI,CAACzB,MAAM,GAAGoD,IAAI;IAClB,IAAI,CAAC9B,SAAS,GAAGG,KAAK;IACtB,IAAI,CAACV,EAAE,GAAG,IAAIhB,kBAAQ,CAACqD,IAAI,EAAE,CAAC3B,KAAK,CAAC,EAAEM,sBAAU,CAAC;IACjD,MAAM,IAAI,CAAChB,EAAE,CAACX,IAAI,CAAC,CAAC;EACtB;EAEA,aAAaa,WAAWA,CAACM,IAAI,EAAE;IAC7B,OAAO,MAAM,IAAI,CAACR,EAAE,CAACE,WAAW,CAAC,IAAI,CAACK,SAAS,EAAEC,IAAI,CAAC;EACxD;EAEA,MAAMN,WAAWA,CAACM,IAAI,EAAE;IACtB,OAAO,MAAM,IAAI,CAAChI,WAAW,CAAC0H,WAAW,CAACM,IAAI,CAAC;EACjD;EAEA,aAAa5E,GAAGA,CAACjD,EAAE,EAAE;IACnB,MAAMgF,IAAI,GAAG,MAAM,IAAI,CAACqC,EAAE,CAACpE,GAAG,CAAC,IAAI,CAAC2E,SAAS,EAAE5H,EAAE,CAAC;IAClD,OAAO,IAAI,IAAI,CAACgF,IAAI,CAAC;EACvB;EAEA,aAAaoD,KAAKA,CAAA,EAAG;IACnB,OAAO,MAAM,IAAI,CAACf,EAAE,CAACe,KAAK,CAAC,IAAI,CAACR,SAAS,CAAC;EAC5C;;EAEA;EACA,aAAaO,MAAMA,CAAA,EAAG;IACpB,MAAMwB,OAAO,GAAG,MAAM,IAAI,CAACtC,EAAE,CAACc,MAAM,CAAC,IAAI,CAACP,SAAS,CAAC;IACpD,OAAO+B,OAAO,CAACC,GAAG,CAAE5E,IAAI,IAAK,IAAI,IAAI,CAACA,IAAI,CAAC,CAAC;EAC9C;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE,aAAa6E,kBAAkBA,CAACC,SAAS,EAAE9J,EAAE,EAAE;IAC7C;IACA,MAAMuH,WAAW,GAAG,MAAM,IAAI,CAACA,WAAW,CAAC,UAAU,CAAC;;IAEtD;IACA,MAAMwC,KAAK,GAAGxC,WAAW,CAACwC,KAAK,CAACD,SAAS,CAAC;IAC1C,MAAM/C,OAAO,GAAGgD,KAAK,CAAC5B,MAAM,CAACnI,EAAE,CAAC;IAEhC,OAAO,IAAI4G,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtCC,OAAO,CAACY,SAAS,GAAG,MAAM;QACxB;QACA,MAAMqC,QAAQ,GAAGjD,OAAO,CAACO,MAAM,CAACsC,GAAG,CAAE5E,IAAI,IAAK,IAAI,IAAI,CAACA,IAAI,CAAC,CAAC;QAC7D6B,OAAO,CAACmD,QAAQ,CAAC;MACnB,CAAC;MACDjD,OAAO,CAACG,OAAO,GAAG,MAAM;QACtBJ,MAAM,CAACC,OAAO,CAAC1F,KAAK,CAAC;MACvB,CAAC;IACH,CAAC,CAAC;EACJ;;EAEA;EACA,aAAa4I,MAAMA,CAAA,EAAG;IACpB,IAAI1C,WAAW,GAAG,MAAM,IAAI,CAACF,EAAE,CAACE,WAAW,CAAC,IAAI,CAACK,SAAS,EAAE,UAAU,CAAC;IACvE,IAAIG,KAAK,GAAG,MAAMR,WAAW,CAACA,WAAW,CAACO,WAAW,CAAC,IAAI,CAACF,SAAS,CAAC;IACrE,OAAOG,KAAK,CAACI,MAAM,CAAC,CAAC;EACvB;AACF;AAAC1F,OAAA,CAAA2G,SAAA,GAAAA,SAAA;;;;;;;;AC7FD,IAAAc,UAAA,GAAAhB,OAAA;AAEO,MAAMiB,WAAW,SAASf,oBAAS,CAAC;EACzC,aAAalI,UAAUA,CAAA,EAAG;IACxB,MAAM,IAAI,CAACoH,QAAQ,CAAC,SAAS,EAAE,eAAe,CAAC;EACjD;EAEA,aAAa8B,cAAcA,CAAC3F,MAAM,EAAE;IAClC,OAAO,IAAI,CAACoF,kBAAkB,CAAC,SAAS,EAAEpF,MAAM,CAAC;EACnD;AACF;AAAChC,OAAA,CAAA0H,WAAA,GAAAA,WAAA;;;;;;;;ACVD,IAAAD,UAAA,GAAAhB,OAAA;AACA,IAAAmB,YAAA,GAAAnB,OAAA;AAEO,MAAMoB,IAAI,SAASlB,oBAAS,CAAC;EAClC,MAAMmB,UAAUA,CAACvF,IAAI,EAAE;IACrBA,IAAI,CAACP,MAAM,GAAG,IAAI,CAACzE,EAAE;IACrB,OAAO,MAAM,IAAImK,wBAAW,CAACnF,IAAI,CAAC,CAACuE,MAAM,CAAC,CAAC;EAC7C;EAEA,MAAMiB,WAAWA,CAAA,EAAG;IAClB,MAAMR,QAAQ,GAAG,MAAMG,wBAAW,CAACC,cAAc,CAAC,IAAI,CAACpK,EAAE,CAAC;IAC1D,IAAI,CAACgK,QAAQ,GAAGA,QAAQ;IACxB,OAAO,IAAI,CAACA,QAAQ;EACtB;EAEA,aAAa9I,UAAUA,CAAA,EAAG;IACxB,MAAM,IAAI,CAACoH,QAAQ,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,CAAC;EAC3C;EAEA,aAAaF,KAAKA,CAAA,EAAG;IACnB,MAAM+B,wBAAW,CAAC/B,KAAK,CAAC,CAAC;IACzB,MAAM,KAAK,CAACA,KAAK,CAAC,CAAC;EACrB;EAEA,aAAanF,GAAGA,CAACjD,EAAE,EAAE;IACnB,MAAMyK,IAAI,GAAG,MAAM,KAAK,CAACxH,GAAG,CAACjD,EAAE,CAAC;;IAEhC;AACJ;AACA;AACA;AACA;AACA;AACA;;IAEI,OAAOyK,IAAI;EACb;EAEA,aAAavC,MAAMA,CAAClI,EAAE,EAAE;IACtB;IACA,MAAM,KAAK,CAACkI,MAAM,CAAClI,EAAE,CAAC;;IAEtB;IACA,MAAMgK,QAAQ,GAAG,MAAMG,wBAAW,CAACC,cAAc,CAACpK,EAAE,CAAC;IACrD,KAAK,MAAMF,OAAO,IAAIkK,QAAQ,EAAE;MAC9B,MAAMlK,OAAO,CAACoI,MAAM,CAAC,CAAC;IACxB;EACF;AACF;AAACzF,OAAA,CAAA6H,IAAA,GAAAA,IAAA;;;;;;;;AChDD,IAAAI,MAAA,GAAAxB,OAAA;AACA,IAAAyB,KAAA,GAAAzB,OAAA;AACA,IAAAmB,YAAA,GAAAnB,OAAA;AACA,IAAA0B,SAAA,GAAA1B,OAAA;AAEO,MAAM2B,aAAa,CAAC;EACzB,aAAaC,UAAUA,CAACL,IAAI,EAAEzF,IAAI,EAAE;IAClCqE,MAAM,CAACC,MAAM,CAACmB,IAAI,EAAEzF,IAAI,CAAC;IACzB,MAAMyF,IAAI,CAACjB,IAAI,CAAC,CAAC;IACjB;IACA9E,YAAK,CAACK,IAAI,CAAC,aAAa,EAAE0F,IAAI,CAAC;EACjC;EAEA,aAAaM,UAAUA,CAAC/F,IAAI,EAAE;IAC5B,IAAI,CAACA,IAAI,EAAE;MACTA,IAAI,GAAG,CAAC,CAAC;IACX;IACA,IAAI,CAACA,IAAI,CAACgG,KAAK,EAAE;MACfhG,IAAI,CAACgG,KAAK,GAAG,UAAU;IACzB;IACA,IAAI,CAAChG,IAAI,CAAChB,KAAK,EAAE;MACfgB,IAAI,CAAChB,KAAK,GAAGtB,kBAAQ,CAACoB,QAAQ,CAAC,CAAC;IAClC;IACA,MAAM2G,IAAI,GAAG,MAAM,IAAIH,UAAI,CAACtF,IAAI,CAAC,CAACuE,MAAM,CAAC,CAAC;IAC1C7G,kBAAQ,CAAC8B,gBAAgB,CAACiG,IAAI,CAACzK,EAAE,CAAC;IAClC0E,YAAK,CAACK,IAAI,CAAC,aAAa,EAAE0F,IAAI,CAAC;IAC/B/F,YAAK,CAACK,IAAI,CAAC,cAAc,EAAE0F,IAAI,CAAC;IAChC,OAAOA,IAAI;EACb;EAEA,aAAaQ,iBAAiBA,CAACC,SAAS,EAAE;IACxC,MAAMpL,OAAO,GAAG,MAAMqK,wBAAW,CAAClH,GAAG,CAACiI,SAAS,CAAC;IAChDpL,OAAO,CAACoI,MAAM,CAAC,CAAC;EAClB;EAEA,aAAaiD,UAAUA,CAACV,IAAI,EAAE;IAC5B,MAAMA,IAAI,CAACvC,MAAM,CAAC,CAAC;IACnB,IAAIxF,kBAAQ,CAAC6B,gBAAgB,CAAC,CAAC,KAAKkG,IAAI,CAACzK,EAAE,EAAE;MAC3C0C,kBAAQ,CAAC8B,gBAAgB,CAAC,IAAI,CAAC;IACjC;IACAE,YAAK,CAACK,IAAI,CAAC,aAAa,EAAE0F,IAAI,CAAC;EACjC;EAEA,aAAaW,cAAcA,CAAA,EAAG;IAC5B,MAAM3G,MAAM,GAAG,IAAI,CAACF,gBAAgB,CAAC,CAAC;IACtC,IAAIE,MAAM,EAAE;MACV,OAAO,MAAM6F,UAAI,CAACrH,GAAG,CAACwB,MAAM,CAAC;IAC/B;IACA,OAAO,IAAI;EACb;EAEA,OAAOF,gBAAgBA,CAAA,EAAG;IACxB,OAAO7B,kBAAQ,CAACO,GAAG,CAAC,eAAe,CAAC;EACtC;EAEA,aAAaoI,cAAcA,CAACZ,IAAI,EAAE;IAChC/H,kBAAQ,CAAC8B,gBAAgB,CAACiG,IAAI,CAACzK,EAAE,CAAC;IAClC0E,YAAK,CAACK,IAAI,CAAC,cAAc,EAAE0F,IAAI,CAAC;EAClC;EAEA,aAAajG,gBAAgBA,CAACC,MAAM,EAAE;IACpC,MAAMgG,IAAI,GAAG,MAAMH,UAAI,CAACrH,GAAG,CAACwB,MAAM,CAAC;IACnC,IAAIgG,IAAI,EAAE;MACR,MAAM,IAAI,CAACY,cAAc,CAACZ,IAAI,CAAC;IACjC;EACF;EAEA,aAAaa,UAAUA,CAAA,EAAG;IACxB5I,kBAAQ,CAAC8B,gBAAgB,CAAC,IAAI,CAAC;IAC/B,MAAM8F,UAAI,CAAClC,KAAK,CAAC,CAAC;IAClB1D,YAAK,CAACK,IAAI,CAAC,cAAc,CAAC;EAC5B;AACF;AAACtC,OAAA,CAAAoI,aAAA,GAAAA,aAAA;;;;;;;;ACxED,IAAAU,cAAA,GAAArC,OAAA;AAEO,MAAMsC,YAAY,CAAC;EACxB3L,WAAWA,CAAC4K,IAAI,EAAEgB,QAAQ,EAAEC,QAAQ,EAAE;IACpC,IAAI,CAACjB,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACgB,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAAChL,OAAO,GAAGJ,QAAQ,CACpBG,cAAc,CAAC,yBAAyB,CAAC,CACzCC,OAAO,CAACsB,SAAS,CAAC,IAAI,CAAC;IAC1B,IAAI,CAACwD,OAAO,GAAG,IAAI,CAAC9E,OAAO,CAACwB,aAAa,CAAC,iBAAiB,CAAC;IAC5D,IAAI,CAACsD,OAAO,CAACyF,KAAK,GAAG,IAAI,CAACP,IAAI,CAACO,KAAK;IACpC,IAAI,CAACzF,OAAO,CAACP,IAAI,GAAG;MAAEhF,EAAE,EAAE,IAAI,CAACyK,IAAI,CAACzK;IAAG,CAAC;IACxC,IAAI,CAACuF,OAAO,CAACpD,SAAS,CAACC,GAAG,CAAE,OAAM,IAAI,CAACqI,IAAI,CAACzK,EAAG,EAAC,CAAC;IACjD,IAAI0L,QAAQ,KAAK,IAAI,EAAE;MACrB,IAAI,CAACnG,OAAO,CAACpD,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;MACtC;IACF;IACA,IAAI,CAACuJ,QAAQ,CAAC,CAAC;IACf,IAAI,CAACC,kBAAkB,CAAC,CAAC;EAC3B;EAEAC,MAAMA,CAAA,EAAG,CAAC;EAEVD,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAACrG,OAAO,CAAC3E,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAACkL,WAAW,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;IACvE,IAAI,CAACxG,OAAO,CAAC3E,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAACoL,UAAU,CAACD,IAAI,CAAC,IAAI,CAAC,CAAC;IACrE,IAAI,CAACxG,OAAO,CAAC3E,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACqL,OAAO,CAACF,IAAI,CAAC,IAAI,CAAC,CAAC;IAC/D,IAAI,CAACxG,OAAO,CACTtD,aAAa,CAAC,mBAAmB,CAAC,CAClCrB,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACuK,UAAU,CAACY,IAAI,CAAC,IAAI,CAAC,CAAC;EAC1D;EAEAD,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACvG,OAAO,CAACpD,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;EACrC;EAEA4J,UAAUA,CAAA,EAAG;IACX,IAAI,CAACzG,OAAO,CAACpD,SAAS,CAACK,MAAM,CAAC,OAAO,CAAC;EACxC;EAEAyJ,OAAOA,CAAA,EAAG;IACR,IAAI,CAACR,QAAQ,CAACS,UAAU,CAAC,IAAI,CAACzB,IAAI,CAACzK,EAAE,CAAC;EACxC;EAEA2L,QAAQA,CAAA,EAAG;IACT,MAAMQ,SAAS,GAAG,IAAI,CAAC1L,OAAO,CAACwB,aAAa,CAAC,aAAa,CAAC;IAC3DkK,SAAS,CAACjK,WAAW,GAAG,IAAI,CAACuI,IAAI,CAACO,KAAK;EACzC;EAEAG,UAAUA,CAAA,EAAG;IACXN,4BAAa,CAACM,UAAU,CAAC,IAAI,CAACV,IAAI,CAAC;IACnC,IAAI,CAAClF,OAAO,CAAC/C,MAAM,CAAC,CAAC;EACvB;AACF;AAACC,OAAA,CAAA+I,YAAA,GAAAA,YAAA;;;;;;;;ACrDM,MAAMY,WAAW,CAAC;EACvBvM,WAAWA,CAACwM,QAAQ,EAAE;IACpB,IAAI,CAACC,SAAS,GAAGjM,QAAQ,CAACkM,gBAAgB,CAACF,QAAQ,CAAC;IACpD,IAAI,CAACG,WAAW,GAAG,IAAI;IACvB,IAAI,CAACC,qBAAqB,CAAC,CAAC;EAC9B;EAEAA,qBAAqBA,CAAA,EAAG;IACtB,IAAI,CAACH,SAAS,CAACI,OAAO,CAAEC,IAAI,IAAK;MAC/BA,IAAI,CAAC/L,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAACgM,eAAe,CAACb,IAAI,CAAC,IAAI,EAAEY,IAAI,CAAC,CAAC;MACzEA,IAAI,CAAC/L,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAACiM,cAAc,CAACd,IAAI,CAAC,IAAI,CAAC,CAAC;MACjEY,IAAI,CAAC/L,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAACkM,UAAU,CAACf,IAAI,CAAC,IAAI,EAAEY,IAAI,CAAC,CAAC;MAC/DA,IAAI,CAAC/L,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAACmM,aAAa,CAAChB,IAAI,CAAC,IAAI,CAAC,CAAC;IACjE,CAAC,CAAC;EACJ;EAEAa,eAAeA,CAACD,IAAI,EAAE;IACpB,IAAI,CAACH,WAAW,GAAGG,IAAI;EACzB;EAEAE,cAAcA,CAAC7J,CAAC,EAAE;IAChBA,CAAC,CAACgK,cAAc,CAAC,CAAC;EACpB;EAEAF,UAAUA,CAACH,IAAI,EAAE;IACf,IAAIA,IAAI,KAAK,IAAI,CAACH,WAAW,EAAE;MAC7B,IAAIS,WAAW,GAAGN,IAAI,CAACO,SAAS;MAChCP,IAAI,CAACO,SAAS,GAAG,IAAI,CAACV,WAAW,CAACU,SAAS;MAC3C,IAAI,CAACV,WAAW,CAACU,SAAS,GAAGD,WAAW;MACxC7L,OAAO,CAACS,KAAK,CAAC,UAAU,CAAC;IAC3B;EACF;EAEAkL,aAAaA,CAAA,EAAG;IACd,IAAI,CAACP,WAAW,GAAG,IAAI;EACzB;AACF;AAAC/J,OAAA,CAAA2J,WAAA,GAAAA,WAAA;;;;;;;;ACpCD,IAAA1B,MAAA,GAAAxB,OAAA;AACA,IAAAiE,aAAA,GAAAjE,OAAA;AACA,IAAAkE,YAAA,GAAAlE,OAAA;AACA,IAAAyB,KAAA,GAAAzB,OAAA;AACA,IAAAqC,cAAA,GAAArC,OAAA;AAEO,MAAMmE,QAAQ,CAAC;EACpBxN,WAAWA,CAAA,EAAG;IACZ,IAAI,CAAC0F,OAAO,GAAGlF,QAAQ,CAACG,cAAc,CAAC,WAAW,CAAC;IACnD,IAAI,CAACD,QAAQ,GAAGF,QAAQ,CAACG,cAAc,CAAC,yBAAyB,CAAC,CAACC,OAAO;IAC1E,IAAI,CAACmL,kBAAkB,CAAC,CAAC;IACzBf,4BAAa,CAACO,cAAc,CAAC,CAAC,CAACkC,IAAI,CAAE7C,IAAI,IAAK;MAC5C,IAAI,CAACA,IAAI,GAAGA,IAAI;IAClB,CAAC,CAAC;EACJ;EAEAmB,kBAAkBA,CAAA,EAAG;IACnBlH,YAAK,CAACC,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC4I,iBAAiB,CAACxB,IAAI,CAAC,IAAI,CAAC,CAAC;IAC9DrH,YAAK,CAACC,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC6I,iBAAiB,CAACzB,IAAI,CAAC,IAAI,CAAC,CAAC;IAC9DrH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAAC8I,kBAAkB,CAAC1B,IAAI,CAAC,IAAI,CAAC,CAAC;IAChErH,YAAK,CAACC,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC+I,iBAAiB,CAAC3B,IAAI,CAAC,IAAI,CAAC,CAAC;IAC9DrH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAACgJ,kBAAkB,CAAC5B,IAAI,CAAC,IAAI,CAAC,CAAC;EAClE;EAEA,MAAMG,UAAUA,CAACzH,MAAM,EAAE;IACvB,MAAMoG,4BAAa,CAACrG,gBAAgB,CAACC,MAAM,CAAC;EAC9C;EAEA8I,iBAAiBA,CAAC9C,IAAI,EAAE;IACtB,IAAI,CAACmD,UAAU,CAACnD,IAAI,EAAE,IAAI,CAAC;EAC7B;EAEA+C,iBAAiBA,CAAC/C,IAAI,EAAE;IACtB,IAAI,IAAI,CAACA,IAAI,EAAEzK,EAAE,KAAKyK,IAAI,CAACzK,EAAE,EAAE;MAC7B,IAAI,CAACyK,IAAI,GAAG,IAAI;IAClB;IACA,IAAI,CAAClF,OAAO,CAACtD,aAAa,CAAE,QAAOwI,IAAI,CAACzK,EAAG,EAAC,CAAC,EAAEwC,MAAM,CAAC,CAAC;EACzD;EAEAiL,kBAAkBA,CAAA,EAAG;IACnB,MAAMI,QAAQ,GAAG,IAAI,CAACtI,OAAO,CAACgH,gBAAgB,CAAC,iBAAiB,CAAC;IACjEsB,QAAQ,CAACnB,OAAO,CAAEnH,OAAO,IAAKA,OAAO,CAAC/C,MAAM,CAAC,CAAC,CAAC;EACjD;EAEAkL,iBAAiBA,CAACjD,IAAI,EAAE;IACtB,MAAMqD,WAAW,GAAG,IAAI,CAACvI,OAAO,CAACtD,aAAa,CAC3C,QAAOwI,IAAI,CAACzK,EAAG,cAClB,CAAC;IACD,IAAI8N,WAAW,EAAE;MACfA,WAAW,CAAC5L,WAAW,GAAGuI,IAAI,CAACO,KAAK;IACtC;EACF;EAEA2C,kBAAkBA,CAAClD,IAAI,EAAE;IACvB,IAAI,IAAI,CAACA,IAAI,EAAE;MACb,MAAMsD,mBAAmB,GAAG,IAAI,CAACxI,OAAO,CAACtD,aAAa,CACnD,QAAO,IAAI,CAACwI,IAAI,CAACzK,EAAG,EACvB,CAAC;MACD,IAAI+N,mBAAmB,EAAE;QACvBA,mBAAmB,CAAC5L,SAAS,CAACK,MAAM,CAAC,UAAU,CAAC;MAClD;IACF;IACA,MAAMwL,cAAc,GAAG,IAAI,CAACzI,OAAO,CAACtD,aAAa,CAAE,QAAOwI,IAAI,CAACzK,EAAG,EAAC,CAAC;IACpE,IAAIgO,cAAc,EAAE;MAClBA,cAAc,CAAC7L,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;IAC1C;IACA;IACA,IAAI,CAACqI,IAAI,GAAGA,IAAI;EAClB;EAEAoB,MAAMA,CAAA,EAAG;IACP,MAAMoC,aAAa,GAAGpD,4BAAa,CAACtG,gBAAgB,CAAC,CAAC;IACtD,IAAI,CAACgB,OAAO,CAAC2H,SAAS,GAAG,EAAE;IAC3B5C,UAAI,CAACnC,MAAM,CAAC,CAAC,CAACmF,IAAI,CAAEY,KAAK,IAAK;MAC5BA,KAAK,CAACxB,OAAO,CAAEjC,IAAI,IAAK;QACtB,MAAMiB,QAAQ,GAAGjB,IAAI,CAACzK,EAAE,KAAKiO,aAAa;QAC1C,IAAI,CAACL,UAAU,CAACnD,IAAI,EAAEiB,QAAQ,CAAC;MACjC,CAAC,CAAC;MACF,IAAIU,wBAAW,CAAC,iBAAiB,CAAC;IACpC,CAAC,CAAC;EACJ;EAEAwB,UAAUA,CAACnD,IAAI,EAAEiB,QAAQ,EAAE;IACzB,MAAMyC,YAAY,GAAG,IAAI3C,0BAAY,CAACf,IAAI,EAAE,IAAI,EAAEiB,QAAQ,CAAC;IAC3D,IAAI,CAACnG,OAAO,CAAChD,WAAW,CAAC4L,YAAY,CAAC5I,OAAO,CAAC;IAC9C,OAAO4I,YAAY;EACrB;AACF;AAAC1L,OAAA,CAAA4K,QAAA,GAAAA,QAAA;;;;;;;;ACvFD,IAAA1C,KAAA,GAAAzB,OAAA;AACA,IAAAmB,YAAA,GAAAnB,OAAA;AAEO,MAAMkF,mBAAmB,CAAC;EAC/BvO,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACwO,MAAM,GAAGhO,QAAQ,CAAC4B,aAAa,CAAC,gBAAgB,CAAC;IACtD,IAAI,CAAC2J,kBAAkB,CAAC,CAAC;EAC3B;EAEAA,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAACyC,MAAM,CAACzN,gBAAgB,CAAC,OAAO,EAAE,MAAM;MAC1C,IAAI,CAAC0N,UAAU,CAAC,CAAC;MACjB,IAAI,CAACC,kBAAkB,CAAC,CAAC;IAC3B,CAAC,CAAC;EACJ;EAEA,MAAMD,UAAUA,CAAA,EAAG;IACjB,MAAMvH,OAAO,GAAG,MAAMuD,UAAI,CAACL,MAAM,CAAC,CAAC;IAEnClD,OAAO,CAACY,SAAS,GAAG,YAAY;MAC9B,IAAI3C,IAAI,GAAG+B,OAAO,CAACO,MAAM;;MAEzB;MACA,IAAIkH,QAAQ,GAAGvO,IAAI,CAACC,SAAS,CAAC8E,IAAI,EAAE,CAAC,CAAC;;MAEtC;MACA,IAAIyJ,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACF,QAAQ,CAAC,EAAE;QAAEzO,IAAI,EAAE;MAAmB,CAAC,CAAC;MAC7D,IAAI8D,GAAG,GAAGH,GAAG,CAACiL,eAAe,CAACF,IAAI,CAAC;MAEnC,IAAIG,CAAC,GAAGvO,QAAQ,CAACwO,aAAa,CAAC,GAAG,CAAC;MACnCD,CAAC,CAACjL,IAAI,GAAGE,GAAG;MACZ+K,CAAC,CAACE,QAAQ,GAAG,YAAY;MACzBF,CAAC,CAACG,KAAK,CAAC,CAAC;MACTrL,GAAG,CAACsL,eAAe,CAACnL,GAAG,CAAC;IAC1B,CAAC;IAEDkD,OAAO,CAACG,OAAO,GAAG,UAAUrG,KAAK,EAAE;MACjCO,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAER,KAAK,CAACsG,MAAM,CAAC8H,SAAS,CAAC;IAC/D,CAAC;EACH;EAEA,MAAMV,kBAAkBA,CAAA,EAAG;IACzB,MAAMxH,OAAO,GAAG,MAAMoD,wBAAW,CAACF,MAAM,CAAC,CAAC;IAE1ClD,OAAO,CAACY,SAAS,GAAG,YAAY;MAC9B,IAAI3C,IAAI,GAAG+B,OAAO,CAACO,MAAM;;MAEzB;MACA,IAAIkH,QAAQ,GAAGvO,IAAI,CAACC,SAAS,CAAC8E,IAAI,EAAE,CAAC,CAAC;;MAEtC;MACA,IAAIyJ,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACF,QAAQ,CAAC,EAAE;QAAEzO,IAAI,EAAE;MAAmB,CAAC,CAAC;MAC7D,IAAI8D,GAAG,GAAGH,GAAG,CAACiL,eAAe,CAACF,IAAI,CAAC;MAEnC,IAAIG,CAAC,GAAGvO,QAAQ,CAACwO,aAAa,CAAC,GAAG,CAAC;MACnCD,CAAC,CAACjL,IAAI,GAAGE,GAAG;MACZ+K,CAAC,CAACE,QAAQ,GAAG,oBAAoB;MACjCF,CAAC,CAACG,KAAK,CAAC,CAAC;MACTrL,GAAG,CAACsL,eAAe,CAACnL,GAAG,CAAC;IAC1B,CAAC;IAEDkD,OAAO,CAACG,OAAO,GAAG,UAAUrG,KAAK,EAAE;MACjCO,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAER,KAAK,CAACsG,MAAM,CAAC8H,SAAS,CAAC;IAC/D,CAAC;EACH;AACF;AAACxM,OAAA,CAAA2L,mBAAA,GAAAA,mBAAA;;;;;;;;ACjEM,MAAMc,YAAY,CAAC;EACxB;EACAvM,GAAGA,CAAC7B,GAAG,EAAE8B,KAAK,EAAE;IACd,IAAI;MACF,MAAMC,WAAW,GAAG5C,IAAI,CAACC,SAAS,CAAC0C,KAAK,CAAC;MACzCE,YAAY,CAACC,OAAO,CAACjC,GAAG,EAAE+B,WAAW,CAAC;IACxC,CAAC,CAAC,OAAOG,CAAC,EAAE;MACV5B,OAAO,CAACC,KAAK,CAAC,8BAA8B,EAAE2B,CAAC,CAAC;IAClD;EACF;;EAEA;EACAC,GAAGA,CAACnC,GAAG,EAAuB;IAAA,IAArBoC,YAAY,GAAA3B,SAAA,CAAA9B,MAAA,QAAA8B,SAAA,QAAA4B,SAAA,GAAA5B,SAAA,MAAG,IAAI;IAC1B,IAAI;MACF,MAAMqB,KAAK,GAAGE,YAAY,CAACM,OAAO,CAACtC,GAAG,CAAC;MACvC,OAAO8B,KAAK,KAAK,IAAI,GAAG3C,IAAI,CAACoD,KAAK,CAACT,KAAK,CAAC,GAAGM,YAAY;IAC1D,CAAC,CAAC,OAAOF,CAAC,EAAE;MACV5B,OAAO,CAACC,KAAK,CAAC,iCAAiC,EAAE2B,CAAC,CAAC;MACnD,OAAOE,YAAY;IACrB;EACF;;EAEA;EACAV,MAAMA,CAAC1B,GAAG,EAAE;IACV,IAAI;MACFgC,YAAY,CAACQ,UAAU,CAACxC,GAAG,CAAC;IAC9B,CAAC,CAAC,OAAOkC,CAAC,EAAE;MACV5B,OAAO,CAACC,KAAK,CAAC,kCAAkC,EAAE2B,CAAC,CAAC;IACtD;EACF;AACF;AAACP,OAAA,CAAAyM,YAAA,GAAAA,YAAA;;;;;;;;AC9BD,IAAAC,SAAA,GAAAjG,OAAA;AACA,IAAAwB,MAAA,GAAAxB,OAAA;AACA,IAAAyB,KAAA,GAAAzB,OAAA;AACA,IAAAqC,cAAA,GAAArC,OAAA;AACA,IAAAkG,SAAA,GAAAlG,OAAA;AACA,IAAAmG,oBAAA,GAAAnG,OAAA;AACA,IAAAoG,aAAA,GAAApG,OAAA;AAEO,MAAMqG,OAAO,CAAC;EACnB1P,WAAWA,CAAA,EAAG;IACZ,IAAI,CAAC2P,QAAQ,GAAG,IAAIN,0BAAY,CAAC,CAAC;IAClC,IAAI,CAACzD,QAAQ,GAAG,IAAI4B,kBAAQ,CAAC,CAAC;IAC9B,IAAI,CAAC9H,OAAO,GAAGlF,QAAQ,CAACG,cAAc,CAAC,SAAS,CAAC;IACjD,IAAI,CAACiP,aAAa,GAAG,IAAI,CAAClK,OAAO,CAACtD,aAAa,CAAC,kBAAkB,CAAC;IACnE,IAAI,CAACyN,WAAW,GAAG,IAAI,CAACnK,OAAO,CAACtD,aAAa,CAAC,eAAe,CAAC;IAC9D,IAAI,CAAC0N,eAAe,GAAGtP,QAAQ,CAACG,cAAc,CAAC,gBAAgB,CAAC;IAChE,IAAI,CAACoP,YAAY,GAAGvP,QAAQ,CAACG,cAAc,CAAC,eAAe,CAAC;IAC5D,IAAI,CAACqP,mBAAmB,GAAG,IAAIzB,wCAAmB,CAAC,CAAC;IACpD,IAAI,CAAC0B,SAAS,GAAGzP,QAAQ,CAACG,cAAc,CAAC,YAAY,CAAC;IACtD,IAAI,CAACuP,WAAW,GAAG1P,QAAQ,CAACG,cAAc,CAAC,cAAc,CAAC;IAC1D,IAAI,IAAI,CAACgP,QAAQ,CAACvM,GAAG,CAAC,mBAAmB,CAAC,KAAK,IAAI,EAAE;MACnD,IAAI,CAACsC,OAAO,CAACpD,SAAS,CAACC,GAAG,CAAC,WAAW,CAAC;IACzC;IACA,IAAI,CAACwJ,kBAAkB,CAAC,CAAC;EAC3B;EAEAC,MAAMA,CAAA,EAAG;IACP,IAAI,CAACJ,QAAQ,CAACI,MAAM,CAAC,CAAC;EACxB;EAEAD,kBAAkBA,CAAA,EAAG;IACnBlH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAACgJ,kBAAkB,CAAC;IACrD,IAAI,CAACiC,YAAY,CAAChP,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACoP,YAAY,CAACjE,IAAI,CAAC,IAAI,CAAC,CAAC;IACzE,IAAI,CAACgE,WAAW,CAACnP,gBAAgB,CAC/B,UAAU,EACV,IAAAiF,kBAAQ,EAAC,IAAI,CAACoK,aAAa,CAAClE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAC5C,CAAC;IACD,IAAI,CAACgE,WAAW,CAACnP,gBAAgB,CAC/B,OAAO,EACP,IAAAiF,kBAAQ,EAAC,IAAI,CAACoK,aAAa,CAAClE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAC5C,CAAC;IACD,IAAI,CAAC0D,aAAa,CAAC7O,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACsP,aAAa,CAACnE,IAAI,CAAC,IAAI,CAAC,CAAC;IAC3E,IAAI,CAAC2D,WAAW,CAAC9O,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACuP,WAAW,CAACpE,IAAI,CAAC,IAAI,CAAC,CAAC;IACvE,IAAI,CAAC4D,eAAe,CAAC/O,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACwP,MAAM,CAACrE,IAAI,CAAC,IAAI,CAAC,CAAC;EACxE;;EAEA;EACA4B,kBAAkB,GAAIlD,IAAI,IAAK;IAC7B,MAAM4F,QAAQ,GAAG,IAAI,CAAC9K,OAAO,CAACtD,aAAa,CAAE,OAAMwI,IAAI,CAACzK,EAAG,EAAC,CAAC;IAC7D,IAAIqQ,QAAQ,EAAE;MACZA,QAAQ,CAACC,cAAc,CAAC;QACtBC,QAAQ,EAAE,QAAQ;QAClBC,KAAK,EAAE,OAAO;QAAE;QAChBC,MAAM,EAAE,SAAS,CAAE;MACrB,CAAC,CAAC;IACJ;EACF,CAAC;EAEDT,YAAYA,CAAA,EAAG;IACb,MAAMF,SAAS,GAAGzP,QAAQ,CAACG,cAAc,CAAC,YAAY,CAAC;IACvDsP,SAAS,CAAC3N,SAAS,CAACiO,MAAM,CAAC,QAAQ,CAAC;IACpC,IAAI,CAACL,WAAW,CAACW,KAAK,CAAC,CAAC;EAC1B;EAEAT,aAAaA,CAAA,EAAG;IACd,SAASU,YAAYA,CAACC,MAAM,EAAE;MAC5B,OAAOA,MAAM,CAACC,OAAO,CAAC,qBAAqB,EAAE,MAAM,CAAC,CAAC,CAAC;IACxD;IACA,MAAMC,KAAK,GAAGH,YAAY,CAAC,IAAI,CAACZ,WAAW,CAACnN,KAAK,CAACmO,IAAI,CAAC,CAAC,CAAC,CAACF,OAAO,CAC/D,MAAM,EACN,IACF,CAAC;IACD,MAAMG,YAAY,GAAGF,KAAK,CAACrR,MAAM,GAAG,CAAC,CAAC,CAAC;IACvC,MAAMwR,KAAK,GAAG,IAAIC,MAAM,CAACJ,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;IACtC1P,OAAO,CAAC6D,GAAG,CAAE,UAAS6L,KAAM,EAAC,CAAC;IAC9BxG,UAAI,CAACnC,MAAM,CAAC,CAAC,CAACmF,IAAI,CAAEY,KAAK,IAAK;MAC5B,MAAMiD,OAAO,GAAGjD,KAAK,CAClBkD,MAAM,CAAE3G,IAAI,IAAK;QAChB,IAAI4G,KAAK,GAAGJ,KAAK,CAACK,IAAI,CAAC7G,IAAI,CAACO,KAAK,CAAC;QAClC,IAAIgG,YAAY,EAAE;UAChBK,KAAK,KAAKJ,KAAK,CAACK,IAAI,CAAC7G,IAAI,CAAChK,OAAO,CAAC;QACpC;QACA,OAAO4Q,KAAK;MACd,CAAC,CAAC,CACDzH,GAAG,CAAEa,IAAI,IAAKA,IAAI,CAACzK,EAAE,CAAC;MACzB,IAAI,CAACuF,OAAO,CAACgH,gBAAgB,CAAC,iBAAiB,CAAC,CAACG,OAAO,CAAEC,IAAI,IAAK;QACjE,IAAIwE,OAAO,CAACI,QAAQ,CAAC5E,IAAI,CAAC3H,IAAI,CAAChF,EAAE,CAAC,EAAE;UAClC;UACA2M,IAAI,CAACxK,SAAS,CAACK,MAAM,CAAC,QAAQ,CAAC;QACjC,CAAC,MAAM;UACLmK,IAAI,CAACxK,SAAS,CAACC,GAAG,CAAC,QAAQ,CAAC;QAC9B;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAgO,MAAMA,CAAA,EAAG;IACP,IAAI,CAAC7K,OAAO,CAACpD,SAAS,CAACiO,MAAM,CAAC,WAAW,CAAC;IAC1C,IAAI,CAACT,eAAe,CAACxN,SAAS,CAACiO,MAAM,CAAC,WAAW,CAAC;IAClD,IAAI,IAAI,CAAC7K,OAAO,CAACpD,SAAS,CAACqP,QAAQ,CAAC,WAAW,CAAC,EAAE;MAChD,IAAI,CAAChC,QAAQ,CAAC7M,GAAG,CAAC,mBAAmB,EAAE,IAAI,CAAC;IAC9C,CAAC,MAAM;MACL,IAAI,CAAC6M,QAAQ,CAAC7M,GAAG,CAAC,mBAAmB,EAAE,KAAK,CAAC;IAC/C;EACF;EAEA,MAAMuN,aAAaA,CAAA,EAAG;IACpB,MAAMrF,4BAAa,CAACE,UAAU,CAAC,CAAC;EAClC;EAEA,MAAMoF,WAAWA,CAAA,EAAG;IAClB,MAAMtF,4BAAa,CAACS,UAAU,CAAC,CAAC;EAClC;AACF;AAAC7I,OAAA,CAAA8M,OAAA,GAAAA,OAAA;;;;;;;;ACjHM,MAAMkC,UAAU,CAAC;EACtB5R,WAAWA,CAAA,EAAG;IACZQ,QAAQ,CAACO,gBAAgB,CAAC,OAAO,EAAGC,KAAK,IAAK;MAC5C;MACA,IAAIA,KAAK,CAACsG,MAAM,CAAChF,SAAS,CAACqP,QAAQ,CAAC,aAAa,CAAC,EAAE;QAClD,MAAME,cAAc,GAAG7Q,KAAK,CAACsG,MAAM,CAACwK,YAAY,CAAC,aAAa,CAAC;QAC/D,IAAI,CAACD,cAAc,EAAE;UACnBtQ,OAAO,CAACC,KAAK,CAAC,sCAAsC,CAAC;UACrD;QACF;QACA,MAAMuQ,UAAU,GAAGvR,QAAQ,CAACG,cAAc,CAACkR,cAAc,CAAC,CAACG,SAAS;QACpE;QACA,MAAMC,QAAQ,GAAGzR,QAAQ,CAACwO,aAAa,CAAC,UAAU,CAAC;QACnDiD,QAAQ,CAAClP,KAAK,GAAGgP,UAAU;QAC3BvR,QAAQ,CAACC,IAAI,CAACiC,WAAW,CAACuP,QAAQ,CAAC;;QAEnC;QACAA,QAAQ,CAACC,MAAM,CAAC,CAAC;QACjB1R,QAAQ,CAAC2R,WAAW,CAAC,MAAM,CAAC;;QAE5B;QACA3R,QAAQ,CAACC,IAAI,CAAC2R,WAAW,CAACH,QAAQ,CAAC;;QAEnC;QACAI,KAAK,CAAC,0BAA0B,CAAC;MACnC;IACF,CAAC,CAAC;EACJ;AACF;AAACzP,OAAA,CAAAgP,UAAA,GAAAA,UAAA;;;;;;;;AC5BM,MAAMU,SAAS,CAAC;EACrBtS,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACuS,eAAe,GAAG,IAAI;EAC7B;EAEA,MAAMC,IAAIA,CAACxO,GAAG,EAAEmB,IAAI,EAAEsN,UAAU,EAAEC,OAAO,EAAEC,MAAM,EAAE;IACjD,MAAMzL,OAAO,GAAG;MAAE/B;IAAK,CAAC;IACxB,IAAI;MACF,MAAMyN,QAAQ,GAAG,MAAM,IAAI,CAACC,eAAe,CAAC7O,GAAG,EAAEmB,IAAI,CAAC;MACtD,MAAM,IAAI,CAAC2N,cAAc,CAAC5L,OAAO,EAAE0L,QAAQ,EAAEH,UAAU,EAAEE,MAAM,CAAC;IAClE,CAAC,CAAC,OAAOnR,KAAK,EAAE;MACdkR,OAAO,CAACxL,OAAO,EAAE1F,KAAK,CAAC;IACzB;EACF;EAEA,MAAMqR,eAAeA,CAAC7O,GAAG,EAAEmB,IAAI,EAAE;IAC/B,IAAI,CAACoN,eAAe,GAAG,IAAIQ,eAAe,CAAC,CAAC;IAC5C,MAAM;MAAEC;IAAO,CAAC,GAAG,IAAI,CAACT,eAAe;IACvC,MAAMK,QAAQ,GAAG,MAAMK,KAAK,CAACjP,GAAG,EAAE;MAChCgP,MAAM;MACNE,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB,CAAC;MAC/C1S,IAAI,EAAEL,IAAI,CAACC,SAAS,CAAC8E,IAAI;IAC3B,CAAC,CAAC;IAEF,IAAI,CAACyN,QAAQ,CAACQ,EAAE,EAAE;MAChB,MAAM,IAAItM,KAAK,CAAE,GAAE9C,GAAI,uBAAsB4O,QAAQ,CAACS,MAAO,EAAC,CAAC;IACjE;IAEA,OAAOT,QAAQ;EACjB;EAEA,MAAME,cAAcA,CAAC5L,OAAO,EAAE0L,QAAQ,EAAEH,UAAU,EAAEE,MAAM,EAAE;IAC1D,MAAMW,MAAM,GAAGV,QAAQ,CAACnS,IAAI,CAAC8S,SAAS,CAAC,CAAC;IACxC,IAAIC,WAAW,GAAG,EAAE;IACpB,IAAIC,aAAa,GAAG,KAAK;IAEzB,OAAO,CAACA,aAAa,EAAE;MACrB,MAAM;QAAEC,IAAI;QAAE3Q;MAAM,CAAC,GAAG,MAAMuQ,MAAM,CAACK,IAAI,CAAC,CAAC;MAC3C,IAAID,IAAI,EAAE;QACRf,MAAM,CAACzL,OAAO,EAAE0L,QAAQ,CAAC;QACzBa,aAAa,GAAG,IAAI;QACpB;MACF;MAEA,MAAMG,SAAS,GAAG,IAAIC,WAAW,CAAC,CAAC,CAACC,MAAM,CAAC/Q,KAAK,CAAC;MACjD,MAAMgR,KAAK,GAAG,CAACP,WAAW,GAAGI,SAAS,EAAEI,KAAK,CAAC,IAAI,CAAC;MACnDR,WAAW,GAAGO,KAAK,CAACE,GAAG,CAAC,CAAC;MAEzBF,KAAK,CAAClH,OAAO,CAAEqH,IAAI,IAAK;QACtB,MAAMC,YAAY,GAAG/T,IAAI,CAACoD,KAAK,CAAC0Q,IAAI,CAAC;QACrC,IAAIA,IAAI,CAAChD,IAAI,CAAC,CAAC,EAAE;UACf;UACA,IAAI,CAACkD,kBAAkB,CAACD,YAAY,CAAC;UACrC1B,UAAU,CAACvL,OAAO,EAAEiN,YAAY,CAAClU,OAAO,CAACW,OAAO,CAAC;QACnD;MACF,CAAC,CAAC;IACJ;IAEA,IAAI4S,WAAW,CAACtC,IAAI,CAAC,CAAC,EAAE;MACtBuB,UAAU,CAACvL,OAAO,EAAEsM,WAAW,CAAC;IAClC;EACF;EAEAa,KAAKA,CAAA,EAAG;IACN,IAAI,IAAI,CAAC9B,eAAe,EAAE;MACxB,IAAI,CAACA,eAAe,CAAC8B,KAAK,CAAC,CAAC;IAC9B;EACF;EAEAD,kBAAkBA,CAACjP,IAAI,EAAE;IACvB,IAAI,CAACA,IAAI,CAACmP,cAAc,EAAE;MACxB;IACF;IACA;IACA,MAAMC,sBAAsB,GAAGpP,IAAI,CAACmP,cAAc,GAAG,GAAG;IACxD,MAAME,qBAAqB,GAAGrP,IAAI,CAACsP,aAAa,GAAG,GAAG;IACtD,MAAMC,2BAA2B,GAAGvP,IAAI,CAACwP,oBAAoB,GAAG,GAAG;IACnE,MAAMC,6BAA6B,GAAGzP,IAAI,CAAC0P,aAAa,GAAG,GAAG;;IAE9D;IACA,MAAMC,eAAe,GAAG3P,IAAI,CAAC4P,UAAU,GAAGH,6BAA6B;IACvE,MAAMI,MAAM,GAAI;AACpB,SAAS7P,IAAI,CAAChB,KAAM;AACpB,cAAcgB,IAAI,CAAC8P,UAAW;AAC9B,sBAAsBV,sBAAsB,CAACW,OAAO,CAAC,CAAC,CAAE;AACxD,qBAAqBV,qBAAqB,CAACU,OAAO,CAAC,CAAC,CAAE;AACtD,2BAA2B/P,IAAI,CAACgQ,iBAAkB;AAClD,kCAAkCT,2BAA2B,CAACQ,OAAO,CAAC,CAAC,CAAE;AACzE,6BAA6B/P,IAAI,CAAC4P,UAAW;AAC7C,oCAAoCH,6BAA6B,CAACM,OAAO,CAAC,CAAC,CAAE;AAC7E,qBAAqBJ,eAAe,CAACI,OAAO,CAAC,CAAC,CAAE;AAChD,KAAK;IACD3T,OAAO,CAAC6D,GAAG,CAAC4P,MAAM,CAAC;EACrB;EAEA,OAAOI,SAASA,CAACpR,GAAG,EAAEyO,UAAU,EAAE;IAChC,IAAI,CAACzO,GAAG,EAAE;MACR,OAAO,IAAI;IACb;IAEA,OAAOiP,KAAK,CAACjP,GAAG,CAAC,CACdyJ,IAAI,CAAEmF,QAAQ,IAAK;MAClB,IAAI,CAACA,QAAQ,CAACQ,EAAE,EAAE;QAChB,MAAM,IAAItM,KAAK,CAAE,+BAA8B9C,GAAI,EAAC,CAAC;MACvD;MACA,OAAO4O,QAAQ,CAACyC,IAAI,CAAC,CAAC;IACxB,CAAC,CAAC,CACD5H,IAAI,CAAEtI,IAAI,IAAK;MACdsN,UAAU,CAACtN,IAAI,CAACmQ,MAAM,CAAC;IACzB,CAAC,CAAC,CACDC,KAAK,CAAE/T,KAAK,IAAK;MAChBD,OAAO,CAACS,KAAK,CAACR,KAAK,CAAC;MACpBD,OAAO,CAACC,KAAK,CACV,2CAA0CwC,GAAI,qBACjD,CAAC;MACDyO,UAAU,CAAC,EAAE,CAAC;IAChB,CAAC,CAAC;EACN;AACF;AAAC7P,OAAA,CAAA0P,SAAA,GAAAA,SAAA;;;;;;;;ACvHM,MAAMkD,cAAc,CAAC;EAC1BxV,WAAWA,CAAA,EAAG;IACZQ,QAAQ,CAACO,gBAAgB,CAAC,OAAO,EAAGC,KAAK,IAAK;MAC5C;MACA,IAAIA,KAAK,CAACsG,MAAM,CAAChF,SAAS,CAACqP,QAAQ,CAAC,iBAAiB,CAAC,EAAE;QACtD;QACA,MAAM8D,QAAQ,GAAGzU,KAAK,CAACsG,MAAM,CAACwK,YAAY,CAAC,aAAa,CAAC;QACzD,IAAI,CAAC4D,sBAAsB,CAACD,QAAQ,EAAE,WAAW,CAAC;MACpD;IACF,CAAC,CAAC;EACJ;EAEAC,sBAAsBA,CAACC,SAAS,EAAEC,QAAQ,EAAE;IAC1C;IACA,MAAMlQ,OAAO,GAAGlF,QAAQ,CAACG,cAAc,CAACgV,SAAS,CAAC;IAClD,IAAI,CAACjQ,OAAO,EAAE;MACZnE,OAAO,CAACC,KAAK,CAAC,mBAAmB,CAAC;MAClC;IACF;;IAEA;IACA,MAAMZ,OAAO,GAAG8E,OAAO,CAACsM,SAAS;;IAEjC;IACA,MAAMpD,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACjO,OAAO,CAAC,EAAE;MAAEV,IAAI,EAAE;IAAY,CAAC,CAAC;;IAEvD;IACA,MAAM6O,CAAC,GAAGvO,QAAQ,CAACwO,aAAa,CAAC,GAAG,CAAC;IACrCD,CAAC,CAACjL,IAAI,GAAGD,GAAG,CAACiL,eAAe,CAACF,IAAI,CAAC;IAClCG,CAAC,CAACE,QAAQ,GAAG2G,QAAQ;;IAErB;IACApV,QAAQ,CAACC,IAAI,CAACiC,WAAW,CAACqM,CAAC,CAAC;IAC5BA,CAAC,CAACG,KAAK,CAAC,CAAC;IACT1O,QAAQ,CAACC,IAAI,CAAC2R,WAAW,CAACrD,CAAC,CAAC;;IAE5B;IACAlL,GAAG,CAACsL,eAAe,CAACJ,CAAC,CAACjL,IAAI,CAAC;EAC7B;AACF;AAAClB,OAAA,CAAA4S,cAAA,GAAAA,cAAA;;;;;;;;ACvCM,MAAMK,YAAY,CAAC;EACxB7V,WAAWA,CAAA,EAAG;IACZ,IAAI,CAAC8V,cAAc,GAAG,iBAAiB;IACvC,IAAI,CAACC,aAAa,GAAGvV,QAAQ,CAACkM,gBAAgB,CAAC,IAAI,CAACoJ,cAAc,CAAC;IACnE,IAAI,CAACE,IAAI,CAAC,CAAC;EACb;EAEAA,IAAIA,CAAA,EAAG;IACL;IACAxV,QAAQ,CAACO,gBAAgB,CAAC,OAAO,EAAGC,KAAK,IAAK;MAC5C;MACA,MAAMiV,WAAW,GAAGjV,KAAK,CAACsG,MAAM,CAAC4O,OAAO,CAAC,IAAI,CAACJ,cAAc,CAAC;MAC7D,IAAIG,WAAW,EAAE;QACf,MAAME,YAAY,GAAGF,WAAW,CAAC7T,aAAa,CAAC,uBAAuB,CAAC;QACvE,IAAI+T,YAAY,EAAE;UAChB,IAAI,CAACC,UAAU,CAACD,YAAY,CAAC;QAC/B;MACF;IACF,CAAC,CAAC;EACJ;EAEAC,UAAUA,CAACC,IAAI,EAAE;IACfA,IAAI,CAAC/T,SAAS,CAACiO,MAAM,CAAC,QAAQ,CAAC;IAC/B8F,IAAI,CAAC/T,SAAS,CAACiO,MAAM,CAAC,SAAS,CAAC;EAClC;AACF;AAAC3N,OAAA,CAAAiT,YAAA,GAAAA,YAAA;;;;;;;;ACzBD;AACO,MAAMS,KAAK,CAAC;EACjBtW,WAAWA,CAACM,KAAK,EAAE;IACjB,IAAI,CAACA,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACiW,KAAK,GAAG/V,QAAQ,CAACG,cAAc,CAAC,IAAI,CAACL,KAAK,CAAC;IAChD,IAAI,CAACkC,WAAW,GAAG,IAAI,CAAC+T,KAAK,CAACnU,aAAa,CAAC,eAAe,CAAC;IAC5D,IAAI,CAACI,WAAW,CAACC,OAAO,GAAG,MAAM,IAAI,CAACvB,IAAI,CAAC,CAAC;IAC5C,IAAI,CAACL,mBAAmB,CAAC,CAAC;EAC5B;EAEAA,mBAAmBA,CAAA,EAAG;IACpBC,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAGC,KAAK,IAAK;MAC5C,IAAIA,KAAK,CAACC,GAAG,KAAK,QAAQ,EAAE;QAC1B,IAAI,CAACC,IAAI,CAAC,CAAC;MACb;IACF,CAAC,CAAC;EACJ;EAEAC,IAAIA,CAAA,EAAG;IACL,IAAI,CAACqV,UAAU,CAAC,CAAC;EACnB;EAEAtV,IAAIA,CAAA,EAAG;IACL,IAAI,CAACuV,UAAU,CAAC,CAAC;EACnB;EAEAD,UAAUA,CAAA,EAAG;IACX,IAAI,CAACD,KAAK,CAACjU,SAAS,CAACC,GAAG,CAAC,MAAM,CAAC;EAClC;EAEAkU,UAAUA,CAAA,EAAG;IACX,IAAI,CAACF,KAAK,CAACjU,SAAS,CAACK,MAAM,CAAC,MAAM,CAAC;EACrC;AACF;AAACC,OAAA,CAAA0T,KAAA,GAAAA,KAAA;;;;;;;;ACjCM,MAAMI,IAAI,CAAC;EAChB1W,WAAWA,CAAC2W,WAAW,EAAEC,KAAK,EAAE/K,QAAQ,EAAE;IACxC,IAAI,CAACtL,SAAS,GAAGC,QAAQ,CAACG,cAAc,CAACgW,WAAW,CAAC;IACrD,IAAI,CAACC,KAAK,GAAGA,KAAK;IAClB,IAAI,CAAC/K,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACG,MAAM,CAAC,CAAC;IACb,IAAI,CAAC6K,YAAY,GAAG,IAAI;EAC1B;EAEAzK,OAAOA,CAACpH,OAAO,EAAE;IACf,IAAI,CAAC6R,YAAY,GAAG7R,OAAO;IAC3B,OAAO,IAAI,CAAC,CAAC;EACf;EAEA8R,QAAQA,CAACF,KAAK,EAAE;IACd,IAAI,CAACA,KAAK,GAAGA,KAAK;IAClB,IAAI,CAAC5K,MAAM,CAAC,CAAC;EACf;EAEA+K,WAAWA,CAAClL,QAAQ,EAAE;IACpBtK,OAAO,CAACS,KAAK,CAAE,UAAS6J,QAAS,EAAC,CAAC;IACnC,IAAI,CAACA,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACG,MAAM,CAAC,CAAC;EACf;EAEAgL,WAAWA,CAAA,EAAG;IACZ,OAAO,IAAI,CAACnL,QAAQ;EACtB;EAEAG,MAAMA,CAAA,EAAG;IACP,IAAI,CAACzL,SAAS,CAAC8M,SAAS,GAAG,EAAE,CAAC,CAAC;IAC/B,MAAM4J,EAAE,GAAGzW,QAAQ,CAACwO,aAAa,CAAC,IAAI,CAAC;IACvCiI,EAAE,CAAC3U,SAAS,CAACC,GAAG,CAAC,MAAM,CAAC;IACxB,IAAI,CAACqU,KAAK,CAAC/J,OAAO,CAAEC,IAAI,IAAK;MAC3B,MAAMoK,EAAE,GAAG1W,QAAQ,CAACwO,aAAa,CAAC,IAAI,CAAC;MACvCkI,EAAE,CAAC5U,SAAS,CAACC,GAAG,CAAC,WAAW,CAAC;MAC7B,IAAIuK,IAAI,KAAK,IAAI,CAACjB,QAAQ,EAAE;QAC1BqL,EAAE,CAAC5U,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;MAC9B;MACA2U,EAAE,CAAC7U,WAAW,GAAGyK,IAAI;MACrBoK,EAAE,CAACpK,IAAI,GAAGA,IAAI;MACdoK,EAAE,CAACnW,gBAAgB,CAAC,OAAO,EAAE,MAAM;QACjC,IAAI,CAACgW,WAAW,CAACjK,IAAI,CAAC;QACtB,IAAI,IAAI,CAAC+J,YAAY,EAAE;UACrB,IAAI,CAACA,YAAY,CAAC/J,IAAI,CAAC;QACzB;MACF,CAAC,CAAC;MACFmK,EAAE,CAACvU,WAAW,CAACwU,EAAE,CAAC;IACpB,CAAC,CAAC;IACF,IAAI,CAAC3W,SAAS,CAACmC,WAAW,CAACuU,EAAE,CAAC;EAChC;AACF;AAACrU,OAAA,CAAA8T,IAAA,GAAAA,IAAA;;;;;;;;ACnDD,IAAA7L,MAAA,GAAAxB,OAAA;AACA,IAAA0B,SAAA,GAAA1B,OAAA;AACA,IAAA8N,UAAA,GAAA9N,OAAA;AAEO,MAAM+N,MAAM,CAAC;EAClB,OAAO9B,MAAM,GAAG,EAAE;EAElB,OAAO5R,MAAMA,CAAA,EAAG;IACd,OAAOb,kBAAQ,CAACa,MAAM,CAAC,WAAW,CAAC;EACrC;EAEA,OAAO2T,IAAIA,CAAA,EAAG;IACZ,IAAI,CAAC,IAAI,CAAC3T,MAAM,CAAC,CAAC,EAAE;MAClB,OAAO,IAAI;IACb;IACA,OAAO4O,oBAAS,CAAC8C,SAAS,CAAC,IAAI,CAAC1R,MAAM,CAAC,CAAC,EAAG4R,MAAM,IAAK;MACpD8B,MAAM,CAAC9B,MAAM,GAAGA,MAAM;MACtBzS,kBAAQ,CAACC,GAAG,CAAC,QAAQ,EAAEsU,MAAM,CAAC9B,MAAM,CAAC;MACrCzQ,YAAK,CAACK,IAAI,CAAC,cAAc,EAAEkS,MAAM,CAAC9B,MAAM,CAAC;IAC3C,CAAC,CAAC;EACJ;EAEA,OAAOhN,MAAMA,CAAA,EAAG;IACd,OAAO8O,MAAM,CAAC9B,MAAM;EACtB;EAEA,OAAOgC,QAAQA,CAAA,EAAG;IAChB,OAAOF,MAAM,CAAC9B,MAAM,CAACvL,GAAG,CAAE5F,KAAK,IAAKA,KAAK,CAAC0F,IAAI,CAAC;EACjD;EAEA,OAAO0N,eAAeA,CAAC1N,IAAI,EAAE;IAC3B,OAAOuN,MAAM,CAAC9B,MAAM,CAACkC,IAAI,CAAErT,KAAK,IAAKA,KAAK,CAAC0F,IAAI,KAAKA,IAAI,CAAC;EAC3D;AACF;AAACjH,OAAA,CAAAwU,MAAA,GAAAA,MAAA;;;;;;;;ACjCD,IAAAK,KAAA,GAAApO,OAAA;AACA,IAAAwB,MAAA,GAAAxB,OAAA;AACA,IAAAqO,OAAA,GAAArO,OAAA;AAEO,MAAMsO,UAAU,CAAC;EACtB3X,WAAWA,CAACwM,QAAQ,EAAEoL,aAAa,EAAE;IACnC,IAAI,CAACC,SAAS,GAAG,IAAInB,UAAI,CAAClK,QAAQ,EAAE4K,cAAM,CAACE,QAAQ,CAAC,CAAC,EAAEM,aAAa,CAAC;IACrE,IAAI,CAAC7L,kBAAkB,CAAC,CAAC;EAC3B;EAEAA,kBAAkBA,CAAA,EAAG;IACnBlH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAACgT,kBAAkB,CAAC5L,IAAI,CAAC,IAAI,CAAC,CAAC;EAClE;EAEA4L,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAACD,SAAS,CAACf,QAAQ,CAACM,cAAM,CAACE,QAAQ,CAAC,CAAC,CAAC;EAC5C;EAEAlL,OAAOA,CAACpH,OAAO,EAAE;IACf,IAAI,CAAC6S,SAAS,CAAChB,YAAY,GAAG7R,OAAO;IACrC,OAAO,IAAI,CAAC6S,SAAS,CAAC,CAAC;EACzB;EAEAb,WAAWA,CAAA,EAAG;IACZ,OAAO,IAAI,CAACa,SAAS,CAAChM,QAAQ;EAChC;AACF;AAACjJ,OAAA,CAAA+U,UAAA,GAAAA,UAAA;;;;;;;;AC1BD,IAAAI,MAAA,GAAA1O,OAAA;AACA,IAAA2O,eAAA,GAAA3O,OAAA;AACA,IAAA4O,WAAA,GAAA5O,OAAA;AACA,IAAAqO,OAAA,GAAArO,OAAA;AACA,IAAA0B,SAAA,GAAA1B,OAAA;AAEO,MAAM6O,cAAc,SAAS5B,YAAK,CAAC;EACxCtW,WAAWA,CAAA,EAAG;IACZ,KAAK,CAAC,iBAAiB,CAAC;IACxB,IAAI,CAACmY,UAAU,GAAG3X,QAAQ,CAACG,cAAc,CAAC,iBAAiB,CAAC;IAC5D,IAAI,CAACyX,QAAQ,GAAG5X,QAAQ,CAACG,cAAc,CAAC,WAAW,CAAC;IACpD,IAAI,CAAC0X,UAAU,GAAG7X,QAAQ,CAACG,cAAc,CAAC,aAAa,CAAC;IACxD,IAAI,CAAC2X,iBAAiB,GAAG,IAAI,CAAC/B,KAAK,CAACnU,aAAa,CAAC,sBAAsB,CAAC;IACzE,IAAI,CAACmW,oBAAoB,GAAG,IAAI,CAAChC,KAAK,CAACnU,aAAa,CAClD,yBACF,CAAC;IACD,IAAI,CAACoW,mBAAmB,GAAG,IAAI,CAACjC,KAAK,CAACnU,aAAa,CACjD,wBACF,CAAC;IACD,IAAI,CAACyV,SAAS,GAAG,IAAIF,sBAAU,CAAC,YAAY,EAAE9U,kBAAQ,CAACoB,QAAQ,CAAC,CAAC,CAAC;IAClE,IAAI,CAAC8H,kBAAkB,CAAC,CAAC;IACzB,IAAI,CAAC0M,YAAY,CAAC,CAAC;EACrB;EAEA1M,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAACqM,QAAQ,CAACrX,gBAAgB,CAAC,MAAM,EAAE,MAAM;MAC3C,MAAMgC,KAAK,GAAG,IAAI,CAACqV,QAAQ,CAACrV,KAAK,CAACmO,IAAI,CAAC,CAAC;MACxCrO,kBAAQ,CAACkB,MAAM,CAAChB,KAAK,CAAC;IACxB,CAAC,CAAC;IACF,IAAI,CAACuV,iBAAiB,CAACvX,gBAAgB,CAAC,MAAM,EAAE,MAAM;MACpD8B,kBAAQ,CAACwB,eAAe,CAAC,IAAI,CAACiU,iBAAiB,CAACvV,KAAK,CAACmO,IAAI,CAAC,CAAC,CAAC;IAC/D,CAAC,CAAC;IACF,IAAI,CAACqH,oBAAoB,CAACxX,gBAAgB,CAAC,MAAM,EAAE,MAAM;MACvD,MAAMgC,KAAK,GAAG,IAAI,CAACwV,oBAAoB,CAACxV,KAAK,CAACmO,IAAI,CAAC,CAAC;MACpD,IAAInO,KAAK,KAAK,EAAE,EAAE;QAChB;MACF;MACA,IAAI;QACF,MAAM2V,WAAW,GAAGtY,IAAI,CAACoD,KAAK,CAACT,KAAK,CAAC;QACrC,MAAM4V,UAAU,GAAGvY,IAAI,CAACC,SAAS,CAACqY,WAAW,EAAE,CAAC,CAAC;QACjD7V,kBAAQ,CAAC2B,kBAAkB,CAACkU,WAAW,CAAC;QACxC,IAAI,CAACH,oBAAoB,CAACxV,KAAK,GAAG4V,UAAU;QAC5C,IAAI,CAACJ,oBAAoB,CAACjW,SAAS,CAACK,MAAM,CAAC,OAAO,CAAC;MACrD,CAAC,CAAC,OAAOnB,KAAK,EAAE;QACd,IAAIA,KAAK,CAACqI,IAAI,KAAK,aAAa,EAAE;UAChC,IAAI,CAAC0O,oBAAoB,CAACjW,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;QAClD,CAAC,MAAM;UACLhB,OAAO,CAACC,KAAK,CAACA,KAAK,CAAC;QACtB;MACF;IACF,CAAC,CAAC;IACF,IAAI,CAACqW,SAAS,CAACzL,OAAO,CAAC,MAAM;MAC3BvJ,kBAAQ,CAACqB,QAAQ,CAAC,IAAI,CAAC2T,SAAS,CAACb,WAAW,CAAC,CAAC,CAAC;IACjD,CAAC,CAAC;IACF,IAAI,CAACmB,UAAU,CAACpX,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACI,IAAI,CAAC+K,IAAI,CAAC,IAAI,CAAC,CAAC;IAC/D,IAAI,CAACsM,mBAAmB,CAAC/V,OAAO,GAAG,MAAM,IAAI,CAACmW,aAAa,CAAC,CAAC;IAC7D,IAAI,CAACpW,WAAW,CAACC,OAAO,GAAG,MAAM,IAAI,CAACvB,IAAI,CAAC,CAAC;EAC9C;EAEAC,IAAIA,CAAA,EAAG;IACLiW,cAAM,CAACC,IAAI,CAAC,CAAC;IACb,IAAI,CAACb,UAAU,CAAC,CAAC;EACnB;EAEAoC,aAAaA,CAAA,EAAG;IACd,IAAI,CAACxB,cAAM,CAAC1T,MAAM,CAAC,CAAC,EAAE;MACpB3D,8BAAc,CAACoB,IAAI,CAAC,oDAAoD,CAAC;IAC3E,CAAC,MAAM;MACLiW,cAAM,CAACC,IAAI,CAAC,CAAC;IACf;EACF;EAEAoB,YAAYA,CAAA,EAAG;IACb,IAAI,CAACL,QAAQ,CAACrV,KAAK,GAAGF,kBAAQ,CAACa,MAAM,CAAC,CAAC;IACvC,MAAMe,eAAe,GAAG5B,kBAAQ,CAAC0B,kBAAkB,CAAC,CAAC;IACrD,IAAIE,eAAe,EAAE;MACnB,IAAI,CAAC8T,oBAAoB,CAACxV,KAAK,GAAG3C,IAAI,CAACC,SAAS,CAACoE,eAAe,EAAE,CAAC,CAAC;IACtE;EACF;AACF;AAAC7B,OAAA,CAAAsV,cAAA,GAAAA,cAAA;;;;;;;;AC/ED,IAAAxM,cAAA,GAAArC,OAAA;AACA,IAAAwB,MAAA,GAAAxB,OAAA;AACA,IAAA0O,MAAA,GAAA1O,OAAA;AACA,IAAAqO,OAAA,GAAArO,OAAA;AACA,IAAA4O,WAAA,GAAA5O,OAAA;AAEO,MAAMwP,kBAAkB,SAASvC,YAAK,CAAC;EAC5CtW,WAAWA,CAAA,EAAG;IACZ,KAAK,CAAC,sBAAsB,CAAC;IAC7B,IAAI,CAACmY,UAAU,GAAG3X,QAAQ,CAACG,cAAc,CAAC,sBAAsB,CAAC;IACjE,IAAI,CAACoL,kBAAkB,CAAC,CAAC;EAC3B;EAEAA,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAACoM,UAAU,CAACpX,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACI,IAAI,CAAC+K,IAAI,CAAC,IAAI,CAAC,CAAC;IAC/DrH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAACgJ,kBAAkB,CAAC5B,IAAI,CAAC,IAAI,CAAC,CAAC;EAClE;EAEA/K,IAAIA,CAAA,EAAG;IACLiW,cAAM,CAACC,IAAI,CAAC,CAAC,CAAC5J,IAAI,CAAC,MAAM;MACvBzC,4BAAa,CAACO,cAAc,CAAC,CAAC,CAACkC,IAAI,CAAE7C,IAAI,IAAK;QAC5C,IAAI,CAACkD,kBAAkB,CAAClD,IAAI,CAAC;QAC7B,IAAI,CAAC4L,UAAU,CAAC,CAAC;MACnB,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEA1I,kBAAkBA,CAAClD,IAAI,EAAE;IACvB,IAAI,CAACiN,SAAS,GAAG,IAAIF,sBAAU,CAAC,iBAAiB,EAAE/M,IAAI,CAACzG,KAAK,CAAC;IAC9D,IAAI,CAAC0T,SAAS,CAACzL,OAAO,CAAC,MAAOjI,KAAK,IAAK;MACtCyG,IAAI,CAACzG,KAAK,GAAGA,KAAK;MAClB,MAAMyG,IAAI,CAACjB,IAAI,CAAC,CAAC;IACnB,CAAC,CAAC;EACJ;AACF;AAAC/G,OAAA,CAAAiW,kBAAA,GAAAA,kBAAA;;;;;;;;AClCM,MAAMC,UAAU,CAAC;EACtB,OAAOrK,UAAUA,CAAC7D,IAAI,EAAEgL,QAAQ,EAAE;IAChC;IACA,MAAMhV,OAAO,GAAGgK,IAAI,CAAChB,OAAO,CAAC,CAAC;;IAE9B;IACA,MAAMgF,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACjO,OAAO,CAAC,EAAE;MAAEV,IAAI,EAAE;IAAmB,CAAC,CAAC;;IAE9D;IACA,MAAM6O,CAAC,GAAGvO,QAAQ,CAACwO,aAAa,CAAC,GAAG,CAAC;IACrCD,CAAC,CAACjL,IAAI,GAAGD,GAAG,CAACiL,eAAe,CAACF,IAAI,CAAC;IAClCG,CAAC,CAACE,QAAQ,GAAG2G,QAAQ;;IAErB;IACApV,QAAQ,CAACC,IAAI,CAACiC,WAAW,CAACqM,CAAC,CAAC;IAC5BA,CAAC,CAACG,KAAK,CAAC,CAAC;IACT1O,QAAQ,CAACC,IAAI,CAAC2R,WAAW,CAACrD,CAAC,CAAC;;IAE5B;IACAlL,GAAG,CAACsL,eAAe,CAACJ,CAAC,CAACjL,IAAI,CAAC;EAC7B;AACF;AAAClB,OAAA,CAAAkW,UAAA,GAAAA,UAAA;;;;;;;;ACrBM,MAAMC,SAAS,CAAC;EACrB/Y,WAAWA,CAAC0F,OAAO,EAAE;IACnB,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtBA,OAAO,CAACsT,SAAS,GAAG,IAAI;IACxB,IAAI,CAACjN,kBAAkB,CAAC,CAAC;EAC3B;EAEAA,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAACrG,OAAO,CAAC3E,gBAAgB,CAAC,WAAW,EAAE,MAAM,IAAI,CAACkL,WAAW,CAAC,CAAC,CAAC;IACpE,IAAI,CAACvG,OAAO,CAAC3E,gBAAgB,CAAC,UAAU,EAAE,MAAM,IAAI,CAACoL,UAAU,CAAC,CAAC,CAAC;EACpE;EAEAF,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACvG,OAAO,CAACpD,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;EACrC;EAEA4J,UAAUA,CAAA,EAAG;IACX,IAAI,CAACzG,OAAO,CAACpD,SAAS,CAACK,MAAM,CAAC,OAAO,CAAC;EACxC;AACF;AAACC,OAAA,CAAAmW,SAAA,GAAAA,SAAA;;;;;;;;ACnBD,IAAAlO,MAAA,GAAAxB,OAAA;AACA,IAAAqC,cAAA,GAAArC,OAAA;AAEO,MAAM4P,SAAS,CAAC;EACrBjZ,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACkZ,YAAY,GAAG,UAAU;IAC9B,IAAI,CAACxT,OAAO,GAAGlF,QAAQ,CAACG,cAAc,CAAC,YAAY,CAAC;IACpD,IAAI,CAACoL,kBAAkB,CAAC,CAAC;IACzB,IAAI,CAACC,MAAM,CAAC,CAAC;EACf;EAEAA,MAAMA,CAAA,EAAG;IACPhB,4BAAa,CAACO,cAAc,CAAC,CAAC,CAACkC,IAAI,CAAE7C,IAAI,IAAK;MAC5C,IAAI,CAACA,IAAI,GAAGA,IAAI;MAChB,IAAI,CAACkB,QAAQ,CAAClB,IAAI,EAAEO,KAAK,CAAC;IAC5B,CAAC,CAAC;EACJ;EAEAW,QAAQA,CAACX,KAAK,EAAE;IACd,IAAI,CAACzF,OAAO,CAACrD,WAAW,GAAG8I,KAAK,IAAI,IAAI,CAAC+N,YAAY;EACvD;EAEArI,KAAKA,CAAA,EAAG;IACN,MAAMsI,QAAQ,GAAG3Y,QAAQ,CAAC4Y,aAAa,KAAK,IAAI,CAAC1T,OAAO;IACxD,IAAI,CAACyT,QAAQ,EAAE;MACb,IAAI,CAACzT,OAAO,CAACmL,KAAK,CAAC,CAAC;IACtB;EACF;EAEA9E,kBAAkBA,CAAA,EAAG;IACnBlH,YAAK,CAACC,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC6I,iBAAiB,CAACzB,IAAI,CAAC,IAAI,CAAC,CAAC;IAC9DrH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAACgJ,kBAAkB,CAAC5B,IAAI,CAAC,IAAI,CAAC,CAAC;IAChE,IAAI,CAACxG,OAAO,CAAC3E,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAACsY,UAAU,CAACnN,IAAI,CAAC,IAAI,CAAC,CAAC;IACjE,IAAI,CAACxG,OAAO,CAAC3E,gBAAgB,CAAC,UAAU,EAAGoC,CAAC,IAAK;MAC/C,IAAIA,CAAC,CAAClC,GAAG,KAAK,OAAO,EAAE;QACrBkC,CAAC,CAACgK,cAAc,CAAC,CAAC;QAClB,IAAI,CAACzH,OAAO,CAAC4T,IAAI,CAAC,CAAC;MACrB;IACF,CAAC,CAAC;EACJ;EAEAxL,kBAAkBA,CAAClD,IAAI,EAAE;IACvB,IAAI,CAACA,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACkB,QAAQ,CAAClB,IAAI,CAACO,KAAK,CAAC;EAC3B;EAEAwC,iBAAiBA,CAAC/C,IAAI,EAAE;IACtB,IAAIA,IAAI,CAACzK,EAAE,KAAK,IAAI,CAACyK,IAAI,CAACzK,EAAE,EAAE;MAC5B,IAAI,CAAC2L,QAAQ,CAAC,IAAI,CAACoN,YAAY,CAAC;IAClC;EACF;EAEA,MAAMG,UAAUA,CAAA,EAAG;IACjB,IAAIlO,KAAK,GAAG,IAAI,CAACzF,OAAO,CAACrD,WAAW,CAAC6O,IAAI,CAAC,CAAC;IAC3C,IAAI/F,KAAK,CAACvL,MAAM,KAAK,CAAC,EAAE;MACtBuL,KAAK,GAAG,IAAI,CAAC+N,YAAY;MACzB,IAAI,CAACxT,OAAO,CAACpD,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;IACrC,CAAC,MAAM;MACL,IAAI,CAACmD,OAAO,CAACpD,SAAS,CAACK,MAAM,CAAC,OAAO,CAAC;IACxC;IACA,MAAMiI,IAAI,GAAG,MAAMI,4BAAa,CAACO,cAAc,CAAC,CAAC;IACjD,IAAIX,IAAI,EAAE;MACR,MAAMI,4BAAa,CAACC,UAAU,CAACL,IAAI,EAAE;QAAEO;MAAM,CAAC,CAAC;IACjD,CAAC,MAAM;MACL,MAAMH,4BAAa,CAACE,UAAU,CAAC;QAAEC;MAAM,CAAC,CAAC;IAC3C;EACF;AACF;AAACvI,OAAA,CAAAqW,SAAA,GAAAA,SAAA;;;;;;;;ACnED;AACO,MAAMM,QAAQ,CAAC;EACpBvZ,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACwZ,WAAW,GAAGhZ,QAAQ,CAACG,cAAc,CAAC,cAAc,CAAC;IAC1D,IAAI,CAAC8Y,YAAY,GAAGjZ,QAAQ,CAACG,cAAc,CAAC,eAAe,CAAC;IAC5D,IAAI,CAAC+Y,UAAU,GAAGlZ,QAAQ,CAACG,cAAc,CAAC,aAAa,CAAC;IACxD,IAAI,CAACgZ,WAAW,GAAGnZ,QAAQ,CAACG,cAAc,CAAC,cAAc,CAAC;EAC5D;AACF;AAACiC,OAAA,CAAA2W,QAAA,GAAAA,QAAA;;;;;;;;ACRD,IAAA7N,cAAA,GAAArC,OAAA;AACA,IAAAuQ,WAAA,GAAAvQ,OAAA;AACA,IAAAwB,MAAA,GAAAxB,OAAA;AACA,IAAAwQ,UAAA,GAAAxQ,OAAA;AACA,IAAAyQ,UAAA,GAAAzQ,OAAA;AACA,IAAA0Q,SAAA,GAAA1Q,OAAA;AAEO,MAAM2Q,QAAQ,CAAC;EACpBha,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACsM,SAAS,GAAG,IAAI2M,oBAAS,CAAC,CAAC;IAChC,IAAI,CAACgB,QAAQ,GAAG,IAAIV,kBAAQ,CAAC,CAAC;IAC9B,IAAI,CAACC,WAAW,GAAGhZ,QAAQ,CAACG,cAAc,CAAC,cAAc,CAAC;IAC1D,IAAI,CAAC8Y,YAAY,GAAGjZ,QAAQ,CAACG,cAAc,CAAC,eAAe,CAAC;IAC5D,IAAI,CAACuZ,cAAc,GAAG1Z,QAAQ,CAACG,cAAc,CAAC,kBAAkB,CAAC;IACjE,IAAI,CAACwZ,iBAAiB,GAAG3Z,QAAQ,CAACG,cAAc,CAAC,sBAAsB,CAAC;IACxE,IAAI,CAACyZ,iBAAiB,GAAG5Z,QAAQ,CAACG,cAAc,CAAC,sBAAsB,CAAC;IACxE,IAAI,CAAC0Z,gBAAgB,GAAG7Z,QAAQ,CAACG,cAAc,CAAC,oBAAoB,CAAC;IACrE,IAAI,CAAC2Z,gBAAgB,GAAG9Z,QAAQ,CAACG,cAAc,CAAC,oBAAoB,CAAC;IACrEqK,4BAAa,CAACO,cAAc,CAAC,CAAC,CAACkC,IAAI,CAAE7C,IAAI,IAAK;MAC5C,IAAI,CAACA,IAAI,GAAGA,IAAI;MAChB,IAAI,CAACoB,MAAM,CAAC,CAAC;IACf,CAAC,CAAC;IACF,IAAI,CAACD,kBAAkB,CAAC,CAAC;EAC3B;EAEAC,MAAMA,CAAA,EAAG;IACP;IACA,IAAI,CAACwN,WAAW,CAACxH,SAAS,GAAG,EAAE;IAC/B;IACA,IAAI,CAACpH,IAAI,EAAED,WAAW,CAAC,CAAC,EAAE8C,IAAI,CAAEtD,QAAQ,IAAK;MAC3CA,QAAQ,CAAC0C,OAAO,CAAE5M,OAAO,IAAK;QAC5B,IAAI,CAACsa,gBAAgB,CAACta,OAAO,CAAC;MAChC,CAAC,CAAC;IACJ,CAAC,CAAC;IACF,IAAI,CAACua,WAAW,CAAC,CAAC;IAClB,IAAI,CAACf,YAAY,CAAC5I,KAAK,CAAC,CAAC;EAC3B;EAEA9E,kBAAkBA,CAAA,EAAG;IACnBlH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAACgJ,kBAAkB,CAAC5B,IAAI,CAAC,IAAI,CAAC,CAAC;IAChErH,YAAK,CAACC,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC6I,iBAAiB,CAACzB,IAAI,CAAC,IAAI,CAAC,CAAC;IAC9D,IAAI,CAACiO,iBAAiB,CAACpZ,gBAAgB,CACrC,OAAO,EACP,IAAI,CAAC0Z,WAAW,CAACvO,IAAI,CAAC,IAAI,CAC5B,CAAC;IACD,IAAI,CAACkO,iBAAiB,CAACrZ,gBAAgB,CACrC,OAAO,EACP,IAAI,CAACyZ,WAAW,CAACtO,IAAI,CAAC,IAAI,CAC5B,CAAC;IACD,IAAI,CAACgO,cAAc,CAACnZ,gBAAgB,CAClC,OAAO,EACP,IAAI,CAAC2Z,cAAc,CAACxO,IAAI,CAAC,IAAI,CAC/B,CAAC;IACD,IAAI,CAACmO,gBAAgB,CAACtZ,gBAAgB,CACpC,OAAO,EACP,IAAI,CAAC4Z,gBAAgB,CAACzO,IAAI,CAAC,IAAI,CACjC,CAAC;IACD,IAAI,CAACoO,gBAAgB,CAACvZ,gBAAgB,CAAC,OAAO,EAAE,MAAM;MACpD+X,sBAAU,CAACrK,UAAU,CAAC,IAAI,CAAC7D,IAAI,EAAG,QAAO,IAAI,CAACA,IAAI,CAACzK,EAAG,OAAM,CAAC;IAC/D,CAAC,CAAC;IACF,IAAI,CAACya,cAAc,GAAG,IAAI,CAACpB,WAAW,CAACpX,aAAa,CAAC,WAAW,CAAC;IACjE;IACA5B,QAAQ,CAACO,gBAAgB,CAAC,SAAS,EAAGC,KAAK,IAAK;MAC9C,IAAI6Z,IAAI,EAAEC,QAAQ;MAElB,IAAI9Z,KAAK,CAACC,GAAG,KAAK,WAAW,EAAE;QAC7B4Z,IAAI,GAAG,IAAI,CAACD,cAAc,GACtB,IAAI,CAACA,cAAc,CAACG,kBAAkB,GACtC,IAAI,CAACvB,WAAW,CAACwB,iBAAiB;QACtC,IAAIH,IAAI,EAAE;UACR,IAAI,IAAI,CAACD,cAAc,EACrB,IAAI,CAACA,cAAc,CAACtY,SAAS,CAACK,MAAM,CAAC,OAAO,CAAC;UAC/CkY,IAAI,CAACvY,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;UAC3B,IAAI,CAACqY,cAAc,GAAGC,IAAI,CAAC,CAAC;UAC5B,IAAI,CAACD,cAAc,CAACnK,cAAc,CAAC;YACjCC,QAAQ,EAAE,QAAQ;YAClBC,KAAK,EAAE;UACT,CAAC,CAAC,CAAC,CAAC;QACN;MACF,CAAC,MAAM,IAAI3P,KAAK,CAACC,GAAG,KAAK,SAAS,EAAE;QAClC6Z,QAAQ,GAAG,IAAI,CAACF,cAAc,GAC1B,IAAI,CAACA,cAAc,CAACK,sBAAsB,GAC1C,IAAI,CAACzB,WAAW,CAAC0B,gBAAgB;QACrC,IAAIJ,QAAQ,EAAE;UACZ,IAAI,IAAI,CAACF,cAAc,EACrB,IAAI,CAACA,cAAc,CAACtY,SAAS,CAACK,MAAM,CAAC,OAAO,CAAC;UAC/CmY,QAAQ,CAACxY,SAAS,CAACC,GAAG,CAAC,OAAO,CAAC;QACjC;QACA,IAAI,CAACqY,cAAc,GAAGE,QAAQ,CAAC,CAAC;QAChC,IAAI,CAACF,cAAc,CAACnK,cAAc,CAAC;UACjCC,QAAQ,EAAE,QAAQ;UAClBC,KAAK,EAAE;QACT,CAAC,CAAC,CAAC,CAAC;MACN;IACF,CAAC,CAAC;EACJ;EAEA4J,gBAAgBA,CAACta,OAAO,EAAE;IACxB,MAAMK,KAAK,GAAI,gBAAeL,OAAO,CAACE,EAAG,EAAC;IAC1C,MAAMgb,IAAI,GAAGlb,OAAO,CAACkb,IAAI;IACzB,MAAMva,OAAO,GAAGX,OAAO,CAACW,OAAO;IAC/B;IACA,MAAMF,QAAQ,GAAGF,QAAQ,CAACG,cAAc,CAAC,uBAAuB,CAAC;IACjE,MAAMya,YAAY,GAAG1a,QAAQ,CAACE,OAAO,CAACsB,SAAS,CAAC,IAAI,CAAC;IACrD;IACA,MAAMmZ,UAAU,GAAGD,YAAY,CAAChZ,aAAa,CAAC,eAAe,CAAC;IAC9D,MAAMkZ,QAAQ,GAAGF,YAAY,CAAChZ,aAAa,CAAC,oBAAoB,CAAC;IACjE,MAAMmZ,YAAY,GAAGH,YAAY,CAAChZ,aAAa,CAC7C,6BACF,CAAC;IACD,MAAMoZ,UAAU,GAAGJ,YAAY,CAAChZ,aAAa,CAC3C,wCACF,CAAC;IACD,MAAMqZ,UAAU,GAAGL,YAAY,CAAChZ,aAAa,CAAC,2BAA2B,CAAC;IAC1E,MAAMsZ,SAAS,GAAGN,YAAY,CAAChZ,aAAa,CAAC,0BAA0B,CAAC;IACxE,MAAMuZ,UAAU,GAAGP,YAAY,CAAChZ,aAAa,CAAC,2BAA2B,CAAC;IAE1E,IAAInC,OAAO,CAAC2b,OAAO,IAAI,KAAK,EAAE;MAC5BF,SAAS,CAACpZ,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;IACrC,CAAC,MAAM,IAAItC,OAAO,CAAC2b,OAAO,IAAI,MAAM,EAAE;MACpCH,UAAU,CAACnZ,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;IACtC,CAAC,MAAM,IAAItC,OAAO,CAAC2b,OAAO,IAAI,SAAS,EAAE;MACvCD,UAAU,CAACrZ,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;IACtC;;IAEA;IACA8Y,UAAU,CAAC/Y,SAAS,CAACC,GAAG,CAAE,GAAE4Y,IAAK,eAAc,CAAC;IAChDE,UAAU,CAAClb,EAAE,GAAGG,KAAK;IACrBgb,QAAQ,CAACjZ,WAAW,GAAGzB,OAAO;IAC9Bya,UAAU,CAACQ,UAAU,GAAG,KAAK;;IAE7B;IACA,IAAI,CAACrC,WAAW,CAAC9W,WAAW,CAAC2Y,UAAU,CAAC;IACxCA,UAAU,CAACS,OAAO,CAAC,IAAI,CAAC,GAAG7b,OAAO,CAACE,EAAE;IACrC,IAAI4Y,oBAAS,CAACsC,UAAU,CAAC;IACzBE,YAAY,CAACxa,gBAAgB,CAAC,OAAO,EAAE,YAAY;MACjD,MAAMiK,4BAAa,CAACI,iBAAiB,CAACnL,OAAO,CAACE,EAAE,CAAC;MACjDkb,UAAU,CAAC1Y,MAAM,CAAC,CAAC;IACrB,CAAC,CAAC;IACF6Y,UAAU,CAACM,OAAO,CAAC,QAAQ,CAAC,GAAGxb,KAAK;IACpCqb,UAAU,CAAC5a,gBAAgB,CAAC,OAAO,EAAE,YAAY;MAC/CQ,OAAO,CAAC6D,GAAG,CAAC,SAAS,CAAC;MACtBnF,OAAO,CAAC2b,OAAO,GAAG,SAAS;MAC3B,MAAM3b,OAAO,CAAC0J,IAAI,CAAC,CAAC;IACtB,CAAC,CAAC;IACF8R,UAAU,CAAC1a,gBAAgB,CAAC,OAAO,EAAE,YAAY;MAC/CQ,OAAO,CAAC6D,GAAG,CAAC,MAAM,CAAC;MACnBnF,OAAO,CAAC2b,OAAO,GAAG,MAAM;MACxB,MAAM3b,OAAO,CAAC0J,IAAI,CAAC,CAAC;IACtB,CAAC,CAAC;IACF+R,SAAS,CAAC3a,gBAAgB,CAAC,OAAO,EAAE,YAAY;MAC9CQ,OAAO,CAAC6D,GAAG,CAAC,KAAK,CAAC;MAClBnF,OAAO,CAAC2b,OAAO,GAAG,KAAK;MACvB,MAAM3b,OAAO,CAAC0J,IAAI,CAAC,CAAC;IACtB,CAAC,CAAC;IACF,OAAO;MAAEjE,OAAO,EAAE2V,UAAU;MAAEU,WAAW,EAAET;IAAS,CAAC;EACvD;EAEA3N,iBAAiBA,CAAC/C,IAAI,EAAE;IACtB,IAAIA,IAAI,CAACzK,EAAE,KAAK,IAAI,CAACyK,IAAI,EAAEzK,EAAE,EAAE;MAC7B,IAAI,CAACyK,IAAI,GAAG,IAAI;IAClB,CAAC,MAAM;MACL,IAAI,CAACA,IAAI,GAAGA,IAAI;IAClB;IACA,IAAI,CAACoB,MAAM,CAAC,CAAC;EACf;EAEA8B,kBAAkBA,CAAClD,IAAI,EAAE;IACvB,IAAI,CAACA,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACoB,MAAM,CAAC,CAAC;EACf;EAEA0O,cAAcA,CAAA,EAAG;IACf,IAAI,CAACpO,SAAS,CAACuE,KAAK,CAAC,CAAC;IACtB7P,KAAK,CAACgb,eAAe,CAAC,CAAC;EACzB;EAEA,MAAMrB,gBAAgBA,CAAA,EAAG;IACvB,MAAM/P,IAAI,GAAG,MAAMI,4BAAa,CAACO,cAAc,CAAC,CAAC;IACjD,IAAIX,IAAI,EAAE;MACR,MAAMI,4BAAa,CAACM,UAAU,CAACV,IAAI,CAAC;IACtC;EACF;EAEA6P,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACjB,WAAW,CAACyC,SAAS,GAAG,CAAC;EAChC;EAEAzB,WAAWA,CAAA,EAAG;IACZ,IAAI,CAAChB,WAAW,CAACyC,SAAS,GAAG,IAAI,CAACzC,WAAW,CAAC0C,YAAY;EAC5D;AACF;AAACtZ,OAAA,CAAAoX,QAAA,GAAAA,QAAA;;;;;;;;AC/LD,IAAAhC,eAAA,GAAA3O,OAAA;AACA,IAAA0B,SAAA,GAAA1B,OAAA;AACA,IAAAwB,MAAA,GAAAxB,OAAA;AACA,IAAA8S,IAAA,GAAA9S,OAAA;AACA,IAAA+S,QAAA,GAAA/S,OAAA;AACA,IAAAqC,cAAA,GAAArC,OAAA;AACA,IAAAgT,WAAA,GAAAhT,OAAA;AACA,IAAA8N,UAAA,GAAA9N,OAAA;AACA,IAAAiT,eAAA,GAAAjT,OAAA;AACA,IAAAkT,aAAA,GAAAlT,OAAA;AACA,IAAAmT,eAAA,GAAAnT,OAAA;AACA,IAAAoT,mBAAA,GAAApT,OAAA;AAEA,IAAAqT,SAAA,GAAArT,OAAA;AADA;;AAGA;AACO,MAAMsT,GAAG,CAAC;EACf,OAAOC,GAAGA,CAAA,EAAG;IACX7c,8BAAc,CAACsB,UAAU,CAAC,CAAC;IAC3B,MAAMwb,GAAG,GAAG,IAAIF,GAAG,CAAC,CAAC;IACrB,OAAOE,GAAG;EACZ;EAEA7c,WAAWA,CAAA,EAAG;IACZ,IAAI,CAAC8c,OAAO,GAAG,IAAIpN,gBAAO,CAAC,CAAC;IAC5B,IAAI,CAACqN,QAAQ,GAAG,IAAI/C,kBAAQ,CAAC,CAAC;IAC9B,IAAI,CAACgD,SAAS,GAAG,IAAI1K,oBAAS,CAAC,CAAC;IAChC,IAAI,CAAC2K,cAAc,GAAG,IAAI/E,8BAAc,CAAC,CAAC;IAC1C,IAAI,CAACgF,kBAAkB,GAAG,IAAIrE,sCAAkB,CAAC,CAAC;IAClD,IAAI,CAACsE,cAAc,GAAG,IAAI3H,8BAAc,CAAC,CAAC;IAC1C,IAAI,CAACgG,UAAU,GAAG,IAAI5J,sBAAU,CAAC,CAAC;IAClC,IAAI,CAACuE,YAAY,GAAG,IAAIN,0BAAY,CAAC,CAAC;IACtC,IAAI,CAACuH,kBAAkB,CAAC,CAAC;IACzB,IAAI,CAACrR,kBAAkB,CAAC,CAAC;IACzB,IAAI,CAACsR,iBAAiB,CAAC,CAAC;IACxB,IAAI,CAACrR,MAAM,CAAC,CAAC;EACf;EAEAoR,kBAAkBA,CAAA,EAAG;IACnB;IACA,IAAI,CAACzD,WAAW,GAAGnZ,QAAQ,CAACG,cAAc,CAAC,cAAc,CAAC;IAC1D,IAAI,CAAC8Y,YAAY,GAAGjZ,QAAQ,CAACG,cAAc,CAAC,eAAe,CAAC;IAC5D,IAAI,CAAC6Y,WAAW,GAAGhZ,QAAQ,CAACG,cAAc,CAAC,cAAc,CAAC;EAC5D;EAEA0c,iBAAiBA,CAAA,EAAG;IAClB,MAAMC,GAAG,GAAI;AACjB,eAAeza,kBAAQ,CAACoB,QAAQ,CAAC,CAAE;AACnC,eAAepB,kBAAQ,CAACa,MAAM,CAAC,CAAE;AACjC,eAAeb,kBAAQ,CAAC6B,gBAAgB,CAAC,CAAE;AAC3C,eAAetE,IAAI,CAACC,SAAS,CAACwC,kBAAQ,CAAC0B,kBAAkB,CAAC,CAAC,CAAE;AAC7D,CAAC;IACGhD,OAAO,CAAC6D,GAAG,CAACkY,GAAG,CAAC;EAClB;EAEAtR,MAAMA,CAAA,EAAG;IACP,IAAI,CAAC8Q,OAAO,CAAC9Q,MAAM,CAAC,CAAC;IACrB,IAAI,CAAC+Q,QAAQ,CAAC/Q,MAAM,CAAC,CAAC;EACxB;EAEAD,kBAAkBA,CAAA,EAAG;IACnBlH,YAAK,CAACC,MAAM,CAAC,cAAc,EAAE,IAAI,CAACgJ,kBAAkB,CAAC;IACrD;IACA,IAAI,CAAC6L,WAAW,CAAC5Y,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACwc,WAAW,CAACrR,IAAI,CAAC,IAAI,CAAC,CAAC;IACvE,IAAI,CAACuN,YAAY,CAAC1Y,gBAAgB,CAChC,UAAU,EACV,IAAI,CAACyc,cAAc,CAACtR,IAAI,CAAC,IAAI,CAC/B,CAAC;EACH;EAEA4B,kBAAkB,GAAIlD,IAAI,IAAK;IAC7B9J,MAAM,CAAC2c,OAAO,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,EAAG,UAAS9S,IAAI,CAACzK,EAAG,EAAC,CAAC;EACvD,CAAC;EAEDod,WAAW,GAAGA,CAAA,KAAM;IAClB,IAAI,CAACP,SAAS,CAAC3I,KAAK,CAAC,CAAC;IACtB,IAAI,CAACsJ,UAAU,CAAC,CAAC;IACjBpc,OAAO,CAAC6D,GAAG,CAAC,iBAAiB,CAAC;EAChC,CAAC;EAEDoY,cAAc,GAAIxc,KAAK,IAAK;IAC1B,IAAIA,KAAK,CAACC,GAAG,KAAK,OAAO,IAAI,CAACD,KAAK,CAAC4c,QAAQ,EAAE;MAC5C,IAAI,CAACC,WAAW,CAAC,CAAC;IACpB;EACF,CAAC;EAEDF,UAAUA,CAAA,EAAG;IACXnY,QAAG,CAACG,WAAW,CAAC,IAAI,CAACgU,WAAW,CAAC,CAAC/T,WAAW,CAAC,IAAI,CAAC6T,YAAY,CAAC;IAChE,IAAI,CAACA,YAAY,CAAC5I,KAAK,CAAC,CAAC;EAC3B;EAEAiN,WAAWA,CAAA,EAAG;IACZtY,QAAG,CAACC,WAAW,CAAC,IAAI,CAACkU,WAAW,CAAC,CAAC7T,YAAY,CAAC,IAAI,CAAC2T,YAAY,CAAC;EACnE;;EAEA;EACA,MAAMoE,WAAWA,CAAA,EAAG;IAClB,MAAME,UAAU,GAAG,IAAI,CAACtE,YAAY,CAAC1W,KAAK,CAACmO,IAAI,CAAC,CAAC;IACjD;IACA,IAAItG,IAAI,GAAG,MAAMI,4BAAa,CAACO,cAAc,CAAC,CAAC;IAC/C,MAAMvH,GAAG,GAAGnB,kBAAQ,CAACa,MAAM,CAAC,WAAW,CAAC;IACxC,IAAI,CAACM,GAAG,EAAE;MACRjE,8BAAc,CAACoB,IAAI,CACjB,qDACF,CAAC;MACD,OAAO,IAAI;IACb;IACA,IAAI4c,UAAU,EAAE;MACd;MACA,IAAI,CAACtE,YAAY,CAAC1W,KAAK,GAAG,EAAE;MAC5B;MACA,IAAI,CAAC6H,IAAI,EAAE;QACTA,IAAI,GAAG,MAAMI,4BAAa,CAACE,UAAU,CAAC;UACpCC,KAAK,EAAE,UAAU;UACjBhH,KAAK,EAAEtB,kBAAQ,CAACoB,QAAQ,CAAC;QAC3B,CAAC,CAAC;MACJ;MACA;MACA,MAAM+Z,WAAW,GAAG,MAAMpT,IAAI,CAACF,UAAU,CAAC;QACxCyQ,IAAI,EAAE,MAAM;QACZva,OAAO,EAAEmd;MACX,CAAC,CAAC;MACF,MAAME,aAAa,GAAG,MAAMrT,IAAI,CAACF,UAAU,CAAC;QAC1CyQ,IAAI,EAAE,WAAW;QACjBva,OAAO,EAAE;MACX,CAAC,CAAC;MACF,MAAM0D,YAAY,GAAGzB,kBAAQ,CAACuB,eAAe,CAAC,CAAC;MAC/C,MAAMK,eAAe,GAAG5B,kBAAQ,CAAC0B,kBAAkB,CAAC,CAAC;MACrD;MACA,IAAI,CAACuZ,WAAW,CAAC,CAAC;MAClB;MACA,IAAI,CAACI,iBAAiB,CAACF,WAAW,CAAC;MACnC;MACA,MAAMG,eAAe,GAAG,IAAI,CAACD,iBAAiB,CAACD,aAAa,CAAC;MAC7D,MAAMG,cAAc,GAAG;QACrBxT,IAAI;QACJoT,WAAW;QACXC,aAAa;QACbE;MACF,CAAC;MACD,MAAME,WAAW,GAAG;QAClBC,MAAM,EAAEN,WAAW;QACnB7Z,KAAK,EAAEyG,IAAI,CAACzG,KAAK;QACjBgG,QAAQ,EAAE,CAAC,MAAMS,IAAI,CAACD,WAAW,CAAC,CAAC,EAAEZ,GAAG,CAAE9J,OAAO,KAAM;UACrDkb,IAAI,EAAElb,OAAO,CAACkb,IAAI;UAClBva,OAAO,EAAEX,OAAO,CAACW;QACnB,CAAC,CAAC;MACJ,CAAC;MACD;MACA,IAAI0D,YAAY,EAAE;QAChB+Z,WAAW,CAACE,MAAM,GAAGja,YAAY;MACnC;MACA;MACA,IAAIG,eAAe,EAAE;QACnB4Z,WAAW,CAACG,OAAO,GAAG/Z,eAAe;MACvC;MACA;MACA0Z,eAAe,CAACpC,WAAW,CAAC1O,SAAS,GAAG,6BAA6B;MACrE;MACA,IAAI,CAAC2P,SAAS,CAACxK,IAAI,CACjBxO,GAAG,EACHqa,WAAW,EACX,CAACnX,OAAO,EAAE0L,QAAQ,KAChB,IAAI,CAACE,cAAc,CAAC5L,OAAO,EAAE0L,QAAQ,EAAEwL,cAAc,CAAC,EACxD,CAAClX,OAAO,EAAE1F,KAAK,KAAK,IAAI,CAACid,mBAAmB,CAACvX,OAAO,EAAE1F,KAAK,CAAC,EAC5D,CAAC0F,OAAO,EAAE0L,QAAQ,KAChB,IAAI,CAAC8L,UAAU,CAACxX,OAAO,EAAE0L,QAAQ,EAAEwL,cAAc,CACrD,CAAC;IACH;EACF;EAEAF,iBAAiBA,CAACje,OAAO,EAAE;IACzB,OAAO,IAAI,CAAC8c,QAAQ,CAACxC,gBAAgB,CAACta,OAAO,CAAC;EAChD;EAEA6S,cAAcA,CAAC5L,OAAO,EAAE0L,QAAQ,EAAE/J,OAAO,EAAE;IACzC,MAAMsV,eAAe,GAAGtV,OAAO,CAACsV,eAAe;IAC/C,MAAMQ,gBAAgB,GAAG,IAAI,CAACC,eAAe,CAAChM,QAAQ,CAAC;IACvD;IACA/J,OAAO,CAACoV,aAAa,CAACrd,OAAO,IAAI+d,gBAAgB;IACjDR,eAAe,CAACpC,WAAW,CAAC1Z,WAAW,IAAIsc,gBAAgB;IAC3D,IAAI,CAAC5B,QAAQ,CAACvC,WAAW,CAAC,CAAC;EAC7B;EAEAiE,mBAAmBA,CAACvX,OAAO,EAAE1F,KAAK,EAAE;IAClC;IACA,IAAIA,KAAK,CAACqI,IAAI,KAAK,YAAY,EAAE;MAC/BtI,OAAO,CAACC,KAAK,CAAE,UAASA,KAAK,CAACvB,OAAQ,EAAC,CAAC;IAC1C;IACA,IAAI,CAAC8c,QAAQ,CAACvC,WAAW,CAAC,CAAC;IAC3B,IAAI,CAACmD,UAAU,CAAC,CAAC;EACnB;EAEA,MAAMe,UAAUA,CAACxX,OAAO,EAAE0L,QAAQ,EAAE/J,OAAO,EAAE;IAC3C,MAAM+B,IAAI,GAAG/B,OAAO,CAAC+B,IAAI;IACzBrJ,OAAO,CAAC6D,GAAG,CAAE,QAAOwF,IAAI,CAACzK,EAAG,OAAM,CAAC;IACnC,MAAM0I,OAAO,CAACoV,aAAa,CAACtU,IAAI,CAAC,CAAC;IAClC,IAAI,CAACgU,UAAU,CAAC,CAAC;EACnB;EAEAiB,eAAe,GAAIhe,OAAO,IAAK;IAC7B;IACA,OAAOA,OAAO;EAChB,CAAC;EAEDie,UAAU,GAAGA,CAAA,KAAM;IACjB,OAAO,IAAIhb,GAAG,CAAC/C,MAAM,CAACge,QAAQ,CAAChb,IAAI,CAAC,CAACib,QAAQ,CAAC/K,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;EAChE,CAAC;AACH;AAACrR,OAAA,CAAA+Z,GAAA,GAAAA,GAAA;;;;AChND,IAAAqC,IAAA,GAAA3V,OAAA;AACA,IAAAyB,KAAA,GAAAzB,OAAA;AACA,IAAAmB,YAAA,GAAAnB,OAAA;AAEA;AACA,eAAehI,UAAUA,CAAA,EAAG;EAC1B,MAAMoJ,UAAI,CAACpJ,UAAU,CAAC,CAAC;EACvB,MAAMiJ,wBAAW,CAACjJ,UAAU,CAAC,CAAC;AAChC;AAEAA,UAAU,CAAC,CAAC,CAACoM,IAAI,CAAC,MAAM;EACtBkP,QAAG,CAACC,GAAG,CAAC,CAAC;AACX,CAAC,CAAC;;;ACZF,IAAIqC,UAAU,GAAG,4BAA4B;AAE7C,IAAIC,SAAS,GAAGC,MAAM,CAACC,MAAM,CAACC,MAAM;AAEpC,SAASA,MAAMA,CAACC,UAAU,EAAE;EAC1BJ,SAAS,CAACK,IAAI,CAAC,IAAI,EAAED,UAAU,CAAC;EAChC,IAAI,CAACE,GAAG,GAAG;IACTra,IAAI,EAAEga,MAAM,CAACC,MAAM,CAACK,OAAO;IAC3BC,gBAAgB,EAAE,EAAE;IACpBC,iBAAiB,EAAE,EAAE;IACrBC,MAAM,EAAE,SAAAA,CAAUC,EAAE,EAAE;MACpB,IAAI,CAACH,gBAAgB,CAACI,IAAI,CAACD,EAAE,IAAI,YAAY,CAAC,CAAC,CAAC;IAClD,CAAC;IACDE,OAAO,EAAE,SAAAA,CAAUF,EAAE,EAAE;MACrB,IAAI,CAACF,iBAAiB,CAACG,IAAI,CAACD,EAAE,CAAC;IACjC;EACF,CAAC;EAEDV,MAAM,CAACC,MAAM,CAACK,OAAO,GAAG,IAAI;AAC9B;AAEAN,MAAM,CAACC,MAAM,CAACC,MAAM,GAAGA,MAAM;AAC7B,IAAIW,aAAa,EAAEC,cAAc;AAEjC,IAAIC,MAAM,GAAGf,MAAM,CAACC,MAAM,CAACc,MAAM;AACjC,IAAI,CAAC,CAACA,MAAM,IAAI,CAACA,MAAM,CAACC,eAAe,KAAK,OAAOC,SAAS,KAAK,WAAW,EAAE;EAC5E,IAAIC,QAAQ,GAAG,MAA4BvB,QAAQ,CAACuB,QAAQ;EAC5D,IAAIC,QAAQ,GAAGxB,QAAQ,CAACwB,QAAQ,KAAK,QAAQ,GAAG,KAAK,GAAG,IAAI;EAC5D,IAAIC,EAAE,GAAG,IAAIH,SAAS,CAACE,QAAQ,GAAG,KAAK,GAAGD,QAAQ,GAAG,GAAG,UAAuB,GAAG,GAAG,CAAC;EACtFE,EAAE,CAACC,SAAS,GAAG,UAASxf,KAAK,EAAE;IAC7Bgf,aAAa,GAAG,CAAC,CAAC;IAClBC,cAAc,GAAG,EAAE;IAEnB,IAAI9a,IAAI,GAAG/E,IAAI,CAACoD,KAAK,CAACxC,KAAK,CAACmE,IAAI,CAAC;IAEjC,IAAIA,IAAI,CAACjF,IAAI,KAAK,QAAQ,EAAE;MAC1B,IAAIugB,OAAO,GAAG,KAAK;MACnBtb,IAAI,CAACub,MAAM,CAAC7T,OAAO,CAAC,UAAS8T,KAAK,EAAE;QAClC,IAAI,CAACA,KAAK,CAACC,KAAK,EAAE;UAChB,IAAIC,SAAS,GAAGC,cAAc,CAACC,MAAM,CAACC,aAAa,EAAEL,KAAK,CAACxgB,EAAE,CAAC;UAC9D,IAAI0gB,SAAS,EAAE;YACbJ,OAAO,GAAG,IAAI;UAChB;QACF;MACF,CAAC,CAAC;;MAEF;MACAA,OAAO,GAAGA,OAAO,IAAItb,IAAI,CAACub,MAAM,CAACO,KAAK,CAAC,UAASN,KAAK,EAAE;QACrD,OAAOA,KAAK,CAACzgB,IAAI,KAAK,KAAK,IAAIygB,KAAK,CAACO,SAAS,CAACC,EAAE;MACnD,CAAC,CAAC;MAEF,IAAIV,OAAO,EAAE;QACXlf,OAAO,CAACgH,KAAK,CAAC,CAAC;QAEfpD,IAAI,CAACub,MAAM,CAAC7T,OAAO,CAAC,UAAU8T,KAAK,EAAE;UACnCS,QAAQ,CAACL,MAAM,CAACC,aAAa,EAAEL,KAAK,CAAC;QACvC,CAAC,CAAC;QAEFV,cAAc,CAACpT,OAAO,CAAC,UAAUwU,CAAC,EAAE;UAClCC,YAAY,CAACD,CAAC,CAAC,CAAC,CAAC,EAAEA,CAAC,CAAC,CAAC,CAAC,CAAC;QAC1B,CAAC,CAAC;MACJ,CAAC,MAAM,IAAIvC,QAAQ,CAACyC,MAAM,EAAE;QAAE;QAC5BzC,QAAQ,CAACyC,MAAM,CAAC,CAAC;MACnB;IACF;IAEA,IAAIpc,IAAI,CAACjF,IAAI,KAAK,QAAQ,EAAE;MAC1BqgB,EAAE,CAACiB,KAAK,CAAC,CAAC;MACVjB,EAAE,CAACkB,OAAO,GAAG,YAAY;QACvB3C,QAAQ,CAACyC,MAAM,CAAC,CAAC;MACnB,CAAC;IACH;IAEA,IAAIpc,IAAI,CAACjF,IAAI,KAAK,gBAAgB,EAAE;MAClCqB,OAAO,CAAC6D,GAAG,CAAC,2BAA2B,CAAC;MAExCsc,kBAAkB,CAAC,CAAC;IACtB;IAEA,IAAIvc,IAAI,CAACjF,IAAI,KAAK,OAAO,EAAE;MACzBqB,OAAO,CAACC,KAAK,CAAC,eAAe,GAAG2D,IAAI,CAAC3D,KAAK,CAACvB,OAAO,GAAG,IAAI,GAAGkF,IAAI,CAAC3D,KAAK,CAACmgB,KAAK,CAAC;MAE7ED,kBAAkB,CAAC,CAAC;MAEpB,IAAIE,OAAO,GAAGC,kBAAkB,CAAC1c,IAAI,CAAC;MACtC3E,QAAQ,CAACC,IAAI,CAACiC,WAAW,CAACkf,OAAO,CAAC;IACpC;EACF,CAAC;AACH;AAEA,SAASF,kBAAkBA,CAAA,EAAG;EAC5B,IAAIE,OAAO,GAAGphB,QAAQ,CAACG,cAAc,CAACse,UAAU,CAAC;EACjD,IAAI2C,OAAO,EAAE;IACXA,OAAO,CAACjf,MAAM,CAAC,CAAC;EAClB;AACF;AAEA,SAASkf,kBAAkBA,CAAC1c,IAAI,EAAE;EAChC,IAAIyc,OAAO,GAAGphB,QAAQ,CAACwO,aAAa,CAAC,KAAK,CAAC;EAC3C4S,OAAO,CAACzhB,EAAE,GAAG8e,UAAU;;EAEvB;EACA,IAAIhf,OAAO,GAAGO,QAAQ,CAACwO,aAAa,CAAC,KAAK,CAAC;EAC3C,IAAI8S,UAAU,GAAGthB,QAAQ,CAACwO,aAAa,CAAC,KAAK,CAAC;EAC9C/O,OAAO,CAAC+R,SAAS,GAAG7M,IAAI,CAAC3D,KAAK,CAACvB,OAAO;EACtC6hB,UAAU,CAAC9P,SAAS,GAAG7M,IAAI,CAAC3D,KAAK,CAACmgB,KAAK;EAEvCC,OAAO,CAACvU,SAAS,GACf,wNAAwN,GACtN,mFAAmF,GACnF,yEAAyE,GACzE,qEAAqE,GAAGpN,OAAO,CAACoN,SAAS,GAAG,QAAQ,GACpG,OAAO,GAAGyU,UAAU,CAACzU,SAAS,GAAG,QAAQ,GAC3C,QACD;EAED,OAAOuU,OAAO;AAEhB;AAEA,SAASG,UAAUA,CAAC3C,MAAM,EAAEjf,EAAE,EAAE;EAC9B,IAAI6hB,OAAO,GAAG5C,MAAM,CAAC4C,OAAO;EAC5B,IAAI,CAACA,OAAO,EAAE;IACZ,OAAO,EAAE;EACX;EAEA,IAAIC,OAAO,GAAG,EAAE;EAChB,IAAIC,CAAC,EAAEC,CAAC,EAAEC,GAAG;EAEb,KAAKF,CAAC,IAAIF,OAAO,EAAE;IACjB,KAAKG,CAAC,IAAIH,OAAO,CAACE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;MACvBE,GAAG,GAAGJ,OAAO,CAACE,CAAC,CAAC,CAAC,CAAC,CAAC,CAACC,CAAC,CAAC;MACtB,IAAIC,GAAG,KAAKjiB,EAAE,IAAKyB,KAAK,CAACygB,OAAO,CAACD,GAAG,CAAC,IAAIA,GAAG,CAACA,GAAG,CAACxiB,MAAM,GAAG,CAAC,CAAC,KAAKO,EAAG,EAAE;QACpE8hB,OAAO,CAACnC,IAAI,CAACoC,CAAC,CAAC;MACjB;IACF;EACF;EAEA,IAAI9C,MAAM,CAACc,MAAM,EAAE;IACjB+B,OAAO,GAAGA,OAAO,CAACK,MAAM,CAACP,UAAU,CAAC3C,MAAM,CAACc,MAAM,EAAE/f,EAAE,CAAC,CAAC;EACzD;EAEA,OAAO8hB,OAAO;AAChB;AAEA,SAASb,QAAQA,CAAChC,MAAM,EAAEuB,KAAK,EAAE;EAC/B,IAAIqB,OAAO,GAAG5C,MAAM,CAAC4C,OAAO;EAC5B,IAAI,CAACA,OAAO,EAAE;IACZ;EACF;EAEA,IAAIA,OAAO,CAACrB,KAAK,CAACxgB,EAAE,CAAC,IAAI,CAACif,MAAM,CAACc,MAAM,EAAE;IACvC,IAAIL,EAAE,GAAG,IAAI0C,QAAQ,CAAC,SAAS,EAAE,QAAQ,EAAE,SAAS,EAAE5B,KAAK,CAACO,SAAS,CAACC,EAAE,CAAC;IACzER,KAAK,CAACC,KAAK,GAAG,CAACoB,OAAO,CAACrB,KAAK,CAACxgB,EAAE,CAAC;IAChC6hB,OAAO,CAACrB,KAAK,CAACxgB,EAAE,CAAC,GAAG,CAAC0f,EAAE,EAAEc,KAAK,CAAC6B,IAAI,CAAC;EACtC,CAAC,MAAM,IAAIpD,MAAM,CAACc,MAAM,EAAE;IACxBkB,QAAQ,CAAChC,MAAM,CAACc,MAAM,EAAES,KAAK,CAAC;EAChC;AACF;AAEA,SAASG,cAAcA,CAAC1B,MAAM,EAAEjf,EAAE,EAAE;EAClC,IAAI6hB,OAAO,GAAG5C,MAAM,CAAC4C,OAAO;EAC5B,IAAI,CAACA,OAAO,EAAE;IACZ;EACF;EAEA,IAAI,CAACA,OAAO,CAAC7hB,EAAE,CAAC,IAAIif,MAAM,CAACc,MAAM,EAAE;IACjC,OAAOY,cAAc,CAAC1B,MAAM,CAACc,MAAM,EAAE/f,EAAE,CAAC;EAC1C;EAEA,IAAI6f,aAAa,CAAC7f,EAAE,CAAC,EAAE;IACrB;EACF;EACA6f,aAAa,CAAC7f,EAAE,CAAC,GAAG,IAAI;EAExB,IAAIsiB,MAAM,GAAGrD,MAAM,CAACsD,KAAK,CAACviB,EAAE,CAAC;EAE7B8f,cAAc,CAACH,IAAI,CAAC,CAACV,MAAM,EAAEjf,EAAE,CAAC,CAAC;EAEjC,IAAIsiB,MAAM,IAAIA,MAAM,CAACjD,GAAG,IAAIiD,MAAM,CAACjD,GAAG,CAACE,gBAAgB,CAAC9f,MAAM,EAAE;IAC9D,OAAO,IAAI;EACb;EAEA,OAAOmiB,UAAU,CAAChB,MAAM,CAACC,aAAa,EAAE7gB,EAAE,CAAC,CAACwiB,IAAI,CAAC,UAAUxiB,EAAE,EAAE;IAC7D,OAAO2gB,cAAc,CAACC,MAAM,CAACC,aAAa,EAAE7gB,EAAE,CAAC;EACjD,CAAC,CAAC;AACJ;AAEA,SAASmhB,YAAYA,CAAClC,MAAM,EAAEjf,EAAE,EAAE;EAChC,IAAIsiB,MAAM,GAAGrD,MAAM,CAACsD,KAAK,CAACviB,EAAE,CAAC;EAC7Bif,MAAM,CAACK,OAAO,GAAG,CAAC,CAAC;EACnB,IAAIgD,MAAM,EAAE;IACVA,MAAM,CAACjD,GAAG,CAACra,IAAI,GAAGia,MAAM,CAACK,OAAO;EAClC;EAEA,IAAIgD,MAAM,IAAIA,MAAM,CAACjD,GAAG,IAAIiD,MAAM,CAACjD,GAAG,CAACG,iBAAiB,CAAC/f,MAAM,EAAE;IAC/D6iB,MAAM,CAACjD,GAAG,CAACG,iBAAiB,CAAC9S,OAAO,CAAC,UAAU+V,EAAE,EAAE;MACjDA,EAAE,CAACxD,MAAM,CAACK,OAAO,CAAC;IACpB,CAAC,CAAC;EACJ;EAEA,OAAOL,MAAM,CAACsD,KAAK,CAACviB,EAAE,CAAC;EACvBif,MAAM,CAACjf,EAAE,CAAC;EAEVsiB,MAAM,GAAGrD,MAAM,CAACsD,KAAK,CAACviB,EAAE,CAAC;EACzB,IAAIsiB,MAAM,IAAIA,MAAM,CAACjD,GAAG,IAAIiD,MAAM,CAACjD,GAAG,CAACE,gBAAgB,CAAC9f,MAAM,EAAE;IAC9D6iB,MAAM,CAACjD,GAAG,CAACE,gBAAgB,CAAC7S,OAAO,CAAC,UAAU+V,EAAE,EAAE;MAChDA,EAAE,CAAC,CAAC;IACN,CAAC,CAAC;IACF,OAAO,IAAI;EACb;AACF","file":"script.d573be0b.js","sourceRoot":"..","sourcesContent":["function simpleHash(str) {\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return hash;\n}\n\n// Show all uncaught errors as UI notifications\n/*\nwindow.onerror = function (message, source, lineno, colno, error) {\n  const errorDetails = `${message} at ${source}:${lineno}:${colno}`;\n  UINotification.show(errorDetails, 'error');\n  return true;\n};\n*/\n\nexport class UINotification {\n  constructor(message, type) {\n    const id = simpleHash(JSON.stringify(message));\n    this.type = type;\n    this.domId = `notification-${id}`;\n    this.container = document.body;\n    this.template = document.getElementById('notification-template').content;\n    this._bindEventListeners();\n  }\n\n  _bindEventListeners() {\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  static show(message, type) {\n    const notification = new UINotification(message, type);\n    notification.show(message);\n  }\n\n  static initialize() {\n    // Store the original console.error function\n    const originalConsoleError = console.error;\n\n    // Override console.error\n    console.error = function (...args) {\n      UINotification.show(args);\n      // Call the original console.error with all arguments\n      originalConsoleError.apply(console, args);\n    };\n  }\n\n  static handleApplicationError(error) {\n    console.debug('caught error');\n    console.error(error);\n    UINotification.show(error);\n  }\n\n  show(message) {\n    // Clone the template\n    const clone = this.template.cloneNode(true);\n\n    // Find the root element of the notification in the clone\n    const notificationElement = clone.querySelector('.notification');\n    if (!notificationElement) {\n      console.error('Notification root element not found in template');\n      return;\n    }\n\n    // Set the message\n    clone.querySelector('.notification-message').textContent = message;\n\n    notificationElement.id = this.domId; // Set ID on the actual element, not the fragment\n    // Add type, for example, error\n    if (this.type) {\n      notificationElement.classList.add(`notification-${this.type}`);\n    }\n\n    // Add close functionality\n    const closeButton = clone.querySelector('.close-notification-button');\n    closeButton.onclick = () => this.hide();\n\n    // Don't show the same notification twice\n    if (!document.getElementById(this.domId)) {\n      // Append to the container and display\n      this.container.appendChild(clone);\n    }\n  }\n\n  hide() {\n    document.getElementById(this.domId)?.remove();\n  }\n}\n","export class Settings {\n  // Static method to set a value in localStorage\n  static set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Static method to get a value from localStorage\n  static get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Static method to remove a value from localStorage\n  static remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n\n  static getUrl(uri) {\n    try {\n      const baseUrl = Settings.get('url');\n      if (uri) {\n        return new URL(uri, baseUrl).href;\n      } else {\n        return baseUrl;\n      }\n    } catch (error) {\n      return null;\n    }\n  }\n\n  static setUrl(url) {\n    Settings.set('url', url);\n  }\n\n  static getModel() {\n    return Settings.get('model');\n  }\n\n  static setModel(model) {\n    Settings.set('model', model);\n  }\n\n  static getSystemPrompt() {\n    return Settings.get('system-prompt');\n  }\n\n  static setSystemPrompt(systemPrompt) {\n    if (systemPrompt === '') {\n      systemPrompt = null;\n    }\n    Settings.set('system-prompt', systemPrompt);\n  }\n\n  static getModelParameters() {\n    return Settings.get('model-parameters');\n  }\n\n  static setModelParameters(modelParameters) {\n    if (modelParameters === '') {\n      modelParameters = null;\n    }\n    Settings.set('model-parameters', modelParameters);\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static setCurrentChatId(chatId) {\n    if (chatId === undefined) {\n      chatId = null;\n    }\n    Settings.set('currentChatId', chatId);\n  }\n}\n","export class Event {\n  static listen(eventName, handler) {\n    window.addEventListener(eventName, (event) => {\n      handler(event.detail);\n    });\n  }\n\n  static emit(eventName, data) {\n    let log = `${eventName}`;\n    if (data?.id) {\n      log += ` id: ${data.id}`;\n    }\n    console.log(log);\n    const event = new CustomEvent(eventName, {\n      detail: data || {},\n      bubbles: true, // This makes the event bubble up through the DOM\n    });\n    window.dispatchEvent(event);\n  }\n}\n","export class DOM {\n  static showElement(element) {\n    element.classList.remove('hidden');\n    return this;\n  }\n\n  static hideElement(element) {\n    element.classList.add('hidden');\n    return this;\n  }\n\n  static enableInput(element) {\n    element.removeAttribute('disabled');\n    return this;\n  }\n\n  static disableInput(element) {\n    element.setAttribute('disabled', 'disabled');\n    return this;\n  }\n}\n","export function debounce(func, wait) {\n  let timeout;\n\n  return function funcWrapper(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n","export class Database {\n  constructor(dbName, objectStores, migrations) {\n    this.dbName = dbName;\n    this.objectStores = objectStores;\n    this.dbConnection = null; // Initialized in open\n    this.migrations = migrations;\n  }\n\n  async open() {\n    if (this.dbConnection) {\n      throw new Error('Connection already open');\n    }\n\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.migrations.version);\n\n      request.onerror = (event) => reject(event.target.error);\n      request.onupgradeneeded = (event) => {\n        const db = event.target.result;\n        const transaction = event.currentTarget.transaction;\n        this.migrations.upgrade(db, transaction, event.oldVersion);\n      };\n      request.onsuccess = (event) => {\n        this.dbConnection = event.target.result;\n        resolve(this.dbConnection);\n      };\n    });\n  }\n\n  async transaction(storeName, mode) {\n    return this.dbConnection\n      .transaction([storeName], mode)\n      .objectStore(storeName);\n  }\n\n  async add(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('add', store.add(data));\n  }\n\n  async get(storeName, id) {\n    const store = await this.transaction(storeName, 'readonly');\n    return this.handleRequest('get', store.get(id));\n  }\n\n  async put(storeName, data) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('put', store.put(data));\n  }\n\n  async delete(storeName, id) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('delete', store.delete(id));\n  }\n\n  async getAll(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('getAll', store.getAll());\n  }\n\n  async clear(storeName) {\n    const store = await this.transaction(storeName, 'readwrite');\n    return this.handleRequest('deleteAll', store.clear());\n  }\n\n  handleRequest(type, request) {\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => resolve(request.result);\n\n      request.onerror = (event) => {\n        const error = `Database ${type} operation failed: ${event.target.error.message}`;\n        reject(new Error(JSON.stringify(error)));\n      };\n    });\n  }\n}\n","export class Migrations {\n  static version = 2;\n  static upgrade(database, transaction, oldVersion) {\n    console.debug(\n      `Migration needed. Old version ${oldVersion}. New version ${this.version}.`,\n    );\n    const funcName = `upgradeToVersion${this.version}`;\n    const upgradeFunc = this[funcName];\n    if (!upgradeFunc) {\n      throw new Error(`Upgrade function missing for ${funcName}`);\n    }\n    if (this.version >= oldVersion) {\n      upgradeFunc({ database, transaction });\n    }\n  }\n\n  static upgradeToVersion2(context) {\n    // Create chats\n    context.database.createObjectStore('chats', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    // Create chat_messages\n    const chatMessages = context.database.createObjectStore('chat_messages', {\n      keyPath: 'id',\n      autoIncrement: true,\n    });\n    chatMessages.createIndex('by_chat', 'chatId', { unique: false });\n  }\n}\n","import { Database } from '../Database.js';\nimport { Migrations } from '../Migrations.js';\n\nexport class BaseModel {\n  constructor(data) {\n    Object.assign(this, data);\n  }\n\n  async create() {\n    const key = await this.constructor.db.add(this.constructor.storeName, this);\n    if (!this.id) {\n      this.id = key;\n    }\n    return this;\n  }\n\n  async save() {\n    return await this.constructor.db.put(this.constructor.storeName, this);\n  }\n\n  async delete() {\n    return await this.constructor.db.delete(\n      this.constructor.storeName,\n      this.id,\n    );\n  }\n\n  jsonify() {\n    return JSON.stringify(this);\n  }\n\n  static async database(name, store) {\n    this.dbName = name;\n    this.storeName = store;\n    this.db = new Database(name, [store], Migrations);\n    await this.db.open();\n  }\n\n  static async transaction(mode) {\n    return await this.db.transaction(this.storeName, mode);\n  }\n\n  async transaction(mode) {\n    return await this.constructor.transaction(mode);\n  }\n\n  static async get(id) {\n    const data = await this.db.get(this.storeName, id);\n    return new this(data);\n  }\n\n  static async clear() {\n    return await this.db.clear(this.storeName);\n  }\n\n  // TODO: sorting and selecting only certain attributes\n  static async getAll() {\n    const records = await this.db.getAll(this.storeName);\n    return records.map((data) => new this(data));\n  }\n\n  /**\n   * Retrieves all objects associated with a given ID and index.\n   *\n   * @param {number|string} chatId - The ID of the chat.\n   * @returns {Promise<Array>} A promise that resolves to an array.\n   */\n  static async getAllByIndexAndId(indexName, id) {\n    // Open a transaction and access the messages store\n    const transaction = await this.transaction('readonly');\n\n    // Use an index to find objects with the specified id\n    const index = transaction.index(indexName);\n    const request = index.getAll(id);\n\n    return new Promise((resolve, reject) => {\n      request.onsuccess = () => {\n        // Convert the result into instances\n        const messages = request.result.map((data) => new this(data));\n        resolve(messages);\n      };\n      request.onerror = () => {\n        reject(request.error);\n      };\n    });\n  }\n\n  // Exports the whole store\n  static async export() {\n    let transaction = await this.db.transaction(this.storeName, 'readonly');\n    let store = await transaction.transaction.objectStore(this.storeName);\n    return store.getAll();\n  }\n}\n","import { BaseModel } from './BaseModel.js';\n\nexport class ChatMessage extends BaseModel {\n  static async initialize() {\n    await this.database('ChatApp', 'chat_messages');\n  }\n\n  static async getAllByChatId(chatId) {\n    return this.getAllByIndexAndId('by_chat', chatId);\n  }\n}\n","import { BaseModel } from './BaseModel.js';\nimport { ChatMessage } from './ChatMessage.js';\n\nexport class Chat extends BaseModel {\n  async addMessage(data) {\n    data.chatId = this.id;\n    return await new ChatMessage(data).create();\n  }\n\n  async getMessages() {\n    const messages = await ChatMessage.getAllByChatId(this.id);\n    this.messages = messages;\n    return this.messages;\n  }\n\n  static async initialize() {\n    await this.database('ChatApp', ['chats']);\n  }\n\n  static async clear() {\n    await ChatMessage.clear();\n    await super.clear();\n  }\n\n  static async get(id) {\n    const chat = await super.get(id);\n\n    /*\n    if (chat) {\n      // Fetch all messages for this chat\n      const messages = await ChatMessage.getAllByChatId(id);\n      chat.messages = messages;\n    }\n    */\n\n    return chat;\n  }\n\n  static async delete(id) {\n    // Delete the chat instance\n    await super.delete(id);\n\n    // Delete all associated messages\n    const messages = await ChatMessage.getAllByChatId(id);\n    for (const message of messages) {\n      await message.delete();\n    }\n  }\n}\n","import { Event } from './Event.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\nimport { Settings } from './models/Settings.js';\n\nexport class AppController {\n  static async updateChat(chat, data) {\n    Object.assign(chat, data);\n    await chat.save();\n    // TODO: Move to BaseModel\n    Event.emit('chatUpdated', chat);\n  }\n\n  static async createChat(data) {\n    if (!data) {\n      data = {};\n    }\n    if (!data.title) {\n      data.title = 'Untitled';\n    }\n    if (!data.model) {\n      data.model = Settings.getModel();\n    }\n    const chat = await new Chat(data).create();\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatCreated', chat);\n    Event.emit('chatSelected', chat);\n    return chat;\n  }\n\n  static async deleteChatMessage(messageId) {\n    const message = await ChatMessage.get(messageId);\n    message.delete();\n  }\n\n  static async deleteChat(chat) {\n    await chat.delete();\n    if (Settings.getCurrentChatId() === chat.id) {\n      Settings.setCurrentChatId(null);\n    }\n    Event.emit('chatDeleted', chat);\n  }\n\n  static async getCurrentChat() {\n    const chatId = this.getCurrentChatId();\n    if (chatId) {\n      return await Chat.get(chatId);\n    }\n    return null;\n  }\n\n  static getCurrentChatId() {\n    return Settings.get('currentChatId');\n  }\n\n  static async setCurrentChat(chat) {\n    Settings.setCurrentChatId(chat.id);\n    Event.emit('chatSelected', chat);\n  }\n\n  static async setCurrentChatId(chatId) {\n    const chat = await Chat.get(chatId);\n    if (chat) {\n      await this.setCurrentChat(chat);\n    }\n  }\n\n  static async clearChats() {\n    Settings.setCurrentChatId(null);\n    await Chat.clear();\n    Event.emit('chatsCleared');\n  }\n}\n","import { AppController } from './AppController.js';\n\nexport class ChatListItem {\n  constructor(chat, chatList, selected) {\n    this.chat = chat;\n    this.chatList = chatList;\n    this.content = document\n      .getElementById('chat-list-item-template')\n      .content.cloneNode(true);\n    this.element = this.content.querySelector('.chat-list-item');\n    this.element.title = this.chat.title;\n    this.element.data = { id: this.chat.id };\n    this.element.classList.add(`chat${this.chat.id}`);\n    if (selected === true) {\n      this.element.classList.add('selected');\n      // this.content.querySelector('.icon-selected').classList.remove('hidden')\n    }\n    this.setTitle();\n    this.bindEventListeners();\n  }\n\n  render() {}\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', this.onMouseover.bind(this));\n    this.element.addEventListener('mouseout', this.onMouseout.bind(this));\n    this.element.addEventListener('click', this.onClick.bind(this));\n    this.element\n      .querySelector('.list-item-delete')\n      .addEventListener('click', this.deleteChat.bind(this));\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n\n  onClick() {\n    this.chatList.selectChat(this.chat.id);\n  }\n\n  setTitle() {\n    const chatTitle = this.content.querySelector('.chat-title');\n    chatTitle.textContent = this.chat.title;\n  }\n\n  deleteChat() {\n    AppController.deleteChat(this.chat);\n    this.element.remove();\n  }\n}\n","export class DragAndDrop {\n  constructor(selector) {\n    this.listItems = document.querySelectorAll(selector);\n    this.draggedItem = null;\n    this.initializeDragAndDrop();\n  }\n\n  initializeDragAndDrop() {\n    this.listItems.forEach((item) => {\n      item.addEventListener('dragstart', this.handleDragStart.bind(this, item));\n      item.addEventListener('dragover', this.handleDragOver.bind(this));\n      item.addEventListener('drop', this.handleDrop.bind(this, item));\n      item.addEventListener('dragend', this.handleDragEnd.bind(this));\n    });\n  }\n\n  handleDragStart(item) {\n    this.draggedItem = item;\n  }\n\n  handleDragOver(e) {\n    e.preventDefault();\n  }\n\n  handleDrop(item) {\n    if (item !== this.draggedItem) {\n      let currentHTML = item.innerHTML;\n      item.innerHTML = this.draggedItem.innerHTML;\n      this.draggedItem.innerHTML = currentHTML;\n      console.debug('dnd drop');\n    }\n  }\n\n  handleDragEnd() {\n    this.draggedItem = null;\n  }\n}\n","import { Event } from './Event.js';\nimport { ChatListItem } from './ChatListItem.js';\nimport { DragAndDrop } from './DragAndDrop.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatList {\n  constructor() {\n    this.element = document.getElementById('chat-list');\n    this.template = document.getElementById('chat-list-item-template').content;\n    this.bindEventListeners();\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n    });\n  }\n\n  bindEventListeners() {\n    Event.listen('chatCreated', this.handleChatCreated.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatsCleared', this.handleChatsCleared.bind(this));\n    Event.listen('chatUpdated', this.handleChatUpdated.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  async selectChat(chatId) {\n    await AppController.setCurrentChatId(chatId);\n  }\n\n  handleChatCreated(chat) {\n    this.appendChat(chat, true);\n  }\n\n  handleChatDeleted(chat) {\n    if (this.chat?.id === chat.id) {\n      this.chat = null;\n    }\n    this.element.querySelector(`.chat${chat.id}`)?.remove();\n  }\n\n  handleChatsCleared() {\n    const elements = this.element.querySelectorAll('.chat-list-item');\n    elements.forEach((element) => element.remove());\n  }\n\n  handleChatUpdated(chat) {\n    const listElement = this.element.querySelector(\n      `.chat${chat.id} .chat-title`,\n    );\n    if (listElement) {\n      listElement.textContent = chat.title;\n    }\n  }\n\n  handleChatSelected(chat) {\n    if (this.chat) {\n      const previousListElement = this.element.querySelector(\n        `.chat${this.chat.id}`,\n      );\n      if (previousListElement) {\n        previousListElement.classList.remove('selected');\n      }\n    }\n    const newListElement = this.element.querySelector(`.chat${chat.id}`);\n    if (newListElement) {\n      newListElement.classList.add('selected');\n    }\n    // Remember selected chat\n    this.chat = chat;\n  }\n\n  render() {\n    const currentChatId = AppController.getCurrentChatId();\n    this.element.innerHTML = '';\n    Chat.getAll().then((chats) => {\n      chats.forEach((chat) => {\n        const selected = chat.id === currentChatId;\n        this.appendChat(chat, selected);\n      });\n      new DragAndDrop('.chat-list-item');\n    });\n  }\n\n  appendChat(chat, selected) {\n    const chatListItem = new ChatListItem(chat, this, selected);\n    this.element.appendChild(chatListItem.element);\n    return chatListItem;\n  }\n}\n","import { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\nexport class DownloadChatsButton {\n  constructor() {\n    this.button = document.querySelector('#export-button');\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.button.addEventListener('click', () => {\n      this.exportChat();\n      this.exportChatMessages();\n    });\n  }\n\n  async exportChat() {\n    const request = await Chat.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chats.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n\n  async exportChatMessages() {\n    const request = await ChatMessage.export();\n\n    request.onsuccess = function () {\n      let data = request.result;\n\n      // Convert the data to JSON format\n      let jsonData = JSON.stringify(data, 2);\n\n      // Export the JSON data by creating a file to download\n      let blob = new Blob([jsonData], { type: 'application/json' });\n      let url = URL.createObjectURL(blob);\n\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = 'chat_messages.json';\n      a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    request.onerror = function (event) {\n      console.error('Error reading data: ', event.target.errorCode);\n    };\n  }\n}\n","export class LocalStorage {\n  // Set a value in localStorage\n  set(key, value) {\n    try {\n      const stringValue = JSON.stringify(value);\n      localStorage.setItem(key, stringValue);\n    } catch (e) {\n      console.error('Error saving to localStorage', e);\n    }\n  }\n\n  // Get a value from localStorage, return defaultValue if key doesn't exist\n  get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value !== null ? JSON.parse(value) : defaultValue;\n    } catch (e) {\n      console.error('Error reading from localStorage', e);\n      return defaultValue;\n    }\n  }\n\n  // Remove a value from localStorage\n  remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      console.error('Error removing from localStorage', e);\n    }\n  }\n}\n","import { debounce } from './debounce.js';\nimport { Event } from './Event.js';\nimport { Chat } from './models/Chat.js';\nimport { AppController } from './AppController.js';\nimport { ChatList } from './ChatList.js';\nimport { DownloadChatsButton } from './DownloadChatsButton.js';\nimport { LocalStorage } from './models/LocalStorage.js';\n\nexport class Sidebar {\n  constructor() {\n    this.settings = new LocalStorage();\n    this.chatList = new ChatList();\n    this.element = document.getElementById('sidebar');\n    this.newChatButton = this.element.querySelector('#new-chat-button');\n    this.clearButton = this.element.querySelector('#clear-button');\n    this.hamburgerButton = document.getElementById('hamburger-menu');\n    this.searchButton = document.getElementById('search-button');\n    this.downloadChatsButton = new DownloadChatsButton();\n    this.searchRow = document.getElementById('search-row');\n    this.searchInput = document.getElementById('search-input');\n    if (this.settings.get('sidebar-collapsed') === true) {\n      this.element.classList.add('collapsed');\n    }\n    this.bindEventListeners();\n  }\n\n  render() {\n    this.chatList.render();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    this.searchButton.addEventListener('click', this.toggleSearch.bind(this));\n    this.searchInput.addEventListener(\n      'keypress',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.searchInput.addEventListener(\n      'keyup',\n      debounce(this.performSearch.bind(this), 50),\n    );\n    this.newChatButton.addEventListener('click', this.handleNewChat.bind(this));\n    this.clearButton.addEventListener('click', this.handleClear.bind(this));\n    this.hamburgerButton.addEventListener('click', this.toggle.bind(this));\n  }\n\n  // TODO: Fix\n  handleChatSelected = (chat) => {\n    const listItem = this.element.querySelector(`chat${chat.id}`);\n    if (listItem) {\n      listItem.scrollIntoView({\n        behavior: 'smooth',\n        block: 'start', // \"start\" will bring the top of the element into view\n        inline: 'nearest', // \"nearest\" will scroll to the nearest edge if partially visible\n      });\n    }\n  };\n\n  toggleSearch() {\n    const searchRow = document.getElementById('search-row');\n    searchRow.classList.toggle('hidden');\n    this.searchInput.focus();\n  }\n\n  performSearch() {\n    function escapeRegExp(string) {\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // Escapes special characters\n    }\n    const query = escapeRegExp(this.searchInput.value.trim()).replace(\n      /\\s+/g,\n      '.*',\n    );\n    const queryContent = query.length > 2; // Nobody wants to query content based on one character?\n    const regex = new RegExp(query, 'i'); // 'i' for case-insensitive matching\n    console.log(`Search ${query}`);\n    Chat.getAll().then((chats) => {\n      const matches = chats\n        .filter((chat) => {\n          let match = regex.test(chat.title);\n          if (queryContent) {\n            match ||= regex.test(chat.content);\n          }\n          return match;\n        })\n        .map((chat) => chat.id);\n      this.element.querySelectorAll('.chat-list-item').forEach((item) => {\n        if (matches.includes(item.data.id)) {\n          // Now matches the type\n          item.classList.remove('hidden');\n        } else {\n          item.classList.add('hidden');\n        }\n      });\n    });\n  }\n\n  toggle() {\n    this.element.classList.toggle('collapsed');\n    this.hamburgerButton.classList.toggle('collapsed');\n    if (this.element.classList.contains('collapsed')) {\n      this.settings.set('sidebar-collapsed', true);\n    } else {\n      this.settings.set('sidebar-collapsed', false);\n    }\n  }\n\n  async handleNewChat() {\n    await AppController.createChat();\n  }\n\n  async handleClear() {\n    await AppController.clearChats();\n  }\n}\n","export class CopyButton {\n  constructor() {\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('copy-button')) {\n        const targetSelector = event.target.getAttribute('data-target');\n        if (!targetSelector) {\n          console.error('The data-target attribute is not set');\n          return;\n        }\n        const textToCopy = document.getElementById(targetSelector).innerText;\n        // Create a temporary textarea element\n        const textarea = document.createElement('textarea');\n        textarea.value = textToCopy;\n        document.body.appendChild(textarea);\n\n        // Select the text and copy it\n        textarea.select();\n        document.execCommand('copy');\n\n        // Remove the temporary textarea\n        document.body.removeChild(textarea);\n\n        // Optional: Display a message or change the button text/content\n        alert('Text copied to clipboard');\n      }\n    });\n  }\n}\n","export class OllamaApi {\n  constructor() {\n    this.abortController = null;\n  }\n\n  async send(url, data, onResponse, onError, onDone) {\n    const request = { data };\n    try {\n      const response = await this.postChatMessage(url, data);\n      await this.handleResponse(request, response, onResponse, onDone);\n    } catch (error) {\n      onError(request, error);\n    }\n  }\n\n  async postChatMessage(url, data) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n    const response = await fetch(url, {\n      signal,\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      throw new Error(`${url} failed with status ${response.status}`);\n    }\n\n    return response;\n  }\n\n  async handleResponse(request, response, onResponse, onDone) {\n    const reader = response.body.getReader();\n    let partialLine = '';\n    var isRequestDone = false;\n\n    while (!isRequestDone) {\n      const { done, value } = await reader.read();\n      if (done) {\n        onDone(request, response);\n        isRequestDone = true;\n        continue;\n      }\n\n      const textChunk = new TextDecoder().decode(value);\n      const lines = (partialLine + textChunk).split('\\n');\n      partialLine = lines.pop();\n\n      lines.forEach((line) => {\n        const responseData = JSON.parse(line);\n        if (line.trim()) {\n          // TODO: Move this line:\n          this.printResponseStats(responseData);\n          onResponse(request, responseData.message.content);\n        }\n      });\n    }\n\n    if (partialLine.trim()) {\n      onResponse(request, partialLine);\n    }\n  }\n\n  abort() {\n    if (this.abortController) {\n      this.abortController.abort();\n    }\n  }\n\n  printResponseStats(data) {\n    if (!data.total_duration) {\n      return;\n    }\n    // Convert nanoseconds to seconds for durations\n    const totalDurationInSeconds = data.total_duration / 1e9;\n    const loadDurationInSeconds = data.load_duration / 1e9;\n    const promptEvalDurationInSeconds = data.prompt_eval_duration / 1e9;\n    const responseEvalDurationInSeconds = data.eval_duration / 1e9;\n\n    // Calculate tokens per second (token/s)\n    const tokensPerSecond = data.eval_count / responseEvalDurationInSeconds;\n    const output = `\nModel: ${data.model}\nCreated At: ${data.created_at}\nTotal Duration (s): ${totalDurationInSeconds.toFixed(2)}\nLoad Duration (s): ${loadDurationInSeconds.toFixed(2)}\nPrompt Evaluation Count: ${data.prompt_eval_count}\nPrompt Evaluation Duration (s): ${promptEvalDurationInSeconds.toFixed(2)}\nResponse Evaluation Count: ${data.eval_count}\nResponse Evaluation Duration (s): ${responseEvalDurationInSeconds.toFixed(2)}\nTokens Per Second: ${tokensPerSecond.toFixed(2)} token/s\n    `;\n    console.log(output);\n  }\n\n  static getModels(url, onResponse) {\n    if (!url) {\n      return null;\n    }\n\n    return fetch(url)\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error(`Unable to fetch models from ${url}`);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        onResponse(data.models);\n      })\n      .catch((error) => {\n        console.debug(error);\n        console.error(\n          `Please ensure the server is running at: ${url}. Error code: 39847`,\n        );\n        onResponse([]);\n      });\n  }\n}\n","export class DownloadButton {\n  constructor() {\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element has the class 'copy-button'\n      if (event.target.classList.contains('download-button')) {\n        // Get the index from the data-target attribute\n        const targetId = event.target.getAttribute('data-target');\n        this.downloadElementContent(targetId, 'chat.html');\n      }\n    });\n  }\n\n  downloadElementContent(elementId, filename) {\n    // Get the element\n    const element = document.getElementById(elementId);\n    if (!element) {\n      console.error('Element not found');\n      return;\n    }\n\n    // Get the contents of the element\n    const content = element.innerText;\n\n    // Create a Blob with the content\n    const blob = new Blob([content], { type: 'text/html' });\n\n    // Create an anchor element and set the href to the blob\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = filename;\n\n    // Append the anchor to the document, trigger a click, and then remove it\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n\n    // Revoke the blob URL\n    URL.revokeObjectURL(a.href);\n  }\n}\n","export class DropDownMenu {\n  constructor() {\n    this.buttonSelector = '.drop-down-menu';\n    this.dropDownMenus = document.querySelectorAll(this.buttonSelector);\n    this.init();\n  }\n\n  init() {\n    // Add a click listener to the whole document\n    document.addEventListener('click', (event) => {\n      // Check if the clicked element or any of its parents has the 'drop-down-menu' class\n      const menuElement = event.target.closest(this.buttonSelector);\n      if (menuElement) {\n        const dropDownMenu = menuElement.querySelector('.drop-down-menu-items');\n        if (dropDownMenu) {\n          this.toggleMenu(dropDownMenu);\n        }\n      }\n    });\n  }\n\n  toggleMenu(menu) {\n    menu.classList.toggle('hidden');\n    menu.classList.toggle('visible');\n  }\n}\n","// Modal base class\nexport class Modal {\n  constructor(domId) {\n    this.domId = domId;\n    this.modal = document.getElementById(this.domId);\n    this.closeButton = this.modal.querySelector('.button-close');\n    this.closeButton.onclick = () => this.hide();\n    this._bindEventListeners();\n  }\n\n  _bindEventListeners() {\n    window.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.hide();\n      }\n    });\n  }\n\n  show() {\n    this.handleShow();\n  }\n\n  hide() {\n    this.handleHide();\n  }\n\n  handleShow() {\n    this.modal.classList.add('show');\n  }\n\n  handleHide() {\n    this.modal.classList.remove('show');\n  }\n}\n","export class List {\n  constructor(containerId, items, selected) {\n    this.container = document.getElementById(containerId);\n    this.items = items;\n    this.selected = selected;\n    this.render();\n    this.clickHandler = null;\n  }\n\n  onClick(handler) {\n    this.clickHandler = handler;\n    return this; // Allow chaining\n  }\n\n  setItems(items) {\n    this.items = items;\n    this.render();\n  }\n\n  setSelected(selected) {\n    console.debug(`Select ${selected}`);\n    this.selected = selected;\n    this.render();\n  }\n\n  getSelected() {\n    return this.selected;\n  }\n\n  render() {\n    this.container.innerHTML = ''; // Clear existing content\n    const ul = document.createElement('ul');\n    ul.classList.add('list');\n    this.items.forEach((item) => {\n      const li = document.createElement('li');\n      li.classList.add('list-item');\n      if (item === this.selected) {\n        li.classList.add('selected');\n      }\n      li.textContent = item;\n      li.item = item;\n      li.addEventListener('click', () => {\n        this.setSelected(item);\n        if (this.clickHandler) {\n          this.clickHandler(item);\n        }\n      });\n      ul.appendChild(li);\n    });\n    this.container.appendChild(ul);\n  }\n}\n","import { Event } from '../Event.js';\nimport { Settings } from './Settings.js';\nimport { OllamaApi } from '../OllamaApi.js';\n\nexport class Models {\n  static models = [];\n\n  static getUrl() {\n    return Settings.getUrl('/api/tags');\n  }\n\n  static load() {\n    if (!this.getUrl()) {\n      return null;\n    }\n    return OllamaApi.getModels(this.getUrl(), (models) => {\n      Models.models = models;\n      Settings.set('models', Models.models);\n      Event.emit('modelsLoaded', Models.models);\n    });\n  }\n\n  static getAll() {\n    return Models.models;\n  }\n\n  static getNames() {\n    return Models.models.map((model) => model.name);\n  }\n\n  static findModelByName(name) {\n    return Models.models.find((model) => model.name === name);\n  }\n}\n","import { List } from './List.js';\nimport { Event } from './Event.js';\nimport { Models } from './models/Models.js';\n\nexport class ModelsList {\n  constructor(selector, selectedModel) {\n    this.modelList = new List(selector, Models.getNames(), selectedModel);\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    Event.listen('modelsLoaded', this.handleModelsLoaded.bind(this));\n  }\n\n  handleModelsLoaded() {\n    this.modelList.setItems(Models.getNames());\n  }\n\n  onClick(handler) {\n    this.modelList.clickHandler = handler;\n    return this.modelList; // Allow chaining\n  }\n\n  getSelected() {\n    return this.modelList.selected;\n  }\n}\n","import { Modal } from './Modal.js';\nimport { UINotification } from './UINotification.js';\nimport { ModelsList } from './ModelsList.js';\nimport { Models } from './models/Models.js';\nimport { Settings } from './models/Settings.js';\n\nexport class SettingsDialog extends Modal {\n  constructor() {\n    super('settings-dialog');\n    this.showButton = document.getElementById('settings-button');\n    this.urlInput = document.getElementById('input-url');\n    this.modelInput = document.getElementById('input-model');\n    this.systemPromptInput = this.modal.querySelector('#input-system-prompt');\n    this.modelParametersInput = this.modal.querySelector(\n      '#input-model-parameters',\n    );\n    this.refreshModelsButton = this.modal.querySelector(\n      '.refresh-models-button',\n    );\n    this.modelList = new ModelsList('model-list', Settings.getModel());\n    this.bindEventListeners();\n    this.loadSettings();\n  }\n\n  bindEventListeners() {\n    this.urlInput.addEventListener('blur', () => {\n      const value = this.urlInput.value.trim();\n      Settings.setUrl(value);\n    });\n    this.systemPromptInput.addEventListener('blur', () => {\n      Settings.setSystemPrompt(this.systemPromptInput.value.trim());\n    });\n    this.modelParametersInput.addEventListener('blur', () => {\n      const value = this.modelParametersInput.value.trim();\n      if (value === '') {\n        return;\n      }\n      try {\n        const parsedValue = JSON.parse(value);\n        const prettyJSON = JSON.stringify(parsedValue, 2);\n        Settings.setModelParameters(parsedValue);\n        this.modelParametersInput.value = prettyJSON;\n        this.modelParametersInput.classList.remove('error');\n      } catch (error) {\n        if (error.name === 'SyntaxError') {\n          this.modelParametersInput.classList.add('error');\n        } else {\n          console.error(error);\n        }\n      }\n    });\n    this.modelList.onClick(() => {\n      Settings.setModel(this.modelList.getSelected());\n    });\n    this.showButton.addEventListener('click', this.show.bind(this));\n    this.refreshModelsButton.onclick = () => this.refreshModels();\n    this.closeButton.onclick = () => this.hide();\n  }\n\n  show() {\n    Models.load();\n    this.handleShow();\n  }\n\n  refreshModels() {\n    if (!Models.getUrl()) {\n      UINotification.show('Please update the URL in the settings to continue.');\n    } else {\n      Models.load();\n    }\n  }\n\n  loadSettings() {\n    this.urlInput.value = Settings.getUrl();\n    const modelParameters = Settings.getModelParameters();\n    if (modelParameters) {\n      this.modelParametersInput.value = JSON.stringify(modelParameters, 2);\n    }\n  }\n}\n","import { AppController } from './AppController.js';\nimport { Event } from './Event.js';\nimport { Modal } from './Modal.js';\nimport { Models } from './models/Models.js';\nimport { ModelsList } from './ModelsList.js';\n\nexport class ChatSettingsDialog extends Modal {\n  constructor() {\n    super('chat-settings-dialog');\n    this.showButton = document.getElementById('chat-settings-button');\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.showButton.addEventListener('click', this.show.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n  }\n\n  show() {\n    Models.load().then(() => {\n      AppController.getCurrentChat().then((chat) => {\n        this.handleChatSelected(chat);\n        this.handleShow();\n      });\n    });\n  }\n\n  handleChatSelected(chat) {\n    this.modelList = new ModelsList('chat-model-list', chat.model);\n    this.modelList.onClick(async (model) => {\n      chat.model = model;\n      await chat.save();\n    });\n  }\n}\n","export class ExportChat {\n  static exportChat(chat, filename) {\n    // Get the contents of the element\n    const content = chat.jsonify();\n\n    // Create a Blob with the content\n    const blob = new Blob([content], { type: 'application/json' });\n\n    // Create an anchor element and set the href to the blob\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = filename;\n\n    // Append the anchor to the document, trigger a click, and then remove it\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n\n    // Revoke the blob URL\n    URL.revokeObjectURL(a.href);\n  }\n}\n","export class Hoverable {\n  constructor(element) {\n    this.element = element;\n    element.hoverable = this;\n    this.bindEventListeners();\n  }\n\n  bindEventListeners() {\n    this.element.addEventListener('mouseover', () => this.onMouseover());\n    this.element.addEventListener('mouseout', () => this.onMouseout());\n  }\n\n  onMouseover() {\n    this.element.classList.add('hover');\n  }\n\n  onMouseout() {\n    this.element.classList.remove('hover');\n  }\n}\n","import { Event } from './Event.js';\nimport { AppController } from './AppController.js';\n\nexport class ChatTitle {\n  constructor() {\n    this.defaultTitle = 'Untitled';\n    this.element = document.getElementById('chat-title');\n    this.bindEventListeners();\n    this.render();\n  }\n\n  render() {\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.setTitle(chat?.title);\n    });\n  }\n\n  setTitle(title) {\n    this.element.textContent = title || this.defaultTitle;\n  }\n\n  focus() {\n    const hasFocus = document.activeElement === this.element;\n    if (!hasFocus) {\n      this.element.focus();\n    }\n  }\n\n  bindEventListeners() {\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    this.element.addEventListener('blur', this.handleSave.bind(this));\n    this.element.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        this.element.blur();\n      }\n    });\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.setTitle(chat.title);\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat.id) {\n      this.setTitle(this.defaultTitle);\n    }\n  }\n\n  async handleSave() {\n    let title = this.element.textContent.trim();\n    if (title.length === 0) {\n      title = this.defaultTitle;\n      this.element.classList.add('error');\n    } else {\n      this.element.classList.remove('error');\n    }\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.updateChat(chat, { title });\n    } else {\n      await AppController.createChat({ title });\n    }\n  }\n}\n","// TODO: Move code here from App.js\nexport class ChatForm {\n  constructor() {\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n  }\n}\n","import { AppController } from './AppController.js';\nimport { ExportChat } from './ExportChat.js';\nimport { Event } from './Event.js';\nimport { Hoverable } from './Hoverable.js';\nimport { ChatTitle } from './ChatTitle.js';\nimport { ChatForm } from './ChatForm.js';\n\nexport class ChatArea {\n  constructor() {\n    this.chatTitle = new ChatTitle();\n    this.chatForm = new ChatForm();\n    this.chatHistory = document.getElementById('chat-history');\n    this.messageInput = document.getElementById('message-input');\n    this.editChatButton = document.getElementById('edit-chat-button');\n    this.scrollToTopButton = document.getElementById('scroll-to-top-button');\n    this.scrollToEndButton = document.getElementById('scroll-to-end-button');\n    this.deleteChatButton = document.getElementById('delete-chat-button');\n    this.exportChatButton = document.getElementById('export-chat-button');\n    AppController.getCurrentChat().then((chat) => {\n      this.chat = chat;\n      this.render();\n    });\n    this.bindEventListeners();\n  }\n\n  render() {\n    // Clear history view\n    this.chatHistory.innerText = '';\n    // Render chat history\n    this.chat?.getMessages()?.then((messages) => {\n      messages.forEach((message) => {\n        this.createMessageDiv(message);\n      });\n    });\n    this.scrollToEnd();\n    this.messageInput.focus();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected.bind(this));\n    Event.listen('chatDeleted', this.handleChatDeleted.bind(this));\n    this.scrollToTopButton.addEventListener(\n      'click',\n      this.scrollToTop.bind(this),\n    );\n    this.scrollToEndButton.addEventListener(\n      'click',\n      this.scrollToEnd.bind(this),\n    );\n    this.editChatButton.addEventListener(\n      'click',\n      this.handleEditChat.bind(this),\n    );\n    this.deleteChatButton.addEventListener(\n      'click',\n      this.handleDeleteChat.bind(this),\n    );\n    this.exportChatButton.addEventListener('click', () => {\n      ExportChat.exportChat(this.chat, `chat-${this.chat.id}.json`);\n    });\n    this.currentMessage = this.chatHistory.querySelector('.selected');\n    // Select chat message with arrow up and arrow down keys\n    document.addEventListener('keydown', (event) => {\n      let next, previous;\n\n      if (event.key === 'ArrowDown') {\n        next = this.currentMessage\n          ? this.currentMessage.nextElementSibling\n          : this.chatHistory.firstElementChild;\n        if (next) {\n          if (this.currentMessage)\n            this.currentMessage.classList.remove('hover');\n          next.classList.add('hover');\n          this.currentMessage = next; // Update currentMessage\n          this.currentMessage.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          }); // Scroll into view\n        }\n      } else if (event.key === 'ArrowUp') {\n        previous = this.currentMessage\n          ? this.currentMessage.previousElementSibling\n          : this.chatHistory.lastElementChild;\n        if (previous) {\n          if (this.currentMessage)\n            this.currentMessage.classList.remove('hover');\n          previous.classList.add('hover');\n        }\n        this.currentMessage = previous; // Update currentMessage\n        this.currentMessage.scrollIntoView({\n          behavior: 'smooth',\n          block: 'nearest',\n        }); // Scroll into view\n      }\n    });\n  }\n\n  createMessageDiv(message) {\n    const domId = `chat-message-${message.id}`;\n    const role = message.role;\n    const content = message.content;\n    // Get the template and its content\n    const template = document.getElementById('chat-message-template');\n    const messageClone = template.content.cloneNode(true);\n    // Find the div and span elements within the cloned template\n    const messageDiv = messageClone.querySelector('.chat-message');\n    const textSpan = messageClone.querySelector('.chat-message-text');\n    const deleteButton = messageClone.querySelector(\n      '.delete-chat-message-button',\n    );\n    const copyButton = messageClone.querySelector(\n      '.copy-chat-message-button .copy-button',\n    );\n    const goodButton = messageClone.querySelector('.good-chat-message-button');\n    const badButton = messageClone.querySelector('.bad-chat-message-button');\n    const flagButton = messageClone.querySelector('.flag-chat-message-button');\n\n    if (message.quality == 'bad') {\n      badButton.classList.add('selected');\n    } else if (message.quality == 'good') {\n      goodButton.classList.add('selected');\n    } else if (message.quality == 'flagged') {\n      flagButton.classList.add('selected');\n    }\n\n    // Set the class for role and text content\n    messageDiv.classList.add(`${role}-chat-message`);\n    messageDiv.id = domId;\n    textSpan.textContent = content;\n    messageDiv.spellcheck = false;\n\n    // Append to chatHistory and adjust scroll\n    this.chatHistory.appendChild(messageDiv);\n    messageDiv.dataset['id'] = message.id;\n    new Hoverable(messageDiv);\n    deleteButton.addEventListener('click', async () => {\n      await AppController.deleteChatMessage(message.id);\n      messageDiv.remove();\n    });\n    copyButton.dataset['target'] = domId;\n    flagButton.addEventListener('click', async () => {\n      console.log('flagged');\n      message.quality = 'flagged';\n      await message.save();\n    });\n    goodButton.addEventListener('click', async () => {\n      console.log('good');\n      message.quality = 'good';\n      await message.save();\n    });\n    badButton.addEventListener('click', async () => {\n      console.log('bad');\n      message.quality = 'bad';\n      await message.save();\n    });\n    return { element: messageDiv, textElement: textSpan };\n  }\n\n  handleChatDeleted(chat) {\n    if (chat.id === this.chat?.id) {\n      this.chat = null;\n    } else {\n      this.chat = chat;\n    }\n    this.render();\n  }\n\n  handleChatSelected(chat) {\n    this.chat = chat;\n    this.render();\n  }\n\n  handleEditChat() {\n    this.chatTitle.focus();\n    event.stopPropagation();\n  }\n\n  async handleDeleteChat() {\n    const chat = await AppController.getCurrentChat();\n    if (chat) {\n      await AppController.deleteChat(chat);\n    }\n  }\n\n  scrollToTop() {\n    this.chatHistory.scrollTop = 0;\n  }\n\n  scrollToEnd() {\n    this.chatHistory.scrollTop = this.chatHistory.scrollHeight;\n  }\n}\n","import { UINotification } from './UINotification.js';\nimport { Settings } from './models/Settings.js';\nimport { Event } from './Event.js';\nimport { DOM } from './Dom.js';\nimport { Sidebar } from './Sidebar.js';\nimport { AppController } from './AppController.js';\nimport { CopyButton } from './CopyButton.js';\nimport { OllamaApi } from './OllamaApi.js';\nimport { DownloadButton } from './DownloadButton.js';\nimport { DropDownMenu } from './DropDownMenu.js';\nimport { SettingsDialog } from './SettingsDialog.js';\nimport { ChatSettingsDialog } from './ChatSettingsDialog.js';\n// import { MarkdownFormatter } from './MarkdownFormatter.js'\nimport { ChatArea } from './ChatArea.js';\n\n// TODO: Review and refactor\nexport class App {\n  static run() {\n    UINotification.initialize();\n    const app = new App();\n    return app;\n  }\n\n  constructor() {\n    this.sidebar = new Sidebar();\n    this.chatArea = new ChatArea();\n    this.ollamaApi = new OllamaApi();\n    this.settingsDialog = new SettingsDialog();\n    this.chatSettingsDialog = new ChatSettingsDialog();\n    this.downloadButton = new DownloadButton();\n    this.copyButton = new CopyButton();\n    this.dropDownMenu = new DropDownMenu();\n    this.initializeElements();\n    this.bindEventListeners();\n    this.logInitialization();\n    this.render();\n  }\n\n  initializeElements() {\n    // this.sendButton = document.getElementById('send-button');\n    this.abortButton = document.getElementById('abort-button');\n    this.messageInput = document.getElementById('message-input');\n    this.chatHistory = document.getElementById('chat-history');\n  }\n\n  logInitialization() {\n    const msg = `~~~~\\nChat\\n~~~~\nModel:       ${Settings.getModel()}\nURL:         ${Settings.getUrl()}\nChat:        ${Settings.getCurrentChatId()}\nParameters:  ${JSON.stringify(Settings.getModelParameters())}\n`;\n    console.log(msg);\n  }\n\n  render() {\n    this.sidebar.render();\n    this.chatArea.render();\n  }\n\n  bindEventListeners() {\n    Event.listen('chatSelected', this.handleChatSelected);\n    // this.sendButton.addEventListener('click', this.sendMessage.bind(this));\n    this.abortButton.addEventListener('click', this.handleAbort.bind(this));\n    this.messageInput.addEventListener(\n      'keypress',\n      this.handleKeyPress.bind(this),\n    );\n  }\n\n  handleChatSelected = (chat) => {\n    window.history.pushState({}, '', `/chats/${chat.id}`);\n  };\n\n  handleAbort = () => {\n    this.ollamaApi.abort();\n    this.enableForm();\n    console.log('Request aborted');\n  };\n\n  handleKeyPress = (event) => {\n    if (event.key === 'Enter' && !event.shiftKey) {\n      this.sendMessage();\n    }\n  };\n\n  enableForm() {\n    DOM.hideElement(this.abortButton).enableInput(this.messageInput);\n    this.messageInput.focus();\n  }\n\n  disableForm() {\n    DOM.showElement(this.abortButton).disableInput(this.messageInput);\n  }\n\n  // https://github.com/jmorganca/ollama/blob/main/docs/api.md#generate-a-completion\n  async sendMessage() {\n    const userPrompt = this.messageInput.value.trim();\n    // Get the current chat\n    let chat = await AppController.getCurrentChat();\n    const url = Settings.getUrl('/api/chat');\n    if (!url) {\n      UINotification.show(\n        'Please update the URL in the settings to continue. ',\n      );\n      return null;\n    }\n    if (userPrompt) {\n      // Reset input\n      this.messageInput.value = '';\n      // Create new chat\n      if (!chat) {\n        chat = await AppController.createChat({\n          title: 'Untitled',\n          model: Settings.getModel(),\n        });\n      }\n      // Store user message\n      const userMessage = await chat.addMessage({\n        role: 'user',\n        content: userPrompt,\n      });\n      const systemMessage = await chat.addMessage({\n        role: 'assistant',\n        content: '',\n      });\n      const systemPrompt = Settings.getSystemPrompt();\n      const modelParameters = Settings.getModelParameters();\n      // Disable form\n      this.disableForm();\n      // Create user message\n      this.createChatMessage(userMessage);\n      // Create system message container\n      const responseElement = this.createChatMessage(systemMessage);\n      const requestContext = {\n        chat,\n        userMessage,\n        systemMessage,\n        responseElement,\n      };\n      const requestData = {\n        prompt: userMessage,\n        model: chat.model,\n        messages: (await chat.getMessages()).map((message) => ({\n          role: message.role,\n          content: message.content,\n        })),\n      };\n      // Add system prompt\n      if (systemPrompt) {\n        requestData.system = systemPrompt;\n      }\n      // Add model parameters\n      if (modelParameters) {\n        requestData.options = modelParameters;\n      }\n      // Show spinner\n      responseElement.textElement.innerHTML = '<div class=\"waiting\"></div>';\n      // Make request\n      this.ollamaApi.send(\n        url,\n        requestData,\n        (request, response) =>\n          this.handleResponse(request, response, requestContext),\n        (request, error) => this.handleResponseError(request, error),\n        (request, response) =>\n          this.handleDone(request, response, requestContext),\n      );\n    }\n  }\n\n  createChatMessage(message) {\n    return this.chatArea.createMessageDiv(message);\n  }\n\n  handleResponse(request, response, context) {\n    const responseElement = context.responseElement;\n    const sanitizedContent = this.sanitizeContent(response);\n    // Remember original response\n    context.systemMessage.content += sanitizedContent;\n    responseElement.textElement.textContent += sanitizedContent;\n    this.chatArea.scrollToEnd();\n  }\n\n  handleResponseError(request, error) {\n    // Ignore \"Abort\" button\n    if (error.name !== 'AbortError') {\n      console.error(`Error: ${error.message}`);\n    }\n    this.chatArea.scrollToEnd();\n    this.enableForm();\n  }\n\n  async handleDone(request, response, context) {\n    const chat = context.chat;\n    console.log(`Chat ${chat.id} done`);\n    await context.systemMessage.save();\n    this.enableForm();\n  }\n\n  sanitizeContent = (content) => {\n    // TODO: Sanitization logic here\n    return content;\n  };\n\n  getIdParam = () => {\n    return new URL(window.location.href).pathname.split('/').pop();\n  };\n}\n","import { App } from './App.js';\nimport { Chat } from './models/Chat.js';\nimport { ChatMessage } from './models/ChatMessage.js';\n\n// TODO: refactor\nasync function initialize() {\n  await Chat.initialize();\n  await ChatMessage.initialize();\n}\n\ninitialize().then(() => {\n  App.run();\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}